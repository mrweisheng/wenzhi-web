import{u as a,r as e}from"./index-CFSbY6bd.js";import{E as s,l,O as i,e as t,u as o,B as d,P as r,J as u,H as n,Q as c,R as v,S as m,T as f,U as p,V as w,W as g,n as _}from"./element-plus-CCDyQ1z5.js";import{f as h}from"./format-B5gz6Uyj.js";import{g as y}from"./issues-GyIFwyiA.js";import{b,e as x}from"./user-CLx_oSFQ.js";import{x as P,r as k,c as V,k as C,ag as q,y as U,z as j,A as I,P as M,M as A,C as z,H as R,u as E,L as F,O as H,a4 as L}from"./vendor-BVd4RN3d.js";import{_ as O}from"./_plugin-vue_export-helper-BCo6x5W8.js";const S={class:"app-container"},T={class:"profile-container"},$={class:"user-summary"},B={class:"user-info-section"},J={class:"user-meta"},K={class:"user-name"},Q={class:"user-role"},W={class:"user-status"},D={class:"user-actions"},G={class:"main-content"},N={class:"info-sidebar"},X={class:"info-card"},Y={class:"info-group"},Z={class:"info-item"},aa={class:"info-icon"},ea={class:"info-content"},sa={class:"info-value"},la={class:"info-item"},ia={class:"info-icon"},ta={class:"info-content"},oa={class:"info-value"},da={class:"info-item"},ra={class:"info-icon"},ua={class:"info-content"},na={class:"info-value"},ca={class:"info-item"},va={class:"info-icon"},ma={class:"info-content"},fa={class:"info-value"},pa={class:"decoration-icons"},wa={class:"icon-wrapper"},ga={class:"icon-item primary"},_a={class:"icon-item success"},ha={class:"icon-item warning"},ya={class:"icon-item danger"},ba={class:"content-main"},xa={class:"content-card recent-issues-card"},Pa={class:"card-header"},ka={class:"card-actions"},Va={key:0,class:"empty-issues"},Ca={class:"empty-icon-wrapper"},qa={key:1,class:"issues-list"},Ua=["onClick"],ja={class:"issue-content"},Ia={class:"issue-header"},Ma={class:"issue-id"},Aa={class:"issue-title"},za={class:"issue-meta"},Ra={class:"issue-time"},Ea={class:"issue-action"},Fa={class:"content-card quote-card"},Ha={class:"card-header"},La={class:"card-actions"},Oa={class:"quote-content"},Sa={class:"quote-icon"},Ta={class:"quote-text"},$a={class:"quote-author"},Ba={class:"dialog-header-icon"},Ja={class:"icon-wrapper"},Ka={class:"password-tips"},Qa={class:"dialog-footer"},Wa={class:"dialog-header-icon"},Da={class:"icon-wrapper email-icon"},Ga={class:"dialog-description"},Na={class:"email-tips"},Xa={class:"dialog-footer"},Ya=O(P({__name:"index",setup(P){const O=a(),Ya=k([]),Za=[{text:"勿忘初心，方得始终。",author:"《华严经》"},{text:"千里之行，始于足下。",author:"老子"},{text:"工欲善其事，必先利其器。",author:"孔子"},{text:"知之为知之，不知为不知，是知也。",author:"孔子"},{text:"学而不思则罔，思而不学则殆。",author:"孔子"},{text:"不积跬步，无以至千里；不积小流，无以成江海。",author:"荀子"},{text:"纸上得来终觉浅，绝知此事要躬行。",author:"陆游"},{text:"路漫漫其修远兮，吾将上下而求索。",author:"屈原"},{text:"业精于勤，荒于嬉；行成于思，毁于随。",author:"韩愈"},{text:"天行健，君子以自强不息。",author:"《周易》"}],ae=k(Za[Math.floor(Math.random()*Za.length)]),ee=()=>{let a;do{a=Math.floor(Math.random()*Za.length)}while(Za[a].text===ae.value.text&&Za.length>1);ae.value=Za[a]},se=k(!1),le=k(),ie=k({oldPassword:"",newPassword:"",confirmPassword:""}),te={oldPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:(a,e,s)=>{e!==ie.value.newPassword?s(new Error("两次输入的密码不一致")):s()},trigger:"blur"}]},oe=k(!1),de=k(),re=k({email:""}),ue={email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}]},ne=k(!1),ce=V((()=>O.userInfo||{id:0,username:"",role_id:0,status:0,created_at:"",updated_at:"",role:{id:0,role_name:""},email:""})),ve=V((()=>{const a=ce.value.username||"default";return`https://api.dicebear.com/7.x/avataaars/svg?seed=${encodeURIComponent(a)}`})),me=a=>({pending:"待处理",processing:"处理中",completed:"已完成"}[a]||a),fe=()=>{ie.value={oldPassword:"",newPassword:"",confirmPassword:""},se.value=!0},pe=()=>{re.value={email:ce.value.email||""},oe.value=!0},we=async()=>{le.value&&await le.value.validate((async a=>{if(a){ne.value=!0;try{await b({oldPassword:ie.value.oldPassword,newPassword:ie.value.newPassword}),s.success("密码修改成功"),se.value=!1}catch(e){e.response&&e.response.data?s.error(e.response.data.message||"修改密码失败，请重试"):s.error("修改密码失败，请重试")}finally{ne.value=!1}}}))},ge=async()=>{de.value&&await de.value.validate((async a=>{if(a){ne.value=!0;try{await x(re.value.email),s.success("邮箱更新成功"),oe.value=!1,await O.getUserInfoAction()}catch(e){e.response&&e.response.data?s.error(e.response.data.message||"更新邮箱失败，请重试"):s.error("更新邮箱失败，请重试")}finally{ne.value=!1}}}))};return C((()=>{O.userInfo||O.getUserInfoAction(),(async()=>{var a;if(ce.value.id)try{const e=await y({pageSize:5,page:1});(null==(a=e.data)?void 0:a.data)&&(e.data.data.items?Ya.value=e.data.data.items.filter((a=>{var e;return(null==(e=a.assignee)?void 0:e.id)===ce.value.id})).slice(0,3):Array.isArray(e.data.data)&&(Ya.value=e.data.data.filter((a=>{var e;return(null==(e=a.assignee)?void 0:e.id)===ce.value.id})).slice(0,3)))}catch(e){}})()})),(a,s)=>{var y;const b=q("el-avatar"),x=q("el-icon"),P=q("el-button"),k=q("el-dropdown-item"),V=q("el-dropdown-menu"),C=q("el-dropdown"),O=q("el-empty"),Za=q("el-tag"),_e=q("el-input"),he=q("el-form-item"),ye=q("el-form"),be=q("el-dialog");return U(),j("div",S,[I("div",T,[I("div",$,[I("div",B,[M(b,{size:86,src:ve.value,class:"user-avatar"},null,8,["src"]),I("div",J,[I("h2",K,A(ce.value.username),1),I("div",Q,A((null==(y=ce.value.role)?void 0:y.role_name)||"暂无角色"),1),I("div",W,[I("div",{class:z(["status-indicator",1===ce.value.status?"active":"inactive"])},null,2),I("span",null,A(1===ce.value.status?"在线":"离线"),1)])])]),I("div",D,[M(C,{trigger:"click"},{dropdown:R((()=>[M(V,null,{default:R((()=>[M(k,{onClick:fe},{default:R((()=>[M(x,{class:"action-icon"},{default:R((()=>[M(E(l))])),_:1}),s[11]||(s[11]=F(" 修改密码 "))])),_:1}),M(k,{onClick:pe},{default:R((()=>[M(x,{class:"action-icon"},{default:R((()=>[M(E(i))])),_:1}),F(" "+A(ce.value.email?"修改邮箱":"绑定邮箱"),1)])),_:1})])),_:1})])),default:R((()=>[M(P,{type:"primary",class:"action-button"},{icon:R((()=>[M(x,null,{default:R((()=>[M(E(t))])),_:1})])),default:R((()=>[s[10]||(s[10]=F(" 编辑资料 "))])),_:1})])),_:1})])]),I("div",G,[I("div",N,[I("div",X,[s[16]||(s[16]=I("h3",{class:"card-title"},"基本信息",-1)),I("div",Y,[I("div",Z,[I("div",aa,[M(x,null,{default:R((()=>[M(E(o))])),_:1})]),I("div",ea,[s[12]||(s[12]=I("div",{class:"info-label"},"账号",-1)),I("div",sa,A(ce.value.username),1)])]),I("div",la,[I("div",ia,[M(x,null,{default:R((()=>[M(E(i))])),_:1})]),I("div",ta,[s[13]||(s[13]=I("div",{class:"info-label"},"邮箱",-1)),I("div",oa,A(ce.value.email||"暂无邮箱"),1)])]),I("div",da,[I("div",ra,[M(x,null,{default:R((()=>[M(E(d))])),_:1})]),I("div",ua,[s[14]||(s[14]=I("div",{class:"info-label"},"创建时间",-1)),I("div",na,A(E(h)(ce.value.created_at)),1)])]),I("div",ca,[I("div",va,[M(x,null,{default:R((()=>[M(E(r))])),_:1})]),I("div",ma,[s[15]||(s[15]=I("div",{class:"info-label"},"最后更新",-1)),I("div",fa,A(E(h)(ce.value.updated_at)),1)])])]),I("div",pa,[I("div",wa,[I("div",ga,[M(x,null,{default:R((()=>[M(E(u))])),_:1})]),I("div",_a,[M(x,null,{default:R((()=>[M(E(n))])),_:1})]),I("div",ha,[M(x,null,{default:R((()=>[M(E(c))])),_:1})]),I("div",ya,[M(x,null,{default:R((()=>[M(E(v))])),_:1})])])])])]),I("div",ba,[I("div",xa,[I("div",Pa,[s[18]||(s[18]=I("h3",{class:"card-title"},"最近负责的问题",-1)),I("div",ka,[M(P,{type:"primary",text:"",class:"view-all-button",onClick:s[0]||(s[0]=a=>E(e).push("/issues"))},{default:R((()=>[s[17]||(s[17]=F(" 查看全部 ")),M(x,{class:"ml-1"},{default:R((()=>[M(E(m))])),_:1})])),_:1})])]),Ya.value.length?(U(),j("div",qa,[(U(!0),j(H,null,L(Ya.value,(a=>{return U(),j("div",{key:a.id,class:"issue-item",onClick:s=>{return l=a.id,void e.push(`/issues?view=${l}`);var l}},[I("div",ja,[I("div",Ia,[I("div",Ma,"#"+A(a.id),1),M(Za,{type:(s=a.status,{pending:"info",processing:"warning",completed:"success"}[s]||"info"),effect:"light",class:"issue-status"},{default:R((()=>[F(A(me(a.status)),1)])),_:2},1032,["type"])]),I("h4",Aa,A(a.title),1),I("div",za,[I("div",Ra,[M(x,null,{default:R((()=>[M(E(p))])),_:1}),I("span",null,A(E(h)(a.createTime)),1)])])]),I("div",Ea,[M(x,null,{default:R((()=>[M(E(m))])),_:1})])],8,Ua);var s})),128))])):(U(),j("div",Va,[M(O,{description:"暂无负责的问题","image-size":120},{image:R((()=>[I("div",Ca,[M(x,null,{default:R((()=>[M(E(f))])),_:1})])])),default:R((()=>[M(P,{type:"primary",onClick:s[1]||(s[1]=a=>E(e).push("/issues"))},{default:R((()=>s[19]||(s[19]=[F("去浏览问题")]))),_:1})])),_:1})]))]),I("div",Fa,[I("div",Ha,[s[21]||(s[21]=I("h3",{class:"card-title"},"今日金句",-1)),I("div",La,[M(P,{type:"primary",text:"",class:"refresh-quote-button",onClick:ee},{default:R((()=>[s[20]||(s[20]=F(" 换一句 ")),M(x,{class:"ml-1"},{default:R((()=>[M(E(w))])),_:1})])),_:1})])]),I("div",Oa,[I("div",Sa,[M(x,null,{default:R((()=>[M(E(g))])),_:1})]),I("blockquote",Ta,A(ae.value.text),1),I("div",$a,"— "+A(ae.value.author),1)])])])])]),M(be,{modelValue:se.value,"onUpdate:modelValue":s[6]||(s[6]=a=>se.value=a),title:"修改密码",width:"460px",center:"","destroy-on-close":""},{footer:R((()=>[I("div",Qa,[M(P,{onClick:s[5]||(s[5]=a=>se.value=!1),class:"cancel-btn"},{default:R((()=>s[23]||(s[23]=[F("取消")]))),_:1}),M(P,{type:"primary",onClick:we,loading:ne.value,class:"confirm-btn"},{default:R((()=>s[24]||(s[24]=[F(" 确认修改 ")]))),_:1},8,["loading"])])])),default:R((()=>[I("div",Ba,[I("div",Ja,[M(x,null,{default:R((()=>[M(E(l))])),_:1})])]),s[25]||(s[25]=I("div",{class:"dialog-description"}," 设置一个安全的新密码，建议使用字母、数字和特殊符号的组合 ",-1)),M(ye,{model:ie.value,rules:te,ref_key:"passwordFormRef",ref:le,"label-position":"top",class:"custom-form"},{default:R((()=>[M(he,{label:"当前密码",prop:"oldPassword"},{default:R((()=>[M(_e,{modelValue:ie.value.oldPassword,"onUpdate:modelValue":s[2]||(s[2]=a=>ie.value.oldPassword=a),type:"password",placeholder:"请输入当前密码","show-password":"","prefix-icon":"Key"},null,8,["modelValue"])])),_:1}),M(he,{label:"新密码",prop:"newPassword"},{default:R((()=>[M(_e,{modelValue:ie.value.newPassword,"onUpdate:modelValue":s[3]||(s[3]=a=>ie.value.newPassword=a),type:"password",placeholder:"请输入新密码","show-password":"","prefix-icon":"Lock"},null,8,["modelValue"])])),_:1}),M(he,{label:"确认新密码",prop:"confirmPassword"},{default:R((()=>[M(_e,{modelValue:ie.value.confirmPassword,"onUpdate:modelValue":s[4]||(s[4]=a=>ie.value.confirmPassword=a),type:"password",placeholder:"请再次输入新密码","show-password":"","prefix-icon":"Check"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"]),I("div",Ka,[M(x,null,{default:R((()=>[M(E(_))])),_:1}),s[22]||(s[22]=I("span",null,"密码长度至少6位，建议包含大小写字母、数字和特殊字符",-1))])])),_:1},8,["modelValue"]),M(be,{modelValue:oe.value,"onUpdate:modelValue":s[9]||(s[9]=a=>oe.value=a),title:ce.value.email?"修改邮箱":"绑定邮箱",width:"460px",center:"","destroy-on-close":""},{footer:R((()=>[I("div",Xa,[M(P,{onClick:s[8]||(s[8]=a=>oe.value=!1),class:"cancel-btn"},{default:R((()=>s[27]||(s[27]=[F("取消")]))),_:1}),M(P,{type:"primary",onClick:ge,loading:ne.value,class:"confirm-btn"},{default:R((()=>[F(A(ce.value.email?"更新邮箱":"绑定邮箱"),1)])),_:1},8,["loading"])])])),default:R((()=>[I("div",Wa,[I("div",Da,[M(x,null,{default:R((()=>[M(E(i))])),_:1})])]),I("div",Ga,A(ce.value.email?"修改您的邮箱地址，新邮箱将用于接收系统通知和找回密码":"绑定邮箱地址，便于接收系统通知和找回密码"),1),M(ye,{model:re.value,rules:ue,ref_key:"emailFormRef",ref:de,"label-position":"top",class:"custom-form"},{default:R((()=>[M(he,{label:"邮箱地址",prop:"email"},{default:R((()=>[M(_e,{modelValue:re.value.email,"onUpdate:modelValue":s[7]||(s[7]=a=>re.value.email=a),placeholder:"请输入邮箱地址","prefix-icon":"Message"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"]),I("div",Na,[M(x,null,{default:R((()=>[M(E(_))])),_:1}),s[26]||(s[26]=I("span",null,"绑定邮箱后，您可以通过邮箱接收系统通知和重要提醒",-1))])])),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-19e6e899"]]);export{Ya as default};
