import{x as e,r as a,f as l,k as u,ag as t,aq as d,y as o,z as s,A as r,P as i,H as n,a5 as m,O as p,a4 as v,L as c,I as _,G as f,M as b,u as g}from"./vendor-BVd4RN3d.js";import{g as V,d as w,u as y,a as h,c as k}from"./user-CLx_oSFQ.js";import{g as C}from"./role-DY0C-Yg7.js";import{f as U}from"./format-B5gz6Uyj.js";import{a as x}from"./date-BKFy7LxP.js";import{E as j,a as q}from"./element-plus-CCDyQ1z5.js";import{_ as T}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./index-CFSbY6bd.js";const z={class:"app-container"},I={class:"toolbar"},S=T(e({__name:"index",setup(e){const T=a(!1),S=a([]),A=a([]),D=a(!1),E=a(""),F=a(!1),G=a(),H=a({username:"",password:"",role_id:void 0,real_name:"",email:"",status:1}),K=a({page:1,pageSize:10,username:"",role_id:void 0,status:void 0}),L={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],role_id:[{required:!0,message:"请选择角色",trigger:"change"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]},M=[{label:"启用",value:1},{label:"禁用",value:0}];a(0),a({username:"",role_id:"",status:""});const O=a(),P=async()=>{try{T.value=!0;const e=await V();e.data&&e.data.data&&(S.value=e.data.data)}catch(e){j.error("获取用户列表失败")}finally{T.value=!1}},R=()=>{P()},B=()=>{K.value={page:1,pageSize:10,username:"",role_id:void 0,status:void 0},P()},J=()=>{E.value="新增用户",D.value=!0},N=async()=>{if(G.value){await G.value.validate();try{F.value=!0;const e={...H.value};e.password||delete e.password,H.value.id?(await h(H.value.id,e),j.success("更新成功")):(await k(e),j.success("创建成功")),D.value=!1,P()}catch(e){}finally{F.value=!1}}},Q=()=>{G.value&&G.value.resetFields(),H.value={username:"",password:"",role_id:void 0,real_name:"",email:"",status:1}};return l(O,(e=>{const{startTime:a,endTime:l}=x(e);K.value.startTime=a,K.value.endTime=l})),u((async()=>{await P(),await(async()=>{try{const e=await C();e.data&&e.data.data&&(A.value=e.data.data)}catch(e){}})()})),(e,a)=>{const l=t("el-input"),u=t("el-form-item"),V=t("el-option"),h=t("el-select"),k=t("el-button"),C=t("el-form"),x=t("el-table-column"),O=t("el-switch"),W=t("el-table"),X=t("el-dialog"),Y=d("loading");return o(),s("div",z,[r("div",I,[i(C,{inline:!0,model:K.value,class:"search-form"},{default:n((()=>[i(u,null,{default:n((()=>[i(l,{modelValue:K.value.username,"onUpdate:modelValue":a[0]||(a[0]=e=>K.value.username=e),placeholder:"用户名",clearable:"",onKeyup:m(R,["enter"])},null,8,["modelValue"])])),_:1}),i(u,null,{default:n((()=>[i(h,{modelValue:K.value.role_id,"onUpdate:modelValue":a[1]||(a[1]=e=>K.value.role_id=e),placeholder:"角色",clearable:"",filterable:""},{default:n((()=>[(o(!0),s(p,null,v(A.value,(e=>(o(),f(V,{key:e.id,label:e.role_name,value:e.id},{default:n((()=>[c(b(e.role_name),1)])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),i(u,null,{default:n((()=>[i(h,{modelValue:K.value.status,"onUpdate:modelValue":a[2]||(a[2]=e=>K.value.status=e),placeholder:"状态",clearable:"",filterable:""},{default:n((()=>[(o(),s(p,null,v(M,(e=>i(V,{key:e.value,label:e.label,value:e.value},{default:n((()=>[c(b(e.label),1)])),_:2},1032,["label","value"]))),64))])),_:1},8,["modelValue"])])),_:1}),i(u,null,{default:n((()=>[i(k,{type:"primary",onClick:R},{default:n((()=>a[11]||(a[11]=[c("搜索")]))),_:1}),i(k,{onClick:B},{default:n((()=>a[12]||(a[12]=[c("重置")]))),_:1})])),_:1})])),_:1},8,["model"]),i(k,{type:"primary",onClick:J},{default:n((()=>a[13]||(a[13]=[c("新增用户")]))),_:1})]),_((o(),f(W,{data:S.value,style:{width:"100%","margin-top":"20px"}},{default:n((()=>[i(x,{prop:"id",label:"ID",width:"80"}),i(x,{prop:"username",label:"用户名"}),i(x,{prop:"real_name",label:"姓名"}),i(x,{prop:"email",label:"邮箱"}),i(x,{prop:"role_name",label:"角色"}),i(x,{label:"状态",width:"100"},{default:n((({row:e})=>[i(O,{modelValue:e.status,"onUpdate:modelValue":a=>e.status=a,"active-value":1,"inactive-value":0,onChange:a=>(async e=>{try{await y(e.id,{status:e.status}),j.success("状态更新成功")}catch(a){e.status=1===e.status?0:1}})(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),i(x,{prop:"created_at",label:"创建时间",width:"180"},{default:n((({row:e})=>[c(b(g(U)(e.created_at)),1)])),_:1}),i(x,{label:"操作",width:"200",fixed:"right"},{default:n((({row:e})=>[i(k,{type:"primary",link:"",onClick:a=>(e=>{E.value="编辑用户",H.value={...e,password:""},D.value=!0})(e)},{default:n((()=>a[14]||(a[14]=[c("编辑")]))),_:2},1032,["onClick"]),i(k,{type:"danger",link:"",onClick:a=>(async e=>{try{await q.confirm("确认删除该用户吗？","提示",{type:"warning"}),await w(e.id),j.success("删除成功"),P()}catch(a){}})(e)},{default:n((()=>a[15]||(a[15]=[c("删除")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[Y,T.value]]),i(X,{title:E.value,modelValue:D.value,"onUpdate:modelValue":a[10]||(a[10]=e=>D.value=e),width:"500px",onClose:Q},{footer:n((()=>[i(k,{onClick:a[9]||(a[9]=e=>D.value=!1)},{default:n((()=>a[16]||(a[16]=[c("取消")]))),_:1}),i(k,{type:"primary",onClick:N,loading:F.value},{default:n((()=>a[17]||(a[17]=[c(" 确定 ")]))),_:1},8,["loading"])])),default:n((()=>[i(C,{ref_key:"formRef",ref:G,model:H.value,rules:L,"label-width":"80px"},{default:n((()=>[i(u,{label:"用户名",prop:"username"},{default:n((()=>[i(l,{modelValue:H.value.username,"onUpdate:modelValue":a[3]||(a[3]=e=>H.value.username=e),placeholder:"请输入用户名",disabled:!!H.value.id},null,8,["modelValue","disabled"])])),_:1}),i(u,{label:"密码",prop:"password",rules:[{required:!H.value.id,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能小于6位",trigger:"blur"}]},{default:n((()=>[i(l,{modelValue:H.value.password,"onUpdate:modelValue":a[4]||(a[4]=e=>H.value.password=e),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])])),_:1},8,["rules"]),i(u,{label:"姓名",prop:"real_name"},{default:n((()=>[i(l,{modelValue:H.value.real_name,"onUpdate:modelValue":a[5]||(a[5]=e=>H.value.real_name=e),placeholder:"请输入姓名"},null,8,["modelValue"])])),_:1}),i(u,{label:"邮箱",prop:"email"},{default:n((()=>[i(l,{modelValue:H.value.email,"onUpdate:modelValue":a[6]||(a[6]=e=>H.value.email=e),placeholder:"请输入邮箱"},null,8,["modelValue"])])),_:1}),i(u,{label:"角色",prop:"role_id"},{default:n((()=>[i(h,{modelValue:H.value.role_id,"onUpdate:modelValue":a[7]||(a[7]=e=>H.value.role_id=e),placeholder:"请选择角色"},{default:n((()=>[(o(!0),s(p,null,v(A.value,(e=>(o(),f(V,{key:e.id,label:e.role_name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),i(u,{label:"状态",prop:"status"},{default:n((()=>[i(O,{modelValue:H.value.status,"onUpdate:modelValue":a[8]||(a[8]=e=>H.value.status=e),"active-value":1,"inactive-value":0},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["title","modelValue"])])}}}),[["__scopeId","data-v-3edc2436"]]);export{S as default};
