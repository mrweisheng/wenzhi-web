import{g as Y,d as Z,u as $,c as ee,a as le}from"./role-8XEJkv6K.js";import{f as ae}from"./format-DZvyx3OM.js";import{g as te}from"./menu-DPOIiJzM.js";import{a as oe}from"./date-CLpD1YEj.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as t,m as re,n as ne,c as D,e as a,t as ie,f as _,w as o,p as I,s as de,b as i,I as ue,o as k,h as d,x as L,g as ce,A as me,E as g}from"./index-4kIbEQav.js";const pe={class:"app-container"},fe={key:0,class:"fullscreen-loading"},ve={class:"toolbar"},_e={class:"permission-content"},ge={class:"permission-header"},ye={class:"dialog-footer"},ke={__name:"index",setup(be){const b=t(!1),w=t([]),u=t(!1),x=t(""),m=t(!1),c=t(!1),p=t(),n=t({role_name:"",description:"",menu_ids:[]}),P={role_name:[{required:!0,message:"请输入角色名称",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}]},T=t({page:1,pageSize:10,role_name:"",startTime:"",endTime:""}),C=async()=>{try{b.value=!0;const l=await Y();w.value=Array.isArray(l.data.data)?l.data.data:[]}catch(l){console.error("Get roles error:",l),w.value=[]}finally{b.value=!1}},U=()=>{x.value="新增角色",u.value=!0},F=l=>{x.value="编辑角色",n.value={...l},u.value=!0},q=async l=>{try{await me.confirm("确认删除该角色吗？","提示",{type:"warning"}),await Z(l.id),g.success("删除成功"),C()}catch(e){console.error("Delete role error:",e)}},G=async()=>{if(p.value){await p.value.validate();try{c.value=!0,n.value.id?(await $(n.value.id,n.value),g.success("更新成功")):(await ee(n.value),g.success("创建成功")),u.value=!1,C()}catch(l){console.error("Submit role error:",l)}finally{c.value=!1}}},K=()=>{p.value&&p.value.resetFields(),n.value={role_name:"",description:"",menu_ids:[]}},R=t(),h=t([]),M=t([]),y=t(),A=t(""),B=t(!1),V=t(!1),z=async l=>{try{V.value=!0,y.value=l.id,A.value=l.role_name;const[e,f]=await Promise.all([te(),le(l.id)]);Array.isArray(e.data.data)?h.value=e.data.data:(h.value=[],console.error("返回的菜单数据格式不正确")),M.value=f.data.data.map(r=>r.id),m.value=!0}catch(e){console.error("Get role menus error:",e),g.error("获取权限数据失败")}finally{V.value=!1}},j=async()=>{if(!(!y.value||!R.value))try{c.value=!0;const l=R.value.getCheckedKeys();console.log("选中的权限:",l),await $(y.value,{menu_ids:l}),g.success("权限设置成功"),m.value=!1}catch(l){console.error("Update role permissions error:",l)}finally{c.value=!1}},H=t();return re(H,l=>{const{startTime:e,endTime:f}=oe(l);T.value.startTime=e,T.value.endTime=f}),ne(()=>{C()}),(l,e)=>{const f=i("el-loading"),r=i("el-button"),v=i("el-table-column"),J=i("el-table"),O=i("el-input"),Q=i("el-form-item"),W=i("el-form"),E=i("el-dialog"),X=i("el-tree"),N=ue("loading");return k(),D("div",pe,[V.value?(k(),D("div",fe,[a(f,{visible:!0,fullscreen:"",text:"正在加载权限数据...",background:"rgba(0, 0, 0, 0.7)"})])):ie("",!0),_("div",ve,[a(r,{type:"primary",onClick:U},{default:o(()=>e[5]||(e[5]=[d("新增角色")])),_:1})]),I((k(),de(J,{data:w.value,style:{width:"100%","margin-top":"20px"},"row-key":s=>s.id,"tree-props":{children:"children"}},{default:o(()=>[a(v,{prop:"id",label:"ID",width:"80"}),a(v,{prop:"role_name",label:"角色名称"}),a(v,{prop:"description",label:"描述"}),a(v,{prop:"created_at",label:"创建时间",width:"180"},{default:o(({row:s})=>[d(L(ce(ae)(s.created_at)),1)]),_:1}),a(v,{label:"操作",width:"250",fixed:"right"},{default:o(({row:s})=>[a(r,{type:"primary",link:"",onClick:S=>F(s)},{default:o(()=>e[6]||(e[6]=[d("编辑")])),_:2},1032,["onClick"]),a(r,{type:"primary",link:"",onClick:S=>z(s),loading:B.value&&y.value===s.id},{default:o(()=>e[7]||(e[7]=[d(" 权限设置 ")])),_:2},1032,["onClick","loading"]),a(r,{type:"danger",link:"",onClick:S=>q(s)},{default:o(()=>e[8]||(e[8]=[d("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","row-key"])),[[N,b.value]]),a(E,{title:x.value,modelValue:u.value,"onUpdate:modelValue":e[2]||(e[2]=s=>u.value=s),width:"500px",onClose:K},{footer:o(()=>[a(r,{onClick:e[1]||(e[1]=s=>u.value=!1)},{default:o(()=>e[9]||(e[9]=[d("取消")])),_:1}),a(r,{type:"primary",onClick:G,loading:c.value},{default:o(()=>e[10]||(e[10]=[d(" 确定 ")])),_:1},8,["loading"])]),default:o(()=>[a(W,{ref_key:"formRef",ref:p,model:n.value,rules:P,"label-width":"80px"},{default:o(()=>[a(Q,{label:"角色名称",prop:"role_name"},{default:o(()=>[a(O,{modelValue:n.value.role_name,"onUpdate:modelValue":e[0]||(e[0]=s=>n.value.role_name=s),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),a(E,{title:"权限设置",modelValue:m.value,"onUpdate:modelValue":e[4]||(e[4]=s=>m.value=s),width:"500px","close-on-click-modal":!1,"destroy-on-close":!0,class:"permission-dialog"},{footer:o(()=>[_("div",ye,[a(r,{onClick:e[3]||(e[3]=s=>m.value=!1)},{default:o(()=>e[12]||(e[12]=[d("取消")])),_:1}),a(r,{type:"primary",onClick:j,loading:c.value},{default:o(()=>e[13]||(e[13]=[d(" 保存权限设置 ")])),_:1},8,["loading"])])]),default:o(()=>[I((k(),D("div",_e,[_("div",ge,[_("h3",null,'为角色 "'+L(A.value)+'" 分配权限',1),e[11]||(e[11]=_("p",{class:"permission-tip"},"请选择该角色可访问的菜单和功能",-1))]),a(X,{ref_key:"treeRef",ref:R,data:h.value,"show-checkbox":"","node-key":"id",props:{label:"name"},"default-checked-keys":M.value,class:"permission-tree",style:{"max-height":"400px","overflow-y":"auto"}},null,8,["data","default-checked-keys"])])),[[N,B.value]])]),_:1},8,["modelValue"])])}}},De=se(ke,[["__scopeId","data-v-34ef454e"]]);export{De as default};
//# sourceMappingURL=index-BGMiNgFH.js.map
