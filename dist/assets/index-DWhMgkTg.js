import{G as I,d as ve,a as ge,r as c,a6 as A,m as we,n as be,b as i,I as Ve,o as k,c as F,f as d,e,w as l,M as ye,h as v,g as m,p as he,s as K,x as h,F as xe,q as Ce,E as g,a7 as ke,a8 as P,a9 as j,aa as G,ab as Ue,ac as Ye,i as De,t as Se,Y as Me,ad as Q,a0 as ze,ae as Ne}from"./index-4kIbEQav.js";import{h as Le}from"./writer-BQAS4UPm.js";import{_ as Oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";function qe(U){return I({url:"/api/customer-orders",method:"post",data:U})}function Fe(U){return I({url:"/api/customer-orders",method:"get",params:U})}function J(){return I({url:"/api/customer-orders/merge",method:"post"})}const Ie={class:"app-container"},Ee={class:"toolbar"},Te={class:"action-buttons"},Be={class:"pagination-container"},He={class:"form-section"},Re={class:"section-header"},We={class:"option-with-icon"},$e={class:"option-with-icon"},Ae={class:"writer-option"},Ke={key:0,class:"writer-id"},Pe={class:"option-with-icon"},je={class:"option-with-icon"},Ge={class:"form-section"},Qe={class:"section-header"},Je={class:"form-section"},Xe={class:"section-header"},Ze={class:"dialog-footer"},el=ve({__name:"index",setup(U){var W;const E=ge(),x=c(),z=c(!1),N=c(!1),L=c(!1),O=c(!1),b=c(!1),Y=c("新增订单"),D=c(null),r=A({page:1,pageSize:10}),T=c([]),B=c(0),H=c([]),n=c({order_id:"",date:new Date().toISOString().split("T")[0],is_fixed:0,new_customer:0,customer_id:(W=E.userInfo)==null?void 0:W.id}),X=A({order_id:[{required:!0,message:"请输入订单编号",trigger:"blur"}],date:[{required:!0,message:"请选择日期",trigger:"change"}],is_fixed:[{required:!0,message:"请选择是否定稿",trigger:"change"}],writer_id:[{required:!0,message:"请选择写手",trigger:"change"}]});we(D,o=>{o?(r.date_start=o[0],r.date_end=o[1]):(r.date_start=void 0,r.date_end=void 0)});const Z=o=>o?new Date(o).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"-",V=async()=>{try{z.value=!0;const{data:o}=await Fe(r);o.data&&(T.value=o.data.list||[],B.value=o.data.total||0)}catch(o){console.error("获取订单列表失败:",o),g.error("获取订单列表失败")}finally{z.value=!1}},ee=async()=>{try{O.value=!0;const{data:o}=await Le();H.value=o.data||[]}catch(o){console.error("获取写手列表失败:",o),g.error("获取写手列表失败")}finally{O.value=!1}},R=()=>{r.page=1,V()},le=()=>{r.order_id=void 0,r.is_fixed=void 0,D.value=null,r.date_start=void 0,r.date_end=void 0,r.page=1,V()},te=o=>{r.page=o,V()},ae=o=>{r.pageSize=o,r.page=1,V()},oe=()=>{Y.value="新增订单",ue(),b.value=!0},ne=o=>{Y.value="编辑订单",n.value={...o,is_fixed:Number(o.is_fixed),new_customer:Number(o.new_customer||0),writer_id:o.writer_id||void 0},b.value=!0},de=o=>{Y.value="查看订单",n.value={...o,is_fixed:Number(o.is_fixed),new_customer:Number(o.new_customer||0),writer_id:o.writer_id||void 0},b.value=!0},re=async()=>{var o,t;if(x.value)try{await x.value.validate(),N.value=!0,await qe(n.value),g.success("订单提交成功"),b.value=!1,V();try{const s=await J();s.data.code===0?g.success("订单已同步到总表"):console.warn("订单同步返回信息:",s.data.message)}catch(s){console.error("同步订单到总表失败:",s),g.warning("订单已创建，但同步到总表失败，请稍后手动同步")}}catch(s){console.error("提交订单失败:",s),g.error(((t=(o=s.response)==null?void 0:o.data)==null?void 0:t.message)||"提交订单失败")}finally{N.value=!1}},se=async()=>{var o,t;try{L.value=!0;const s=await J();s.data.code===0?(g.success(`同步成功，共处理 ${s.data.data.total} 条订单`),V()):g.info(s.data.message||"没有需要同步的订单")}catch(s){console.error("同步订单失败:",s),g.error(((t=(o=s.response)==null?void 0:o.data)==null?void 0:t.message)||"同步订单失败")}finally{L.value=!1}},ue=()=>{var o;x.value&&x.value.resetFields(),n.value={order_id:"",date:new Date().toISOString().split("T")[0],is_fixed:0,new_customer:0,customer_id:(o=E.userInfo)==null?void 0:o.id,writer_id:void 0}};return be(()=>{V(),ee()}),(o,t)=>{const s=i("el-input"),u=i("el-form-item"),q=i("el-date-picker"),y=i("el-option"),S=i("el-select"),w=i("el-button"),$=i("el-form"),p=i("el-icon"),f=i("el-table-column"),ie=i("el-tag"),pe=i("el-table"),_e=i("el-pagination"),_=i("el-col"),C=i("el-row"),M=i("el-input-number"),me=i("el-dialog"),fe=Ve("loading");return k(),F("div",Ie,[d("div",Ee,[e($,{inline:!0,model:r,class:"search-form"},{default:l(()=>[e(u,{label:"订单编号"},{default:l(()=>[e(s,{modelValue:r.order_id,"onUpdate:modelValue":t[0]||(t[0]=a=>r.order_id=a),placeholder:"请输入订单编号",clearable:"",onKeyup:ye(R,["enter"])},null,8,["modelValue"])]),_:1}),e(u,{label:"日期范围"},{default:l(()=>[e(q,{modelValue:D.value,"onUpdate:modelValue":t[1]||(t[1]=a=>D.value=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(u,{label:"是否定稿"},{default:l(()=>[e(S,{modelValue:r.is_fixed,"onUpdate:modelValue":t[2]||(t[2]=a=>r.is_fixed=a),placeholder:"请选择",clearable:""},{default:l(()=>[e(y,{value:0,label:"未定稿"}),e(y,{value:1,label:"已定稿"})]),_:1},8,["modelValue"])]),_:1}),e(u,null,{default:l(()=>[e(w,{type:"primary",onClick:R},{default:l(()=>t[22]||(t[22]=[v("搜索")])),_:1}),e(w,{onClick:le},{default:l(()=>t[23]||(t[23]=[v("重置")])),_:1})]),_:1})]),_:1},8,["model"]),d("div",Te,[e(w,{type:"primary",onClick:oe},{default:l(()=>t[24]||(t[24]=[v("新增订单")])),_:1}),e(w,{type:"success",onClick:se,loading:L.value},{default:l(()=>[e(p,{class:"mr-1"},{default:l(()=>[e(m(ke))]),_:1}),t[25]||(t[25]=v("同步订单 "))]),_:1},8,["loading"])])]),he((k(),K(pe,{data:T.value,style:{width:"100%","margin-top":"20px"}},{default:l(()=>[e(f,{prop:"order_id",label:"订单编号",width:"150"}),e(f,{prop:"date",label:"日期",width:"120"}),e(f,{label:"是否定稿",width:"100"},{default:l(({row:a})=>[e(ie,{type:a.is_fixed===1?"success":"warning"},{default:l(()=>[v(h(a.is_fixed===1?"已定稿":"未定稿"),1)]),_:2},1032,["type"])]),_:1}),e(f,{prop:"customer_service_name",label:"客服",width:"120"}),e(f,{prop:"writer_name",label:"写手",width:"120"}),e(f,{prop:"word_count",label:"字数",width:"100"}),e(f,{label:"稿费",width:"100"},{default:l(({row:a})=>[v(" ¥"+h(a.fee),1)]),_:1}),e(f,{label:"订单金额",width:"120"},{default:l(({row:a})=>[v(" ¥"+h(a.order_amount),1)]),_:1}),e(f,{prop:"payment_channel",label:"付款渠道",width:"120"}),e(f,{prop:"store_name",label:"店铺/客户",width:"150"}),e(f,{prop:"customer_name",label:"客户名称",width:"150"}),e(f,{label:"创建时间",width:"180"},{default:l(({row:a})=>[v(h(Z(a.created_at)),1)]),_:1}),e(f,{label:"操作",width:"150",fixed:"right"},{default:l(({row:a})=>[e(w,{type:"primary",link:"",onClick:ce=>ne(a)},{default:l(()=>t[26]||(t[26]=[v("编辑")])),_:2},1032,["onClick"]),e(w,{type:"primary",link:"",onClick:ce=>de(a)},{default:l(()=>t[27]||(t[27]=[v("查看")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[fe,z.value]]),d("div",Be,[e(_e,{"current-page":r.page,"onUpdate:currentPage":t[3]||(t[3]=a=>r.page=a),"page-size":r.pageSize,"onUpdate:pageSize":t[4]||(t[4]=a=>r.pageSize=a),"page-sizes":[10,20,50,100],total:B.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ae,onCurrentChange:te},null,8,["current-page","page-size","total"])]),e(me,{title:Y.value,modelValue:b.value,"onUpdate:modelValue":t[21]||(t[21]=a=>b.value=a),width:"80%","close-on-click-modal":!1,"destroy-on-close":!0,class:"order-dialog"},{footer:l(()=>[d("div",Ze,[e(w,{onClick:t[20]||(t[20]=a=>b.value=!1)},{default:l(()=>[e(p,null,{default:l(()=>[e(m(P))]),_:1}),t[35]||(t[35]=d("span",null,"取消",-1))]),_:1}),e(w,{type:"primary",onClick:re,loading:N.value},{default:l(()=>[e(p,null,{default:l(()=>[e(m(j))]),_:1}),t[36]||(t[36]=d("span",null,"确认",-1))]),_:1},8,["loading"])])]),default:l(()=>[e($,{ref_key:"formRef",ref:x,model:n.value,rules:X,"label-width":"120px",class:"order-form"},{default:l(()=>[d("div",He,[d("div",Re,[e(p,{class:"section-icon"},{default:l(()=>[e(m(G))]),_:1}),t[28]||(t[28]=d("div",{class:"section-title"},"基本信息",-1))]),e(C,{gutter:24},{default:l(()=>[e(_,{span:8},{default:l(()=>[e(u,{label:"订单编号",prop:"order_id"},{default:l(()=>[e(s,{modelValue:n.value.order_id,"onUpdate:modelValue":t[5]||(t[5]=a=>n.value.order_id=a),placeholder:"请输入订单编号","prefix-icon":"Ticket"},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:8},{default:l(()=>[e(u,{label:"日期",prop:"date"},{default:l(()=>[e(q,{modelValue:n.value.date,"onUpdate:modelValue":t[6]||(t[6]=a=>n.value.date=a),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:8},{default:l(()=>[e(u,{label:"是否定稿",prop:"is_fixed"},{default:l(()=>[e(S,{modelValue:n.value.is_fixed,"onUpdate:modelValue":t[7]||(t[7]=a=>n.value.is_fixed=a),placeholder:"请选择",style:{width:"100%"}},{default:l(()=>[e(y,{value:0,label:"未定稿"},{default:l(()=>[d("div",We,[e(p,null,{default:l(()=>[e(m(Ue))]),_:1}),t[29]||(t[29]=d("span",null,"未定稿",-1))])]),_:1}),e(y,{value:1,label:"已定稿"},{default:l(()=>[d("div",$e,[e(p,null,{default:l(()=>[e(m(Ye))]),_:1}),t[30]||(t[30]=d("span",null,"已定稿",-1))])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(C,{gutter:24},{default:l(()=>[e(_,{span:8},{default:l(()=>[e(u,{label:"写手",prop:"writer_id"},{default:l(()=>[e(S,{modelValue:n.value.writer_id,"onUpdate:modelValue":t[8]||(t[8]=a=>n.value.writer_id=a),placeholder:"请选择写手",filterable:"",clearable:"",style:{width:"100%"},loading:O.value},{prefix:l(()=>[e(p,null,{default:l(()=>[e(m(De))]),_:1})]),default:l(()=>[(k(!0),F(xe,null,Ce(H.value,a=>(k(),K(y,{key:a.id,label:a.name,value:a.id},{default:l(()=>[d("div",Ae,[d("span",null,h(a.name),1),a.writer_id?(k(),F("span",Ke,"("+h(a.writer_id)+")",1)):Se("",!0)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1})]),_:1}),e(_,{span:8},{default:l(()=>[e(u,{label:"交稿时间",prop:"exchange_time"},{default:l(()=>[e(q,{modelValue:n.value.exchange_time,"onUpdate:modelValue":t[9]||(t[9]=a=>n.value.exchange_time=a),type:"datetime",placeholder:"选择交稿时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:8},{default:l(()=>[e(u,{label:"是否新客户",prop:"new_customer"},{default:l(()=>[e(S,{modelValue:n.value.new_customer,"onUpdate:modelValue":t[10]||(t[10]=a=>n.value.new_customer=a),placeholder:"请选择",style:{width:"100%"}},{default:l(()=>[e(y,{value:0,label:"否"},{default:l(()=>[d("div",Pe,[e(p,null,{default:l(()=>[e(m(P))]),_:1}),t[31]||(t[31]=d("span",null,"否",-1))])]),_:1}),e(y,{value:1,label:"是"},{default:l(()=>[d("div",je,[e(p,null,{default:l(()=>[e(m(j))]),_:1}),t[32]||(t[32]=d("span",null,"是",-1))])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(C,{gutter:24},{default:l(()=>[e(_,{span:8},{default:l(()=>[e(u,{label:"付款渠道",prop:"payment_channel"},{default:l(()=>[e(s,{modelValue:n.value.payment_channel,"onUpdate:modelValue":t[11]||(t[11]=a=>n.value.payment_channel=a),placeholder:"请输入付款渠道","prefix-icon":"Money"},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:8},{default:l(()=>[e(u,{label:"店铺/客户",prop:"store_name"},{default:l(()=>[e(s,{modelValue:n.value.store_name,"onUpdate:modelValue":t[12]||(t[12]=a=>n.value.store_name=a),placeholder:"请输入店铺名或客户线下","prefix-icon":"Shop"},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:8},{default:l(()=>[e(u,{label:"客户名称",prop:"customer_name"},{default:l(()=>[e(s,{modelValue:n.value.customer_name,"onUpdate:modelValue":t[13]||(t[13]=a=>n.value.customer_name=a),placeholder:"请输入客户名称","prefix-icon":"Avatar"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),d("div",Ge,[d("div",Qe,[e(p,{class:"section-icon"},{default:l(()=>[e(m(G))]),_:1}),t[33]||(t[33]=d("div",{class:"section-title"},"稿件信息",-1))]),e(C,{gutter:24},{default:l(()=>[e(_,{span:8},{default:l(()=>[e(u,{label:"稿件字数",prop:"word_count"},{default:l(()=>[e(M,{modelValue:n.value.word_count,"onUpdate:modelValue":t[14]||(t[14]=a=>n.value.word_count=a),min:0,"controls-position":"right",style:{width:"100%"},placeholder:"请输入稿件字数"},{prefix:l(()=>[e(p,null,{default:l(()=>[e(m(Me))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(_,{span:8},{default:l(()=>[e(u,{label:"稿费",prop:"fee"},{default:l(()=>[e(M,{modelValue:n.value.fee,"onUpdate:modelValue":t[15]||(t[15]=a=>n.value.fee=a),min:0,precision:2,step:.01,"controls-position":"right",style:{width:"100%"},placeholder:"请输入稿费"},{prefix:l(()=>[e(p,null,{default:l(()=>[e(m(Q))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(_,{span:8},{default:l(()=>[e(u,{label:"稿件内容",prop:"order_content"},{default:l(()=>[e(s,{modelValue:n.value.order_content,"onUpdate:modelValue":t[16]||(t[16]=a=>n.value.order_content=a),type:"textarea",rows:2,placeholder:"请输入稿件内容信息"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),d("div",Je,[d("div",Xe,[e(p,{class:"section-icon"},{default:l(()=>[e(m(ze))]),_:1}),t[34]||(t[34]=d("div",{class:"section-title"},"支付信息",-1))]),e(C,{gutter:24},{default:l(()=>[e(_,{span:8},{default:l(()=>[e(u,{label:"订单金额",prop:"order_amount"},{default:l(()=>[e(M,{modelValue:n.value.order_amount,"onUpdate:modelValue":t[17]||(t[17]=a=>n.value.order_amount=a),min:0,precision:2,step:.01,"controls-position":"right",style:{width:"100%"},placeholder:"请输入订单金额"},{prefix:l(()=>[e(p,null,{default:l(()=>[e(m(Q))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(_,{span:8},{default:l(()=>[e(u,{label:"退款金额",prop:"refund_amount"},{default:l(()=>[e(M,{modelValue:n.value.refund_amount,"onUpdate:modelValue":t[18]||(t[18]=a=>n.value.refund_amount=a),min:0,precision:2,step:.01,"controls-position":"right",style:{width:"100%"},placeholder:"请输入退款金额"},{prefix:l(()=>[e(p,null,{default:l(()=>[e(m(Ne))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(_,{span:8},{default:l(()=>[e(u,{label:"特殊情况",prop:"special_situation"},{default:l(()=>[e(s,{modelValue:n.value.special_situation,"onUpdate:modelValue":t[19]||(t[19]=a=>n.value.special_situation=a),placeholder:"请输入特殊情况(不结算)","prefix-icon":"Warning"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})])]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}}),ol=Oe(el,[["__scopeId","data-v-0c3bf169"]]);export{ol as default};
//# sourceMappingURL=index-DWhMgkTg.js.map
