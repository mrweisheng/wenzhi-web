import{G as j,d as ge,r as d,m as Y,af as ye,n as be,b as u,I as he,o as h,c as x,f as s,e as l,w as o,M as q,F as K,q as P,h as r,p as we,s as W,x as m,g as $,t as Ce,E as w,P as Ve}from"./index-4kIbEQav.js";import{f as ke}from"./user-D0IfgbUA.js";import{h as xe}from"./writer-BQAS4UPm.js";import{f as I}from"./format-DZvyx3OM.js";import{_ as Se}from"./_plugin-vue_export-helper-DlAUqK2U.js";function Fe(V){return j({url:"/api/orders",method:"get",params:V})}function ze(V){return j({url:"/api/orders/process",method:"post",headers:{"Content-Type":"multipart/form-data"},data:V})}const Le={class:"app-container"},Te={class:"toolbar"},Me={class:"form-item-group"},De={class:"form-item-group"},Ue={class:"pagination-container"},Ee={class:"update-dialog-content"},Re={class:"channel-select"},Oe={class:"channel-buttons"},Be=["onClick"],Ne={class:"channel-icon"},Ye={class:"channel-name"},qe={class:"file-upload"},Ke={key:1,class:"multi-upload"},Pe=ge({__name:"index",setup(V){const S=d(!1),M=d([]),D=d(0),n=d({page:1,pageSize:10,order_id:"",payment_id:"",channel:"",startTime:"",endTime:""}),k=d(),U=d([]),E=d(!1),R=d([]),O=d(!1),y=async()=>{try{S.value=!0;const{data:t}=await Fe(n.value),{list:e,total:p}=t.data;M.value=e,D.value=p}catch(t){console.error("获取订单列表失败:",t)}finally{S.value=!1}};Y(k,t=>{t&&t[0]&&t[1]?(n.value.startTime=String(t[0]),n.value.endTime=String(t[1])):(n.value.startTime="",n.value.endTime="")});const A=[{value:"",label:"全部"},{value:"支付宝",label:"支付宝"},{value:"企业微信",label:"企业微信"},{value:"匠易艺",label:"匠易艺"},{value:"慧辞",label:"慧辞"}],G=t=>({paid:"success",pending:"warning",cancelled:"danger",refunded:"info",completed:"success"})[t]||"info",Q=t=>({pending:"待支付",paid:"已支付",completed:"已完成",refunded:"已退款",cancelled:"已取消"})[t]||t,H=t=>({"":"全部",支付宝:"支付宝",企业微信:"企业微信",匠易艺:"匠易艺",慧辞:"慧辞"})[t]||t,F=()=>{n.value.page=1,y()},J=()=>{n.value={page:1,pageSize:10,order_id:"",payment_id:"",channel:"",startTime:"",endTime:""},k.value=void 0,y()},X=t=>{n.value.pageSize=t,y()},Z=t=>{n.value.page=t,y()},C=d(!1),c=d(""),v=d(null),g=d(null),z=d(!1),ee=()=>{C.value=!0,c.value="",v.value=null,g.value=null},B=(t,e)=>{v.value=t.raw},ae=(t,e)=>{g.value=t.raw},N=ye(()=>c.value?["支付宝","企业微信"].includes(c.value)?!!v.value:["慧辞","匠易艺"].includes(c.value)?!!v.value&&!!g.value:!1:!1);Y(c,()=>{v.value=null,g.value=null,document.querySelectorAll(".el-upload__input").forEach(e=>{e.value=""})});const le=async()=>{var t,e;if(N.value)try{if(z.value=!0,!v.value){w.error("请选择订单文件");return}if(["慧辞","匠易艺"].includes(c.value)&&!g.value){w.error("请选择退款文件");return}const p=new FormData;p.append("channel",c.value),p.append("order_file",v.value),g.value&&p.append("refund_file",g.value);const{data:f}=await ze(p);w.success("处理成功"),C.value=!1,y()}catch(p){console.error("处理订单失败:",p);const f=((e=(t=p.response)==null?void 0:t.data)==null?void 0:e.message)||"处理失败，请稍后重试";w.error(f)}finally{z.value=!1}},te=["支付宝","企业微信","慧辞","匠易艺"],oe=async()=>{try{E.value=!0;const{data:t}=await ke();U.value=t.data||[]}catch(t){console.error("获取客服列表失败:",t),w.error("获取客服列表失败")}finally{E.value=!1}},ne=async()=>{try{O.value=!0;const{data:t}=await xe();R.value=t.data||[]}catch(t){console.error("获取写手列表失败:",t),w.error("获取写手列表失败")}finally{O.value=!1}};return be(()=>{y(),oe(),ne()}),(t,e)=>{const p=u("el-input"),f=u("el-form-item"),se=u("el-option"),re=u("el-select"),ue=u("el-date-picker"),_=u("el-button"),de=u("el-form"),i=u("el-table-column"),ie=u("el-tag"),pe=u("el-table"),ce=u("el-pagination"),me=u("Money"),fe=u("el-icon"),L=u("el-upload"),_e=u("el-dialog"),ve=he("loading");return h(),x("div",Le,[s("div",Te,[l(de,{inline:!0,model:n.value,class:"search-form"},{default:o(()=>[s("div",Me,[l(f,{label:"订单编号"},{default:o(()=>[l(p,{modelValue:n.value.order_id,"onUpdate:modelValue":e[0]||(e[0]=a=>n.value.order_id=a),placeholder:"请输入",clearable:"",onKeyup:q(F,["enter"])},null,8,["modelValue"])]),_:1}),l(f,{label:"支付单号"},{default:o(()=>[l(p,{modelValue:n.value.payment_id,"onUpdate:modelValue":e[1]||(e[1]=a=>n.value.payment_id=a),placeholder:"请输入",clearable:"",onKeyup:q(F,["enter"])},null,8,["modelValue"])]),_:1}),l(f,{label:"订单渠道"},{default:o(()=>[l(re,{modelValue:n.value.channel,"onUpdate:modelValue":e[2]||(e[2]=a=>n.value.channel=a),placeholder:"请选择",clearable:"",filterable:""},{default:o(()=>[(h(),x(K,null,P(A,a=>l(se,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),s("div",De,[l(f,{label:"创建时间"},{default:o(()=>[l(ue,{modelValue:k.value,"onUpdate:modelValue":e[3]||(e[3]=a=>k.value=a),type:"daterange","value-format":"YYYY-MM-DD","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])]),_:1}),l(f,null,{default:o(()=>[l(_,{type:"primary",onClick:F},{default:o(()=>e[8]||(e[8]=[r("搜索")])),_:1}),l(_,{onClick:J},{default:o(()=>e[9]||(e[9]=[r("重置")])),_:1}),l(_,{type:"success",onClick:ee},{default:o(()=>e[10]||(e[10]=[r("更新订单")])),_:1})]),_:1})])]),_:1},8,["model"])]),we((h(),W(pe,{data:M.value,style:{width:"100%","margin-top":"20px"}},{default:o(()=>[l(i,{prop:"order_id",label:"订单编号",width:"180"}),l(i,{prop:"payment_id",label:"支付单号",width:"180"}),l(i,{prop:"customer",label:"客服",width:"120"},{default:o(({row:a})=>{var b;return[s("span",null,m(((b=U.value.find(T=>T.id===a.customer_id))==null?void 0:b.username)||"暂无"),1)]}),_:1}),l(i,{prop:"writer",label:"写手",width:"120"},{default:o(({row:a})=>{var b;return[s("span",null,m(((b=R.value.find(T=>T.id===a.writer_id))==null?void 0:b.name)||"暂无"),1)]}),_:1}),l(i,{prop:"amount",label:"买家实付金额",width:"120"},{default:o(({row:a})=>[r(" ¥"+m(parseFloat(a.amount).toFixed(2)),1)]),_:1}),l(i,{prop:"status",label:"订单状态",width:"100"},{default:o(({row:a})=>[l(ie,{type:G(a.status)},{default:o(()=>[r(m(Q(a.status)),1)]),_:2},1032,["type"])]),_:1}),l(i,{prop:"channel",label:"订单渠道",width:"100"},{default:o(({row:a})=>[r(m(H(a.channel)),1)]),_:1}),l(i,{prop:"refund_amount",label:"退款金额",width:"120"},{default:o(({row:a})=>[r(" ¥"+m(parseFloat(a.refund_amount).toFixed(2)),1)]),_:1}),l(i,{prop:"fee",label:"手续费",width:"120"},{default:o(({row:a})=>[r(" ¥"+m(parseFloat(a.fee).toFixed(2)),1)]),_:1}),l(i,{prop:"merchant_payment",label:"打款商家金额",width:"120"},{default:o(({row:a})=>[r(" ¥"+m(parseFloat(a.merchant_payment).toFixed(2)),1)]),_:1}),l(i,{prop:"create_time",label:"创建时间",width:"180"},{default:o(({row:a})=>[r(m($(I)(a.create_time)),1)]),_:1}),l(i,{prop:"confirm_time",label:"确认收货时间",width:"180"},{default:o(({row:a})=>[r(m($(I)(a.confirm_time)),1)]),_:1}),l(i,{prop:"merchant_remark",label:"商家备注","min-width":"200"})]),_:1},8,["data"])),[[ve,S.value]]),s("div",Ue,[l(ce,{"current-page":n.value.page,"onUpdate:currentPage":e[4]||(e[4]=a=>n.value.page=a),"page-size":n.value.pageSize,"onUpdate:pageSize":e[5]||(e[5]=a=>n.value.pageSize=a),"page-sizes":[10,20,50,100],total:D.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:X,onCurrentChange:Z},null,8,["current-page","page-size","total"])]),l(_e,{title:"更新订单",modelValue:C.value,"onUpdate:modelValue":e[7]||(e[7]=a=>C.value=a),width:"800px","close-on-click-modal":!1,class:"update-dialog"},{footer:o(()=>[l(_,{onClick:e[6]||(e[6]=a=>C.value=!1)},{default:o(()=>e[19]||(e[19]=[r("取消")])),_:1}),l(_,{type:"primary",onClick:le,loading:z.value,disabled:!N.value},{default:o(()=>e[20]||(e[20]=[r(" 确定更新 ")])),_:1},8,["loading","disabled"])]),default:o(()=>[s("div",Ee,[s("div",Re,[e[11]||(e[11]=s("h3",null,"选择渠道",-1)),s("div",Oe,[(h(),x(K,null,P(te,a=>s("div",{key:a,class:Ve(["channel-button",{active:c.value===a}]),onClick:b=>c.value=a},[s("span",Ne,[l(fe,null,{default:o(()=>[l(me)]),_:1})]),s("span",Ye,m(a),1)],10,Be)),64))])]),s("div",qe,[e[18]||(e[18]=s("h3",null,"上传文件",-1)),["支付宝","企业微信"].includes(c.value)?(h(),W(L,{key:0,ref:"uploadRef",class:"upload-area",action:"#","auto-upload":!1,limit:1,"on-change":B},{trigger:o(()=>[l(_,{type:"primary"},{default:o(()=>e[12]||(e[12]=[r("选择订单文件")])),_:1})]),tip:o(()=>e[13]||(e[13]=[s("div",{class:"el-upload__tip"}," 请选择 Excel 格式的订单文件 ",-1)])),_:1},512)):["慧辞","匠易艺"].includes(c.value)?(h(),x("div",Ke,[l(L,{ref:"uploadRef",class:"upload-area",action:"#","auto-upload":!1,limit:1,"on-change":B},{trigger:o(()=>[l(_,{type:"primary"},{default:o(()=>e[14]||(e[14]=[r("选择订单文件")])),_:1})]),tip:o(()=>e[15]||(e[15]=[s("div",{class:"el-upload__tip"}," 请选择 Excel 格式的订单文件 ",-1)])),_:1},512),l(L,{class:"upload-area",action:"#","auto-upload":!1,limit:1,"on-change":ae},{trigger:o(()=>[l(_,{type:"primary"},{default:o(()=>e[16]||(e[16]=[r("选择退款文件")])),_:1})]),tip:o(()=>e[17]||(e[17]=[s("div",{class:"el-upload__tip"}," 请选择 Excel 格式的退款文件 ",-1)])),_:1})])):Ce("",!0)])])]),_:1},8,["modelValue"])])}}}),Ge=Se(Pe,[["__scopeId","data-v-bca7c8cf"]]);export{Ge as default};
//# sourceMappingURL=index-CWlS9E-R.js.map
