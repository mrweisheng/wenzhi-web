import{x as e,r as a,c as l,k as s,S as t,ag as i,y as d,z as r,A as u,P as n,H as c,u as o,a5 as v,L as m,O as p,a4 as g,K as f,M as y,G as b,C as x}from"./vendor-BVd4RN3d.js";import{f as h}from"./format-B5gz6Uyj.js";import{E as w,X as _,B as V,U as k}from"./element-plus-CCDyQ1z5.js";import{a as z,g as j,b as S,c as U,d as C}from"./issues-GyIFwyiA.js";import{u as H}from"./index-CFSbY6bd.js";import{_ as M}from"./_plugin-vue_export-helper-BCo6x5W8.js";const q={class:"app-container"},T={class:"search-area bg-white rounded-lg p-3"},Y={class:"flex items-center space-x-4"},D={key:0,class:"flex justify-center items-center py-12"},$={key:1,class:"flex flex-col justify-center items-center py-20"},A={key:2,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3 gap-6"},L=["onClick"],N={class:"issue-card-content"},I={class:"issue-card-header"},E={class:"issue-id"},F={class:"issue-card-title"},K={class:"tags-group"},P={class:"time-section mb-4"},R={class:"time-tag create-time"},B={class:"status-flow-section mb-5"},G={class:"users-section"},O={class:"users-row"},X={class:"user-cell"},J={class:"user-info"},Q={class:"user-name"},W={class:"user-cell"},Z={class:"user-info"},ee={class:"user-name"},ae={key:3,class:"text-center py-4"},le={class:"loading-more"},se={key:0,class:"flex items-center space-x-4"},te={class:"text-2xl font-bold"},ie={key:1,class:"flex items-center space-x-4"},de={key:0,class:"flex justify-center items-center py-12"},re={key:1,class:"issue-detail space-y-6 p-6"},ue={class:"info-card bg-white rounded-lg p-6 shadow-sm"},ne={class:"flex items-center gap-3 mb-4"},ce={class:"issue-number font-mono text-gray-500 text-base"},oe={class:"text-xl font-semibold text-gray-900"},ve={class:"flex items-center justify-between mb-6"},me={class:"tags-row flex items-center gap-3"},pe={class:"tag-item"},ge={class:"tag-item"},fe={class:"issue-timeline mb-6"},ye={class:"timeline-item"},be={class:"timeline-content"},xe={class:"text-base font-medium"},he={class:"timeline-item"},we={class:"timeline-content"},_e={class:"deadline-info"},Ve={class:"text-base font-medium"},ke={class:"users-info"},ze={class:"flex justify-between items-start"},je={class:"user-box"},Se={class:"user-detail"},Ue={class:"user-info"},Ce={class:"user-name"},He={class:"user-box"},Me={class:"user-detail"},qe={class:"user-info"},Te={class:"user-name"},Ye={class:"info-card bg-white rounded-lg p-6 shadow-sm"},De={class:"description-content"},$e={class:"info-card bg-white rounded-lg p-6 shadow-sm"},Ae={class:"space-y-5"},Le={class:"chat-records"},Ne={class:"flex items-start gap-3"},Ie={class:"flex-grow"},Ee={class:"flex items-center justify-between mb-1"},Fe={class:"font-medium text-gray-900"},Ke={class:"text-sm text-gray-500"},Pe=["innerHTML"],Re={key:0,class:"add-record-section mt-8"},Be={class:"mb-5"},Ge={class:"status-selector mb-4"},Oe={class:"flex justify-end mt-5"},Xe={key:1,class:"text-center text-gray-500 py-8"},Je={class:"flex space-x-4"},Qe={class:"create-form"},We={class:"grid grid-cols-2 gap-4"},Ze={class:"user-option flex items-center justify-between w-full"},ea={class:"flex items-center"},aa={class:"user-name"},la={class:"user-role text-xs text-gray-500"},sa={class:"grid grid-cols-2 gap-4"},ta={class:"dialog-footer"},ia=M(e({__name:"index",setup(e){const M=a(!1),ia=a(!1),da=a(!1),ra=a(!1),ua=a(1),na=a(10),ca=a(0),oa=a(!1),va=a(!0),ma=a(""),pa=a(""),ga=a(!1),fa=a(null),ya=a(""),ba=a(""),xa=a(!1),ha=a(null),wa=a({title:"",priority:"medium",status:"pending",description:"",deadline:"",assignee:""}),_a={title:[{required:!0,message:"请输入问题标题",trigger:"blur"}],priority:[{required:!0,message:"请选择优先级",trigger:"change"}],assignee:[{required:!0,message:"请选择负责人",trigger:"change"}],deadline:[{required:!0,message:"请选择截止日期",trigger:"change"}],description:[{required:!0,message:"请输入问题描述",trigger:"blur"}]},Va=a([]),ka=a([]),za=H(),ja=l((()=>{var e;return(null==(e=za.userInfo)?void 0:e.id)||null})),Sa=l((()=>{var e,a;if(!fa.value||!ja.value)return!1;const l=Number(ja.value),s=(null==(e=fa.value.creator)?void 0:e.id)?Number(fa.value.creator.id):null,t=(null==(a=fa.value.assignee)?void 0:a.id)?Number(fa.value.assignee.id):null;return s===l||t===l})),Ua=e=>({1:"管理员",2:"普通用户",3:"技术人员"}[e]||"用户"),Ca=async()=>{M.value=!0;try{const e=await j({page:ua.value,pageSize:na.value,status:pa.value,keyword:ma.value});e.data&&e.data.data?e.data.data.items?(ka.value=e.data.data.items,ca.value=e.data.data.total,ua.value=e.data.data.currentPage,va.value=e.data.data.items.length===na.value):Array.isArray(e.data.data)?(ka.value=e.data.data,va.value=e.data.data.length===na.value):(ka.value=[],va.value=!1):(ka.value=[],va.value=!1)}catch(e){w.error("获取问题列表失败"),ka.value=[],va.value=!1}finally{M.value=!1}},Ha=async e=>{ia.value=!0;try{const a=await C(e);fa.value=a.data.data}catch(a){w.error("获取问题详情失败"),ga.value=!1}finally{ia.value=!1}},Ma=e=>{if(!e)return!1;const a=new Date(e),l=new Date,s=a.getTime()-l.getTime(),t=Math.ceil(s/864e5);return t>=0&&t<=7},qa=e=>{if(!e)return"未设置";const a=new Date(e);if(isNaN(a.getTime()))return e;return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")} ${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}`},Ta=e=>({pending:"info",processing:"warning",completed:"success"}[e]||"info"),Ya=e=>({pending:"待处理",processing:"处理中",completed:"已完成"}[e]||e),Da=e=>({high:"danger",medium:"warning",low:"info"}[e]||"info"),$a=e=>({high:"高优先级",medium:"中优先级",low:"低优先级"}[e]||e),Aa=e=>`https://api.dicebear.com/7.x/avataaars/svg?seed=${encodeURIComponent(e||"default")}`,La=()=>{Pa(),Ca()},Na=()=>{xa.value=!0},Ia=()=>{ga.value=!1},Ea=async()=>{if(fa.value&&ya.value&&ba.value){ra.value=!0;try{await S(fa.value.id,{content:ya.value,newStatus:ba.value});fa.value&&(fa.value.status=ba.value),await Ha(fa.value.id),ya.value="",ba.value="",w.success("添加处理记录成功")}catch(e){w.error("添加处理记录失败")}finally{ra.value=!1}}},Fa=async()=>{ha.value&&ha.value.validate((async e=>{var a;if(e){da.value=!0;try{let e=wa.value.deadline;e&&"object"==typeof e&&(e=qa(e)),await U({title:wa.value.title,priority:wa.value.priority,status:"pending",description:wa.value.description,deadline:e,assigneeId:wa.value.assignee}),Ca(),null==(a=ha.value)||a.resetFields(),xa.value=!1,w.success("创建问题成功")}catch(l){w.error("创建问题失败")}finally{da.value=!1}}}))},Ka=async e=>{const a=e.target;if(a.scrollHeight-a.scrollTop-a.clientHeight<100&&va.value&&!oa.value){oa.value=!0,ua.value++;try{const e=await j({page:ua.value,pageSize:na.value,status:pa.value,keyword:ma.value});e.data&&e.data.data?e.data.data.items&&e.data.data.items.length>0?(ka.value.push(...e.data.data.items),va.value=e.data.data.items.length===na.value):Array.isArray(e.data.data)&&e.data.data.length>0?(ka.value.push(...e.data.data),va.value=e.data.data.length===na.value):va.value=!1:va.value=!1}catch(l){va.value=!1}finally{oa.value=!1}}},Pa=()=>{ua.value=1,va.value=!0,oa.value=!1,ka.value=[]};return s((()=>{(async()=>{try{const e=await z();0===e.data.code&&e.data.data?Va.value=e.data.data.map((e=>({id:e.id,name:e.real_name||e.username,avatar:Aa(e.real_name||e.username),role:e.role_name||Ua(e.role_id)}))):Va.value=[{id:"1",name:"系统管理员",avatar:Aa("系统管理员"),role:"管理员"},{id:"2",name:"技术支持",avatar:Aa("技术支持"),role:"技术人员"}]}catch(e){w.error("获取用户列表失败，将使用默认数据"),Va.value=[{id:"1",name:"系统管理员",avatar:Aa("系统管理员"),role:"管理员"},{id:"2",name:"技术支持",avatar:Aa("技术支持"),role:"技术人员"}]}})(),Ca();const e=document.querySelector(".app-container");e&&e.addEventListener("scroll",Ka)})),t((()=>{const e=document.querySelector(".app-container");e&&e.removeEventListener("scroll",Ka)})),(e,a)=>{var l;const s=i("el-icon"),t=i("el-input"),w=i("el-option"),z=i("el-select"),j=i("el-button"),S=i("el-spinner"),U=i("el-empty"),C=i("el-tag"),H=i("el-avatar"),ua=i("el-drawer"),na=i("el-form-item"),ca=i("el-date-picker"),oa=i("el-form"),za=i("el-dialog");return d(),r("div",q,[u("div",T,[u("div",Y,[n(t,{modelValue:ma.value,"onUpdate:modelValue":a[0]||(a[0]=e=>ma.value=e),placeholder:"搜索问题...",class:"!w-[260px]",size:"large",onKeyup:v(La,["enter"])},{prefix:c((()=>[n(s,{class:"text-gray-400"},{default:c((()=>[n(o(_))])),_:1})])),_:1},8,["modelValue"]),n(z,{modelValue:pa.value,"onUpdate:modelValue":a[1]||(a[1]=e=>pa.value=e),placeholder:"所有状态",class:"!w-[150px]",size:"large",onChange:La},{default:c((()=>[n(w,{label:"所有状态",value:""}),n(w,{label:"待处理",value:"pending"}),n(w,{label:"处理中",value:"processing"}),n(w,{label:"已完成",value:"completed"})])),_:1},8,["modelValue"]),n(j,{type:"primary",onClick:Na,class:"!min-w-[100px]",size:"large"},{default:c((()=>a[12]||(a[12]=[m(" 新建问题 ")]))),_:1})])]),M.value?(d(),r("div",D,[n(S,{text:"加载中..."})])):0===ka.value.length?(d(),r("div",$,[n(U,{description:"暂无问题"}),n(j,{type:"primary",onClick:Na,class:"mt-4"},{default:c((()=>a[13]||(a[13]=[m("新建问题")]))),_:1})])):(d(),r("div",A,[(d(!0),r(p,null,g(ka.value,(e=>(d(),r("div",{key:e.id,class:"issue-card bg-white rounded-lg shadow-sm overflow-hidden cursor-pointer hover:shadow-md transition-shadow duration-300",onClick:a=>(e=>{Ha(e.id),ga.value=!0})(e)},[u("div",N,[u("div",I,[u("span",E,"#"+y(e.id),1),u("h3",F,y(e.title),1),u("div",K,[n(C,{type:Da(e.priority),effect:"light",class:"priority-tag"},{default:c((()=>[m(y($a(e.priority)),1)])),_:2},1032,["type"]),n(C,{type:Ta(e.status),effect:"light",class:"status-tag"},{default:c((()=>[m(y(Ya(e.status)),1)])),_:2},1032,["type"])])]),u("div",P,[u("div",R,[n(s,{class:"mr-1"},{default:c((()=>[n(o(V))])),_:1}),u("span",null,"创建: "+y(o(h)(e.createTime)),1)]),e.deadline?(d(),r("div",{key:0,class:x(["time-tag deadline-tag",Ma(e.deadline)?"deadline-near":""])},[n(s,{class:"mr-1"},{default:c((()=>[n(o(k))])),_:1}),u("span",null,"截止: "+y(qa(e.deadline)),1),Ma(e.deadline)?(d(),b(C,{key:0,type:"danger",effect:"light",size:"small",class:"ml-2"},{default:c((()=>a[14]||(a[14]=[m(" 即将到期 ")]))),_:1})):f("",!0)],2)):f("",!0)]),u("div",B,[u("div",{class:x(["status-flow",{"flow-pending":"pending"===e.status,"flow-processing":"processing"===e.status,"flow-completed":"completed"===e.status}])},[u("div",{class:x(["status-step",{"status-pending":"pending"===e.status,"status-completed":["processing","completed"].includes(e.status),"status-current":"pending"===e.status}])},a[15]||(a[15]=[u("div",{class:"status-dot"},null,-1),u("span",{class:"status-text"},"待处理",-1)]),2),a[18]||(a[18]=u("div",{class:"status-line"},null,-1)),u("div",{class:x(["status-step",{"status-completed":"completed"===e.status,"status-current":"processing"===e.status}])},a[16]||(a[16]=[u("div",{class:"status-dot"},null,-1),u("span",{class:"status-text"},"处理中",-1)]),2),a[19]||(a[19]=u("div",{class:"status-line"},null,-1)),u("div",{class:x(["status-step",{"status-completed":"completed"===e.status,"status-current":!1}])},a[17]||(a[17]=[u("div",{class:"status-dot"},null,-1),u("span",{class:"status-text"},"已完成",-1)]),2)],2)]),u("div",G,[u("div",O,[u("div",X,[a[20]||(a[20]=u("span",{class:"user-label"},"创建人:",-1)),u("div",J,[n(H,{size:24,src:Aa(e.creator.name),class:"user-avatar"},null,8,["src"]),u("span",Q,y(e.creator.name),1)])]),u("div",W,[a[21]||(a[21]=u("span",{class:"user-label"},"负责人:",-1)),u("div",Z,[n(H,{size:24,src:Aa(e.assignee.name),class:"user-avatar"},null,8,["src"]),u("span",ee,y(e.assignee.name),1)])])])])])],8,L)))),128))])),va.value?(d(),r("div",ae,[u("div",le,[n(S,{class:"mr-2",size:"small"}),a[22]||(a[22]=u("span",{class:"text-gray-500"},"加载更多...",-1))])])):f("",!0),n(ua,{modelValue:ga.value,"onUpdate:modelValue":a[4]||(a[4]=e=>ga.value=e),title:(null==(l=fa.value)?void 0:l.title)||"问题详情",size:"55%","destroy-on-close":!0},{header:c((()=>[fa.value?(d(),r("div",se,[u("h2",te,y(fa.value.title),1),n(C,{type:Ta(fa.value.status),effect:"light",size:"large"},{default:c((()=>[m(y(Ya(fa.value.status)),1)])),_:1},8,["type"])])):(d(),r("div",ie,a[23]||(a[23]=[u("h2",{class:"text-2xl font-bold"},"加载中...",-1)])))])),footer:c((()=>[u("div",Je,[n(j,{onClick:Ia},{default:c((()=>a[39]||(a[39]=[m(" 关闭 ")]))),_:1})])])),default:c((()=>{var e,l;return[ia.value?(d(),r("div",de,[n(S,{text:"加载中..."})])):fa.value?(d(),r("div",re,[u("div",ue,[u("div",ne,[u("span",ce,"#"+y(fa.value.id),1),u("h2",oe,y(fa.value.title),1)]),u("div",ve,[u("div",me,[u("div",pe,[a[24]||(a[24]=u("span",{class:"tag-label text-gray-500"},"优先级",-1)),n(C,{type:Da(fa.value.priority),effect:"plain",class:"priority-tag",size:"large"},{default:c((()=>[m(y($a(fa.value.priority)),1)])),_:1},8,["type"])]),u("div",ge,[a[25]||(a[25]=u("span",{class:"tag-label text-gray-500"},"状态",-1)),n(C,{type:Ta(fa.value.status),effect:"plain",class:"status-tag",size:"large"},{default:c((()=>[m(y(Ya(fa.value.status)),1)])),_:1},8,["type"])])])]),u("div",fe,[u("div",ye,[n(s,{class:"timeline-icon"},{default:c((()=>[n(o(V))])),_:1}),u("div",be,[a[26]||(a[26]=u("div",{class:"text-sm text-gray-500"},"创建时间",-1)),u("div",xe,y(o(h)(fa.value.createTime)),1)])]),a[29]||(a[29]=u("div",{class:"timeline-divider"},null,-1)),u("div",he,[n(s,{class:"timeline-icon"},{default:c((()=>[n(o(k))])),_:1}),u("div",we,[a[28]||(a[28]=u("div",{class:"text-sm text-gray-500"},"截止时间",-1)),u("div",_e,[u("span",Ve,y(qa(fa.value.deadline)),1),Ma(fa.value.deadline)?(d(),b(C,{key:0,type:"danger",effect:"light",size:"small",class:"ml-2"},{default:c((()=>a[27]||(a[27]=[m(" 即将到期 ")]))),_:1})):f("",!0)])])])]),u("div",ke,[u("div",ze,[u("div",je,[a[31]||(a[31]=u("span",{class:"user-role-label"},"创建人",-1)),u("div",Se,[n(H,{size:40,src:Aa(null==(e=fa.value.creator)?void 0:e.name)},null,8,["src"]),u("div",Ue,[u("span",Ce,y(null==(l=fa.value.creator)?void 0:l.name),1),a[30]||(a[30]=u("span",{class:"user-role"},"发起人",-1))])])]),u("div",He,[a[33]||(a[33]=u("span",{class:"user-role-label"},"负责人",-1)),u("div",Me,[n(H,{size:40,src:Aa(fa.value.assignee.name)},null,8,["src"]),u("div",qe,[u("span",Te,y(fa.value.assignee.name),1),a[32]||(a[32]=u("span",{class:"user-role"},"处理人",-1))])])])])])]),u("div",Ye,[a[34]||(a[34]=u("h3",{class:"text-lg font-semibold mb-4 text-gray-900 border-b pb-2"},"问题描述",-1)),u("p",De,y(fa.value.description),1)]),u("div",$e,[a[38]||(a[38]=u("h3",{class:"text-lg font-semibold mb-4 text-gray-900 border-b pb-2"},"处理记录",-1)),u("div",Ae,[u("div",Le,[(d(!0),r(p,null,g(fa.value.records,(e=>(d(),r("div",{key:e.id,class:"chat-record-item mb-6"},[u("div",Ne,[n(H,{size:40,src:Aa(e.user.name),class:"flex-shrink-0"},null,8,["src"]),u("div",Ie,[u("div",Ee,[u("span",Fe,y(e.user.name+" : "),1),u("span",Ke,y(e.createTime),1)]),u("div",{class:"chat-bubble bg-gray-100 rounded-lg p-4 text-gray-800",innerHTML:e.content},null,8,Pe)])])])))),128))]),Sa.value?(d(),r("div",Re,[a[37]||(a[37]=u("h4",{class:"font-medium text-gray-900 mb-4 border-b pb-2"},"添加处理记录",-1)),u("div",Be,[n(t,{type:"textarea",modelValue:ya.value,"onUpdate:modelValue":a[2]||(a[2]=e=>ya.value=e),placeholder:"请输入处理记录内容...",rows:5,disabled:ra.value},null,8,["modelValue","disabled"])]),u("div",Ge,[a[35]||(a[35]=u("div",{class:"label-required mb-2"},"更新问题状态",-1)),n(z,{modelValue:ba.value,"onUpdate:modelValue":a[3]||(a[3]=e=>ba.value=e),placeholder:"请选择要更新的状态",size:"large",disabled:ra.value,class:"w-full"},{default:c((()=>[n(w,{label:"待处理",value:"pending"}),n(w,{label:"处理中",value:"processing"}),n(w,{label:"已完成",value:"completed"})])),_:1},8,["modelValue","disabled"])]),u("div",Oe,[n(j,{type:"primary",size:"large",onClick:Ea,loading:ra.value,disabled:!ya.value||!ba.value},{default:c((()=>a[36]||(a[36]=[m(" 添加记录 ")]))),_:1},8,["loading","disabled"])])])):f("",!0),0===fa.value.records.length?(d(),r("div",Xe," 暂无处理记录 ")):f("",!0)])])])):f("",!0)]})),_:1},8,["modelValue","title"]),n(za,{modelValue:xa.value,"onUpdate:modelValue":a[11]||(a[11]=e=>xa.value=e),title:"新建问题",width:"650px","destroy-on-close":!0},{footer:c((()=>[u("div",ta,[n(j,{onClick:a[10]||(a[10]=e=>xa.value=!1)},{default:c((()=>a[40]||(a[40]=[m("取消")]))),_:1}),n(j,{type:"primary",onClick:Fa,loading:da.value},{default:c((()=>a[41]||(a[41]=[m("创建问题")]))),_:1},8,["loading"])])])),default:c((()=>[u("div",Qe,[n(oa,{model:wa.value,"label-position":"top",rules:_a,ref_key:"createFormRef",ref:ha},{default:c((()=>[n(na,{label:"问题标题",prop:"title"},{default:c((()=>[n(t,{modelValue:wa.value.title,"onUpdate:modelValue":a[5]||(a[5]=e=>wa.value.title=e),placeholder:"请输入问题标题"},null,8,["modelValue"])])),_:1}),u("div",We,[n(na,{label:"优先级",prop:"priority"},{default:c((()=>[n(z,{modelValue:wa.value.priority,"onUpdate:modelValue":a[6]||(a[6]=e=>wa.value.priority=e),placeholder:"请选择优先级",class:"w-full"},{default:c((()=>[n(w,{label:"高优先级",value:"high"}),n(w,{label:"中优先级",value:"medium"}),n(w,{label:"低优先级",value:"low"})])),_:1},8,["modelValue"])])),_:1}),n(na,{label:"负责人",prop:"assignee"},{default:c((()=>[n(z,{modelValue:wa.value.assignee,"onUpdate:modelValue":a[7]||(a[7]=e=>wa.value.assignee=e),placeholder:"请选择负责人",class:"w-full"},{default:c((()=>[(d(!0),r(p,null,g(Va.value,(e=>(d(),b(w,{key:e.id,label:e.name,value:e.id},{default:c((()=>[u("div",Ze,[u("div",ea,[n(H,{size:26,src:e.avatar,class:"user-avatar"},null,8,["src"]),u("span",aa,y(e.name),1)]),u("span",la,y(e.role||"用户"),1)])])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})]),u("div",sa,[n(na,{label:"截止日期",prop:"deadline"},{default:c((()=>[n(ca,{modelValue:wa.value.deadline,"onUpdate:modelValue":a[8]||(a[8]=e=>wa.value.deadline=e),type:"datetime",placeholder:"请选择截止日期",format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm",class:"w-full"},null,8,["modelValue"])])),_:1})]),n(na,{label:"问题描述",prop:"description"},{default:c((()=>[n(t,{modelValue:wa.value.description,"onUpdate:modelValue":a[9]||(a[9]=e=>wa.value.description=e),type:"textarea",rows:6,placeholder:"请输入问题描述"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-dd99982f"]]);export{ia as default};
