{"version":3,"file":"index-CCWnYhvs.js","sources":["../../src/views/writer-application/index.vue"],"sourcesContent":["<template>\r\n  <div class=\"application-container\">\r\n    <div class=\"form-card\" v-show=\"formVisible\">\r\n      <h2>写手申请</h2>\r\n      <el-form\r\n        ref=\"formRef\"\r\n        :model=\"applicationForm\"\r\n        :rules=\"rules\"\r\n        label-position=\"top\"\r\n        class=\"application-form\"\r\n      >\r\n        <el-form-item label=\"姓名\" prop=\"name\">\r\n          <el-input v-model=\"applicationForm.name\" placeholder=\"请输入姓名\" />\r\n        </el-form-item>\r\n        \r\n        <el-form-item label=\"学历\" prop=\"education\">\r\n          <el-select v-model=\"applicationForm.education\" placeholder=\"请选择学历\" style=\"width: 100%\">\r\n            <el-option\r\n              v-for=\"item in educationOptions\"\r\n              :key=\"item.value\"\r\n              :label=\"item.label\"\r\n              :value=\"item.value\"\r\n            />\r\n          </el-select>\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"专业\" prop=\"major\">\r\n          <el-input v-model=\"applicationForm.major\" placeholder=\"请输入专业\" />\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"写作水平\" prop=\"writing_experience\">\r\n          <el-select v-model=\"applicationForm.writing_experience\" placeholder=\"请选择写作水平\" style=\"width: 100%\">\r\n            <el-option\r\n              v-for=\"item in experienceOptions\"\r\n              :key=\"item.value\"\r\n              :label=\"item.label\"\r\n              :value=\"item.value\"\r\n            />\r\n          </el-select>\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"身份证号\" prop=\"id_number\">\r\n          <el-input \r\n            v-model=\"applicationForm.id_number\" \r\n            placeholder=\"请输入身份证号\"\r\n            maxlength=\"18\"\r\n            show-word-limit\r\n          />\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"手机号码1\" prop=\"phone_1\">\r\n          <el-input v-model=\"applicationForm.phone_1\" placeholder=\"请输入手机号码\" />\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"手机号码2\" prop=\"phone_2\">\r\n          <el-input v-model=\"applicationForm.phone_2\" placeholder=\"请输入备用手机号码\" />\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"支付宝姓名\" prop=\"alipay_name\">\r\n          <el-input v-model=\"applicationForm.alipay_name\" placeholder=\"请输入支付宝姓名\" />\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"支付宝账号\" prop=\"alipay_account\">\r\n          <el-input v-model=\"applicationForm.alipay_account\" placeholder=\"请输入支付宝账号\" />\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"擅长内容\" prop=\"specialized_content\">\r\n          <div class=\"tag-container\">\r\n            <el-tag\r\n              v-for=\"item in specializedOptions\"\r\n              :key=\"item.value\"\r\n              :type=\"selectedSpecialized.includes(item.value) ? 'primary' : 'info'\"\r\n              class=\"specialized-tag\"\r\n              @click=\"toggleSpecialized(item.value)\"\r\n            >\r\n              {{ item.label }}\r\n            </el-tag>\r\n          </div>\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"申请日期\" prop=\"apply_date\">\r\n          <el-date-picker\r\n            v-model=\"applyDate\"\r\n            type=\"date\"\r\n            value-format=\"YYYY-MM-DD\"\r\n            placeholder=\"选择日期\"\r\n          />\r\n        </el-form-item>\r\n\r\n        <el-form-item>\r\n          <el-button type=\"primary\" class=\"submit-btn\" @click=\"handleSubmit\" :loading=\"submitting\">\r\n            提交申请\r\n          </el-button>\r\n        </el-form-item>\r\n      </el-form>\r\n    </div>\r\n\r\n    <!-- 提交成功弹窗 -->\r\n    <el-dialog\r\n      title=\"申请提交成功\"\r\n      v-model=\"successDialogVisible\"\r\n      width=\"400px\"\r\n      :close-on-click-modal=\"false\"\r\n      :show-close=\"false\"\r\n    >\r\n      <div class=\"success-info\">\r\n        <el-icon class=\"success-icon\"><CircleCheckFilled /></el-icon>\r\n        <h3>您的写手ID：{{ submittedWriterId }}</h3>\r\n        <p>请截图保存此信息</p>\r\n      </div>\r\n      <template #footer>\r\n        <el-button type=\"primary\" @click=\"handleClose\">我已保存</el-button>\r\n      </template>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, onMounted, watch } from 'vue'\r\nimport { useRoute, useRouter } from 'vue-router'\r\nimport { ElMessage } from 'element-plus'\r\nimport { CircleCheckFilled } from '@element-plus/icons-vue'\r\nimport { createWriter } from '@/api/writer'\r\nimport type { FormInstance, FormRules } from 'element-plus'\r\nimport type { WriterForm } from '@/types/writer'\r\nimport { getClientIp } from '@/utils/ip'\r\nimport type { DateModelType } from 'element-plus'\r\nimport { formatDate } from '@/utils/date'\r\n\r\nconst route = useRoute()\r\nconst router = useRouter()\r\nconst formRef = ref<FormInstance>()\r\nconst submitting = ref(false)\r\nconst successDialogVisible = ref(false)\r\nconst submittedWriterId = ref('')\r\nconst formVisible = ref(false)\r\nconst selectedSpecialized = ref<string[]>([])\r\nconst applyDate = ref<DateModelType | undefined>()\r\n\r\n// 验证 token\r\nonMounted(() => {\r\n  const token = route.query.token as string\r\n  \r\n  // 简单验证 token 格式\r\n  if (!token || !token.startsWith('apply_')) {\r\n    ElMessage.error('无效的申请链接')\r\n    return\r\n  }\r\n  \r\n  // token 验证通过，显示表单\r\n  formVisible.value = true\r\n})\r\n\r\n// 表单数据\r\nconst applicationForm = ref<WriterForm>({\r\n  name: '',\r\n  education: '',\r\n  major: '',\r\n  writing_experience: '',\r\n  specialized_content: '',\r\n  phone_1: '',\r\n  phone_2: '',\r\n  alipay_name: '',\r\n  alipay_account: '',\r\n  id_number: '',\r\n  ip_address: '',\r\n  apply_date: ''\r\n})\r\n\r\n// 表单校验规则\r\nconst rules: FormRules = {\r\n  name: [\r\n    { required: true, message: '请输入姓名', trigger: 'blur' }\r\n  ],\r\n  education: [\r\n    { required: true, message: '请选择学历', trigger: 'change' }\r\n  ],\r\n  major: [\r\n    { required: true, message: '请输入专业', trigger: 'blur' }\r\n  ],\r\n  writing_experience: [\r\n    { required: true, message: '请选择写作水平', trigger: 'change' }\r\n  ],\r\n  id_number: [\r\n    { required: true, message: '请输入身份证号', trigger: 'blur' },\r\n    { pattern: /(^\\d{15}$)|(^\\d{18}$)|(^\\d{17}(\\d|X|x)$)/, message: '请输入正确的身份证号', trigger: 'blur' }\r\n  ],\r\n  phone_1: [\r\n    { required: true, message: '请输入手机号码', trigger: 'blur' },\r\n    { pattern: /^1[3-9]\\d{9}$/, message: '请输入正确的手机号码', trigger: 'blur' }\r\n  ],\r\n  specialized_content: [\r\n    { required: true, message: '请选择擅长内容', trigger: 'change' }\r\n  ],\r\n  apply_date: [\r\n    { required: true, message: '请选择申请日期', trigger: 'change' }\r\n  ]\r\n}\r\n\r\n// 选项数据\r\nconst educationOptions = [\r\n  { value: '专科', label: '专科' },\r\n  { value: '本科', label: '本科' },\r\n  { value: '硕士', label: '硕士' },\r\n  { value: '博士', label: '博士' }\r\n]\r\n\r\nconst experienceOptions = [\r\n  { value: '大学水平', label: '大学水平' },\r\n  { value: '在职水平', label: '在职水平' },\r\n  { value: '事业单位水平', label: '事业单位水平' },\r\n  { value: '淘宝老手', label: '淘宝老手' },\r\n  { value: '在职老师', label: '在职老师' },\r\n  { value: '期刊报告科研', label: '期刊报告科研' }\r\n]\r\n\r\nconst specializedOptions = [\r\n  { value: 'ppt制作', label: 'PPT制作' },\r\n  { value: '演讲稿、征文、读后感', label: '演讲稿/征文/读后感' },\r\n  { value: '公文类、对照材料、生活会、讲话稿，公文材料、研讨材料、领导讲话', label: '公文材料/讲话稿' },\r\n  { value: '调查报告、学术报告、期刊、研究性文章', label: '报告/期刊/论文' },\r\n  { value: '广告词、广告语、推文、商业文案', label: '广告/文案' },\r\n  { value: '商业计划书、策划方案、项目可行性研究报告', label: '计划书/方案' },\r\n  { value: '保洁、物业、工程、绿化、采购标书', label: '标书类' },\r\n  { value: '抄写', label: '抄写' }\r\n]\r\n\r\n// 切换擅长内容选择\r\nconst toggleSpecialized = (value: string) => {\r\n  const index = selectedSpecialized.value.indexOf(value)\r\n  if (index === -1) {\r\n    selectedSpecialized.value.push(value)\r\n  } else {\r\n    selectedSpecialized.value.splice(index, 1)\r\n  }\r\n  // 更新表单的 specialized_content 字段\r\n  applicationForm.value.specialized_content = selectedSpecialized.value.join(';')\r\n}\r\n\r\n// 监听日期变化\r\nwatch(applyDate, (val) => {\r\n  applicationForm.value.apply_date = formatDate(val)\r\n})\r\n\r\n// 提交表单\r\nconst handleSubmit = async () => {\r\n  if (!formRef.value) return\r\n  \r\n  try {\r\n    await formRef.value.validate()\r\n    \r\n    submitting.value = true\r\n    const ip = await getClientIp()\r\n    const submitData: WriterForm = {\r\n      ...applicationForm.value,\r\n      specialized_content: selectedSpecialized.value.join(';'),\r\n      ip_address: ip,\r\n      apply_date: applicationForm.value.apply_date\r\n    }\r\n    const res = await createWriter(submitData)\r\n    submittedWriterId.value = res.data.writer_id\r\n    successDialogVisible.value = true\r\n  } catch (error) {\r\n    console.error('提交申请失败:', error)\r\n    ElMessage.error('提交失败，请稍后重试')\r\n  } finally {\r\n    submitting.value = false\r\n  }\r\n}\r\n\r\n// 关闭成功弹窗\r\nconst handleClose = () => {\r\n  successDialogVisible.value = false\r\n  // 可以跳转到一个静态页面或关闭窗口\r\n  window.close()\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.application-container {\r\n  min-height: 100vh;\r\n  background: #f0f2f5;\r\n  padding: 16px;\r\n  \r\n  .form-card {\r\n    max-width: 100%;\r\n    margin: 0 auto;\r\n    background: #fff;\r\n    padding: 20px;\r\n    border-radius: 8px;\r\n    box-shadow: 0 2px 12px 0 rgba(0,0,0,0.1);\r\n\r\n    @media screen and (min-width: 768px) {\r\n      max-width: 600px;\r\n      padding: 30px;\r\n    }\r\n\r\n    h2 {\r\n      text-align: center;\r\n      margin-bottom: 24px;\r\n      color: #303133;\r\n      font-size: 20px;\r\n    }\r\n  }\r\n}\r\n\r\n.application-form {\r\n  :deep(.el-form-item) {\r\n    margin-bottom: 20px;\r\n    \r\n    .el-form-item__label {\r\n      padding-bottom: 8px;\r\n      font-size: 15px;\r\n    }\r\n    \r\n    .el-input, .el-select {\r\n      width: 100%;\r\n    }\r\n  }\r\n}\r\n\r\n.tag-container {\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  gap: 8px;\r\n  \r\n  .specialized-tag {\r\n    margin: 0;\r\n    padding: 6px 12px;\r\n    font-size: 14px;\r\n    cursor: pointer;\r\n    user-select: none;\r\n    \r\n    &:active {\r\n      opacity: 0.8;\r\n    }\r\n  }\r\n}\r\n\r\n.submit-btn {\r\n  width: 100%;\r\n  margin-top: 16px;\r\n  padding: 12px 0;\r\n  font-size: 16px;\r\n}\r\n\r\n// 优化成功弹窗在移动端的显示\r\n:deep(.el-dialog) {\r\n  width: 90% !important;\r\n  max-width: 400px;\r\n  \r\n  .success-info {\r\n    padding: 16px 0;\r\n    \r\n    .success-icon {\r\n      font-size: 40px;\r\n    }\r\n    \r\n    h3 {\r\n      font-size: 16px;\r\n      margin: 12px 0;\r\n    }\r\n    \r\n    p {\r\n      font-size: 14px;\r\n    }\r\n  }\r\n}\r\n</style> "],"names":["route","useRoute","useRouter","formRef","ref","submitting","successDialogVisible","submittedWriterId","formVisible","selectedSpecialized","applyDate","onMounted","token","ElMessage","applicationForm","rules","educationOptions","experienceOptions","specializedOptions","toggleSpecialized","value","index","watch","val","formatDate","handleSubmit","ip","getClientIp","submitData","res","createWriter","error","handleClose"],"mappings":"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"}