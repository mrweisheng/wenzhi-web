{"version":3,"file":"index-kIfvGm6z.js","sources":["../../src/views/system/menus/index.vue"],"sourcesContent":["<template>\r\n  <div class=\"app-container\">\r\n    <div class=\"toolbar\">\r\n      <el-button type=\"primary\" @click=\"handleAdd\">新增菜单</el-button>\r\n    </div>\r\n\r\n    <el-table\r\n      v-loading=\"loading\"\r\n      :data=\"menuList\"\r\n      row-key=\"id\"\r\n      :tree-props=\"{ children: 'children' }\"\r\n      style=\"width: 100%; margin-top: 20px\"\r\n    >\r\n      <el-table-column prop=\"name\" label=\"菜单名称\" />\r\n      <el-table-column prop=\"path\" label=\"路由路径\" />\r\n      <el-table-column prop=\"icon\" label=\"图标\" width=\"100\">\r\n        <template #default=\"{ row }\">\r\n          <el-icon>\r\n            <component :is=\"row.icon\" />\r\n          </el-icon>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column prop=\"sort\" label=\"排序\" width=\"120\">\r\n        <template #default=\"{ row }\">\r\n          <div class=\"sort-column\">\r\n            <span>{{ row.sort }}</span>\r\n            <div class=\"sort-buttons\">\r\n              <el-button \r\n                type=\"primary\" \r\n                link \r\n                :disabled=\"!canMoveUp(row)\"\r\n                @click=\"handleMoveUp(row)\"\r\n              >\r\n                <el-icon><ArrowUp /></el-icon>\r\n              </el-button>\r\n              <el-button \r\n                type=\"primary\" \r\n                link \r\n                :disabled=\"!canMoveDown(row)\"\r\n                @click=\"handleMoveDown(row)\"\r\n              >\r\n                <el-icon><ArrowDown /></el-icon>\r\n              </el-button>\r\n            </div>\r\n          </div>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"操作\" width=\"200\" fixed=\"right\">\r\n        <template #default=\"{ row }\">\r\n          <el-button type=\"primary\" link @click=\"handleEdit(row)\">编辑</el-button>\r\n          <el-button type=\"danger\" link @click=\"handleDelete(row)\">删除</el-button>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n\r\n    <!-- 菜单表单对话框 -->\r\n    <el-dialog\r\n      :title=\"dialogTitle\"\r\n      v-model=\"dialogVisible\"\r\n      width=\"500px\"\r\n      @close=\"resetForm\"\r\n    >\r\n      <el-form\r\n        ref=\"formRef\"\r\n        :model=\"menuForm\"\r\n        :rules=\"rules\"\r\n        label-width=\"80px\"\r\n      >\r\n        <el-form-item label=\"上级菜单\" v-if=\"!menuForm.id\">\r\n          <el-tree-select\r\n            v-model=\"menuForm.parent_id\"\r\n            :data=\"menuList\"\r\n            :props=\"{ label: 'name', value: 'id', children: 'children' }\"\r\n            placeholder=\"请选择上级菜单\"\r\n            clearable\r\n          />\r\n        </el-form-item>\r\n        <el-form-item label=\"菜单名称\" prop=\"name\">\r\n          <el-input v-model=\"menuForm.name\" placeholder=\"请输入菜单名称\" />\r\n        </el-form-item>\r\n        <el-form-item label=\"路由路径\" prop=\"path\">\r\n          <el-input \r\n            v-model=\"menuForm.path\" \r\n            placeholder=\"请输入路由路径\"\r\n            :disabled=\"!!menuForm.id\"\r\n          />\r\n        </el-form-item>\r\n        <el-form-item label=\"图标\" prop=\"icon\">\r\n          <el-input v-model=\"menuForm.icon\" placeholder=\"请输入图标名称\" />\r\n        </el-form-item>\r\n        <el-form-item label=\"排序\" prop=\"sort\">\r\n          <el-input-number v-model=\"menuForm.sort\" :min=\"0\" :max=\"99\" />\r\n        </el-form-item>\r\n      </el-form>\r\n      <template #footer>\r\n        <el-button @click=\"dialogVisible = false\">取消</el-button>\r\n        <el-button type=\"primary\" @click=\"handleSubmit\" :loading=\"submitting\">\r\n          确定\r\n        </el-button>\r\n      </template>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, onMounted } from 'vue'\r\nimport { ElMessage, ElMessageBox } from 'element-plus'\r\nimport type { FormInstance, FormRules } from 'element-plus'\r\nimport { getMenus, createMenu, updateMenu, deleteMenu } from '@/api/menu'\r\nimport type { Menu, MenuForm } from '@/types/menu'\r\nimport { useUserStore } from '@/stores/user'\r\nimport { ArrowUp, ArrowDown } from '@element-plus/icons-vue'\r\n\r\nconst loading = ref(false)\r\nconst menuList = ref<Menu[]>([])\r\nconst dialogVisible = ref(false)\r\nconst dialogTitle = ref('')\r\nconst submitting = ref(false)\r\n\r\nconst formRef = ref<FormInstance>()\r\nconst menuForm = ref<MenuForm>({\r\n  name: '',\r\n  path: '',\r\n  icon: '',\r\n  sort: 0,\r\n  parent_id: null\r\n})\r\n\r\nconst rules: FormRules = {\r\n  name: [\r\n    { required: true, message: '请输入菜单名称', trigger: 'blur' }\r\n  ],\r\n  path: [\r\n    { required: true, message: '请输入路由路径', trigger: 'blur' }\r\n  ],\r\n  icon: [\r\n    { required: true, message: '请输入图标名称', trigger: 'blur' }\r\n  ]\r\n}\r\n\r\n// 在 setup 中获取 store\r\nconst userStore = useUserStore()\r\n\r\n// 获取菜单列表\r\nconst fetchMenus = async () => {\r\n  try {\r\n    loading.value = true\r\n    const { data } = await getMenus()\r\n    menuList.value = data\r\n  } catch (error) {\r\n    console.error('获取菜单列表失败:', error)\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\n// 新增菜单\r\nconst handleAdd = () => {\r\n  dialogTitle.value = '新增菜单'\r\n  dialogVisible.value = true\r\n}\r\n\r\n// 编辑菜单\r\nconst handleEdit = (row: Menu) => {\r\n  dialogTitle.value = '编辑菜单'\r\n  menuForm.value = { ...row }\r\n  dialogVisible.value = true\r\n}\r\n\r\n// 删除菜单\r\nconst handleDelete = async (row: Menu) => {\r\n  try {\r\n    await ElMessageBox.confirm('确认删除该菜单吗？', '提示', {\r\n      type: 'warning'\r\n    })\r\n    \r\n    await deleteMenu(row.id)\r\n    ElMessage.success('删除成功')\r\n    // 删除成功后刷新菜单\r\n    await userStore.getUserInfoAction()\r\n    fetchMenus()\r\n  } catch (error) {\r\n    console.error('Delete menu error:', error)\r\n  }\r\n}\r\n\r\n// 提交表单\r\nconst handleSubmit = async () => {\r\n  if (!formRef.value) return\r\n  \r\n  await formRef.value.validate()\r\n  \r\n  try {\r\n    submitting.value = true\r\n    if (menuForm.value.id) {\r\n      const updateData = {\r\n        name: menuForm.value.name,\r\n        icon: menuForm.value.icon,\r\n        sort: menuForm.value.sort\r\n      }\r\n      await updateMenu(menuForm.value.id, updateData)\r\n      ElMessage.success('更新成功')\r\n      await userStore.getUserInfoAction()\r\n    } else {\r\n      await createMenu(menuForm.value)\r\n      ElMessage.success('创建成功')\r\n      await userStore.getUserInfoAction()\r\n    }\r\n    dialogVisible.value = false\r\n    fetchMenus()\r\n  } catch (error) {\r\n    console.error('Submit menu error:', error)\r\n  } finally {\r\n    submitting.value = false\r\n  }\r\n}\r\n\r\n// 重置表单\r\nconst resetForm = () => {\r\n  if (formRef.value) {\r\n    formRef.value.resetFields()\r\n  }\r\n  menuForm.value = {\r\n    name: '',\r\n    path: '',\r\n    icon: '',\r\n    sort: 0,\r\n    parent_id: null\r\n  }\r\n}\r\n\r\n// 判断是否可以上移\r\nconst canMoveUp = (row: Menu) => {\r\n  // 获取同级菜单\r\n  const siblings = menuList.value.filter(item => item.parent_id === row.parent_id)\r\n  const index = siblings.findIndex(item => item.id === row.id)\r\n  return index > 0\r\n}\r\n\r\n// 判断是否可以下移\r\nconst canMoveDown = (row: Menu) => {\r\n  const siblings = menuList.value.filter(item => item.parent_id === row.parent_id)\r\n  const index = siblings.findIndex(item => item.id === row.id)\r\n  return index < siblings.length - 1\r\n}\r\n\r\n// 上移\r\nconst handleMoveUp = async (row: Menu) => {\r\n  try {\r\n    const siblings = menuList.value.filter(item => item.parent_id === row.parent_id)\r\n    const index = siblings.findIndex(item => item.id === row.id)\r\n    const prevMenu = siblings[index - 1]\r\n    \r\n    // 交换排序值\r\n    const tempSort = row.sort\r\n    await updateMenu(row.id, { sort: prevMenu.sort })\r\n    await updateMenu(prevMenu.id, { sort: tempSort })\r\n    \r\n    // 刷新列表和侧边栏\r\n    await fetchMenus()\r\n    await userStore.getUserInfoAction()\r\n    ElMessage.success('排序更新成功')\r\n  } catch (error) {\r\n    console.error('Move menu error:', error)\r\n    ElMessage.error('排序更新失败')\r\n  }\r\n}\r\n\r\n// 下移\r\nconst handleMoveDown = async (row: Menu) => {\r\n  try {\r\n    const siblings = menuList.value.filter(item => item.parent_id === row.parent_id)\r\n    const index = siblings.findIndex(item => item.id === row.id)\r\n    const nextMenu = siblings[index + 1]\r\n    \r\n    // 交换排序值\r\n    const tempSort = row.sort\r\n    await updateMenu(row.id, { sort: nextMenu.sort })\r\n    await updateMenu(nextMenu.id, { sort: tempSort })\r\n    \r\n    // 刷新列表和侧边栏\r\n    await fetchMenus()\r\n    await userStore.getUserInfoAction()\r\n    ElMessage.success('排序更新成功')\r\n  } catch (error) {\r\n    console.error('Move menu error:', error)\r\n    ElMessage.error('排序更新失败')\r\n  }\r\n}\r\n\r\nonMounted(() => {\r\n  fetchMenus()\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.toolbar {\r\n  padding: 10px 0;\r\n}\r\n\r\n.sort-column {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n}\r\n\r\n.sort-buttons {\r\n  display: flex;\r\n  gap: 4px;\r\n}\r\n\r\n/* 当按钮禁用时降低透明度 */\r\n.sort-buttons .el-button.is-disabled {\r\n  opacity: 0.5;\r\n}\r\n</style> "],"names":["loading","ref","menuList","dialogVisible","dialogTitle","submitting","formRef","menuForm","rules","userStore","useUserStore","fetchMenus","data","getMenus","error","handleAdd","handleEdit","row","handleDelete","ElMessageBox","deleteMenu","ElMessage","handleSubmit","updateData","updateMenu","createMenu","resetForm","canMoveUp","item","canMoveDown","siblings","handleMoveUp","index","prevMenu","tempSort","handleMoveDown","nextMenu","onMounted"],"mappings":"kcAiHM,MAAAA,EAAUC,EAAI,EAAK,EACnBC,EAAWD,EAAY,EAAE,EACzBE,EAAgBF,EAAI,EAAK,EACzBG,EAAcH,EAAI,EAAE,EACpBI,EAAaJ,EAAI,EAAK,EAEtBK,EAAUL,EAAkB,EAC5BM,EAAWN,EAAc,CAC7B,KAAM,GACN,KAAM,GACN,KAAM,GACN,KAAM,EACN,UAAW,IAAA,CACZ,EAEKO,EAAmB,CACvB,KAAM,CACJ,CAAE,SAAU,GAAM,QAAS,UAAW,QAAS,MAAO,CACxD,EACA,KAAM,CACJ,CAAE,SAAU,GAAM,QAAS,UAAW,QAAS,MAAO,CACxD,EACA,KAAM,CACJ,CAAE,SAAU,GAAM,QAAS,UAAW,QAAS,MAAO,CAAA,CAE1D,EAGMC,EAAYC,EAAa,EAGzBC,EAAa,SAAY,CACzB,GAAA,CACFX,EAAQ,MAAQ,GAChB,KAAM,CAAE,KAAAY,GAAS,MAAMC,EAAS,EAChCX,EAAS,MAAQU,QACVE,EAAO,CACN,QAAA,MAAM,YAAaA,CAAK,CAAA,QAChC,CACAd,EAAQ,MAAQ,EAAA,CAEpB,EAGMe,EAAY,IAAM,CACtBX,EAAY,MAAQ,OACpBD,EAAc,MAAQ,EACxB,EAGMa,EAAcC,GAAc,CAChCb,EAAY,MAAQ,OACXG,EAAA,MAAQ,CAAE,GAAGU,CAAI,EAC1Bd,EAAc,MAAQ,EACxB,EAGMe,EAAe,MAAOD,GAAc,CACpC,GAAA,CACI,MAAAE,GAAa,QAAQ,YAAa,KAAM,CAC5C,KAAM,SAAA,CACP,EAEK,MAAAC,EAAWH,EAAI,EAAE,EACvBI,EAAU,QAAQ,MAAM,EAExB,MAAMZ,EAAU,kBAAkB,EACvBE,EAAA,QACJG,EAAO,CACN,QAAA,MAAM,qBAAsBA,CAAK,CAAA,CAE7C,EAGMQ,EAAe,SAAY,CAC3B,GAAChB,EAAQ,MAEP,OAAAA,EAAQ,MAAM,SAAS,EAEzB,GAAA,CAEE,GADJD,EAAW,MAAQ,GACfE,EAAS,MAAM,GAAI,CACrB,MAAMgB,EAAa,CACjB,KAAMhB,EAAS,MAAM,KACrB,KAAMA,EAAS,MAAM,KACrB,KAAMA,EAAS,MAAM,IACvB,EACA,MAAMiB,EAAWjB,EAAS,MAAM,GAAIgB,CAAU,EAC9CF,EAAU,QAAQ,MAAM,EACxB,MAAMZ,EAAU,kBAAkB,CAAA,MAE5B,MAAAgB,EAAWlB,EAAS,KAAK,EAC/Bc,EAAU,QAAQ,MAAM,EACxB,MAAMZ,EAAU,kBAAkB,EAEpCN,EAAc,MAAQ,GACXQ,EAAA,QACJG,EAAO,CACN,QAAA,MAAM,qBAAsBA,CAAK,CAAA,QACzC,CACAT,EAAW,MAAQ,EAAA,EAEvB,EAGMqB,EAAY,IAAM,CAClBpB,EAAQ,OACVA,EAAQ,MAAM,YAAY,EAE5BC,EAAS,MAAQ,CACf,KAAM,GACN,KAAM,GACN,KAAM,GACN,KAAM,EACN,UAAW,IACb,CACF,EAGMoB,EAAaV,GAEAf,EAAS,MAAM,UAAe0B,EAAK,YAAcX,EAAI,SAAS,EACxD,aAAkBW,EAAK,KAAOX,EAAI,EAAE,EAC5C,EAIXY,EAAeZ,GAAc,CAC3B,MAAAa,EAAW5B,EAAS,MAAM,UAAe0B,EAAK,YAAcX,EAAI,SAAS,EAExE,OADOa,EAAS,aAAkBF,EAAK,KAAOX,EAAI,EAAE,EAC5Ca,EAAS,OAAS,CACnC,EAGMC,EAAe,MAAOd,GAAc,CACpC,GAAA,CACI,MAAAa,EAAW5B,EAAS,MAAM,UAAe0B,EAAK,YAAcX,EAAI,SAAS,EACzEe,EAAQF,EAAS,aAAkBF,EAAK,KAAOX,EAAI,EAAE,EACrDgB,EAAWH,EAASE,EAAQ,CAAC,EAG7BE,EAAWjB,EAAI,KACrB,MAAMO,EAAWP,EAAI,GAAI,CAAE,KAAMgB,EAAS,KAAM,EAChD,MAAMT,EAAWS,EAAS,GAAI,CAAE,KAAMC,EAAU,EAGhD,MAAMvB,EAAW,EACjB,MAAMF,EAAU,kBAAkB,EAClCY,EAAU,QAAQ,QAAQ,QACnBP,EAAO,CACN,QAAA,MAAM,mBAAoBA,CAAK,EACvCO,EAAU,MAAM,QAAQ,CAAA,CAE5B,EAGMc,EAAiB,MAAOlB,GAAc,CACtC,GAAA,CACI,MAAAa,EAAW5B,EAAS,MAAM,UAAe0B,EAAK,YAAcX,EAAI,SAAS,EACzEe,EAAQF,EAAS,aAAkBF,EAAK,KAAOX,EAAI,EAAE,EACrDmB,EAAWN,EAASE,EAAQ,CAAC,EAG7BE,EAAWjB,EAAI,KACrB,MAAMO,EAAWP,EAAI,GAAI,CAAE,KAAMmB,EAAS,KAAM,EAChD,MAAMZ,EAAWY,EAAS,GAAI,CAAE,KAAMF,EAAU,EAGhD,MAAMvB,EAAW,EACjB,MAAMF,EAAU,kBAAkB,EAClCY,EAAU,QAAQ,QAAQ,QACnBP,EAAO,CACN,QAAA,MAAM,mBAAoBA,CAAK,EACvCO,EAAU,MAAM,QAAQ,CAAA,CAE5B,EAEA,OAAAgB,EAAU,IAAM,CACH1B,EAAA,CAAA,CACZ"}