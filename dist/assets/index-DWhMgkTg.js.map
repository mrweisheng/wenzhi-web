{"version":3,"file":"index-DWhMgkTg.js","sources":["../../src/api/customerOrder.ts","../../src/views/tasks/index.vue"],"sourcesContent":["import request from '@/utils/request'\r\nimport type { CustomerOrder, CustomerOrderResponse, CustomerOrderQuery } from '@/types/customerOrder'\r\nimport type { ApiResponse } from '@/types/response'\r\n\r\n// 创建客服订单\r\nexport function createCustomerOrder(data: CustomerOrder) {\r\n  return request<ApiResponse<CustomerOrderResponse>>({\r\n    url: '/api/customer-orders',\r\n    method: 'post',\r\n    data\r\n  })\r\n}\r\n\r\n// 获取客服订单列表\r\nexport function getCustomerOrders(params: CustomerOrderQuery) {\r\n  return request<ApiResponse>({\r\n    url: '/api/customer-orders',\r\n    method: 'get',\r\n    params\r\n  })\r\n}\r\n\r\n// 合并客服订单到总表\r\nexport function mergeCustomerOrders() {\r\n  return request<ApiResponse>({\r\n    url: '/api/customer-orders/merge',\r\n    method: 'post'\r\n  })\r\n} ","<template>\r\n  <div class=\"app-container\">\r\n    <div class=\"toolbar\">\r\n      <el-form :inline=\"true\" :model=\"queryParams\" class=\"search-form\">\r\n        <el-form-item label=\"订单编号\">\r\n          <el-input\r\n            v-model=\"queryParams.order_id\"\r\n            placeholder=\"请输入订单编号\"\r\n            clearable\r\n            @keyup.enter=\"handleSearch\"\r\n          />\r\n        </el-form-item>\r\n        <el-form-item label=\"日期范围\">\r\n          <el-date-picker\r\n            v-model=\"dateRange\"\r\n            type=\"daterange\"\r\n            range-separator=\"至\"\r\n            start-placeholder=\"开始日期\"\r\n            end-placeholder=\"结束日期\"\r\n            value-format=\"YYYY-MM-DD\"\r\n          />\r\n        </el-form-item>\r\n        <el-form-item label=\"是否定稿\">\r\n          <el-select \r\n            v-model=\"queryParams.is_fixed\" \r\n            placeholder=\"请选择\" \r\n            clearable\r\n          >\r\n            <el-option :value=\"0\" label=\"未定稿\" />\r\n            <el-option :value=\"1\" label=\"已定稿\" />\r\n          </el-select>\r\n        </el-form-item>\r\n        <el-form-item>\r\n          <el-button type=\"primary\" @click=\"handleSearch\">搜索</el-button>\r\n          <el-button @click=\"resetQuery\">重置</el-button>\r\n        </el-form-item>\r\n      </el-form>\r\n      <div class=\"action-buttons\">\r\n        <el-button type=\"primary\" @click=\"handleAdd\">新增订单</el-button>\r\n        <el-button type=\"success\" @click=\"handleSyncOrders\" :loading=\"syncing\">\r\n          <el-icon class=\"mr-1\"><Refresh /></el-icon>同步订单\r\n        </el-button>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- 数据表格 -->\r\n    <el-table\r\n      v-loading=\"loading\"\r\n      :data=\"orderList\"\r\n      style=\"width: 100%; margin-top: 20px\"\r\n    >\r\n      <el-table-column prop=\"order_id\" label=\"订单编号\" width=\"150\" />\r\n      <el-table-column prop=\"date\" label=\"日期\" width=\"120\" />\r\n      <el-table-column label=\"是否定稿\" width=\"100\">\r\n        <template #default=\"{ row }\">\r\n          <el-tag :type=\"row.is_fixed === 1 ? 'success' : 'warning'\">\r\n            {{ row.is_fixed === 1 ? '已定稿' : '未定稿' }}\r\n          </el-tag>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column prop=\"customer_service_name\" label=\"客服\" width=\"120\" />\r\n      <el-table-column prop=\"writer_name\" label=\"写手\" width=\"120\" />\r\n      <el-table-column prop=\"word_count\" label=\"字数\" width=\"100\" />\r\n      <el-table-column label=\"稿费\" width=\"100\">\r\n        <template #default=\"{ row }\">\r\n          ¥{{ row.fee }}\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"订单金额\" width=\"120\">\r\n        <template #default=\"{ row }\">\r\n          ¥{{ row.order_amount }}\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column prop=\"payment_channel\" label=\"付款渠道\" width=\"120\" />\r\n      <el-table-column prop=\"store_name\" label=\"店铺/客户\" width=\"150\" />\r\n      <el-table-column prop=\"customer_name\" label=\"客户名称\" width=\"150\" />\r\n      <el-table-column label=\"创建时间\" width=\"180\">\r\n        <template #default=\"{ row }\">\r\n          {{ formatDate(row.created_at) }}\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"操作\" width=\"150\" fixed=\"right\">\r\n        <template #default=\"{ row }\">\r\n          <el-button type=\"primary\" link @click=\"handleEdit(row)\">编辑</el-button>\r\n          <el-button type=\"primary\" link @click=\"handleView(row)\">查看</el-button>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n\r\n    <!-- 分页 -->\r\n    <div class=\"pagination-container\">\r\n      <el-pagination\r\n        v-model:current-page=\"queryParams.page\"\r\n        v-model:page-size=\"queryParams.pageSize\"\r\n        :page-sizes=\"[10, 20, 50, 100]\"\r\n        :total=\"total\"\r\n        layout=\"total, sizes, prev, pager, next, jumper\"\r\n        @size-change=\"handleSizeChange\"\r\n        @current-change=\"handleCurrentChange\"\r\n      />\r\n    </div>\r\n\r\n    <!-- 订单表单对话框 -->\r\n    <el-dialog\r\n      :title=\"dialogTitle\"\r\n      v-model=\"dialogVisible\"\r\n      width=\"80%\"\r\n      :close-on-click-modal=\"false\"\r\n      :destroy-on-close=\"true\"\r\n      class=\"order-dialog\"\r\n    >\r\n      <el-form\r\n        ref=\"formRef\"\r\n        :model=\"orderForm\"\r\n        :rules=\"rules\"\r\n        label-width=\"120px\"\r\n        class=\"order-form\"\r\n      >\r\n        <!-- 基本信息 -->\r\n        <div class=\"form-section\">\r\n          <div class=\"section-header\">\r\n            <el-icon class=\"section-icon\"><Document /></el-icon>\r\n            <div class=\"section-title\">基本信息</div>\r\n          </div>\r\n          <el-row :gutter=\"24\">\r\n            <el-col :span=\"8\">\r\n              <el-form-item label=\"订单编号\" prop=\"order_id\">\r\n                <el-input \r\n                  v-model=\"orderForm.order_id\" \r\n                  placeholder=\"请输入订单编号\"\r\n                  prefix-icon=\"Ticket\"\r\n                />\r\n              </el-form-item>\r\n            </el-col>\r\n            <el-col :span=\"8\">\r\n              <el-form-item label=\"日期\" prop=\"date\">\r\n                <el-date-picker\r\n                  v-model=\"orderForm.date\"\r\n                  type=\"date\"\r\n                  placeholder=\"选择日期\"\r\n                  format=\"YYYY-MM-DD\"\r\n                  value-format=\"YYYY-MM-DD\"\r\n                  style=\"width: 100%\"\r\n                />\r\n              </el-form-item>\r\n            </el-col>\r\n            <el-col :span=\"8\">\r\n              <el-form-item label=\"是否定稿\" prop=\"is_fixed\">\r\n                <el-select v-model=\"orderForm.is_fixed\" placeholder=\"请选择\" style=\"width: 100%\">\r\n                  <el-option :value=\"0\" label=\"未定稿\">\r\n                    <div class=\"option-with-icon\">\r\n                      <el-icon><MoreFilled /></el-icon>\r\n                      <span>未定稿</span>\r\n                    </div>\r\n                  </el-option>\r\n                  <el-option :value=\"1\" label=\"已定稿\">\r\n                    <div class=\"option-with-icon\">\r\n                      <el-icon><Select /></el-icon>\r\n                      <span>已定稿</span>\r\n                    </div>\r\n                  </el-option>\r\n                </el-select>\r\n              </el-form-item>\r\n            </el-col>\r\n          </el-row>\r\n\r\n          <el-row :gutter=\"24\">\r\n            <el-col :span=\"8\">\r\n              <el-form-item label=\"写手\" prop=\"writer_id\">\r\n                <el-select\r\n                  v-model=\"orderForm.writer_id\"\r\n                  placeholder=\"请选择写手\"\r\n                  filterable\r\n                  clearable\r\n                  style=\"width: 100%\"\r\n                  :loading=\"loadingWriters\"\r\n                >\r\n                  <template #prefix>\r\n                    <el-icon><User /></el-icon>\r\n                  </template>\r\n                  <el-option\r\n                    v-for=\"item in writerList\"\r\n                    :key=\"item.id\"\r\n                    :label=\"item.name\"\r\n                    :value=\"item.id\"\r\n                  >\r\n                    <div class=\"writer-option\">\r\n                      <span>{{ item.name }}</span>\r\n                      <span v-if=\"item.writer_id\" class=\"writer-id\">({{ item.writer_id }})</span>\r\n                    </div>\r\n                  </el-option>\r\n                </el-select>\r\n              </el-form-item>\r\n            </el-col>\r\n            <el-col :span=\"8\">\r\n              <el-form-item label=\"交稿时间\" prop=\"exchange_time\">\r\n                <el-date-picker\r\n                  v-model=\"orderForm.exchange_time\"\r\n                  type=\"datetime\"\r\n                  placeholder=\"选择交稿时间\"\r\n                  format=\"YYYY-MM-DD HH:mm:ss\"\r\n                  value-format=\"YYYY-MM-DD HH:mm:ss\"\r\n                  style=\"width: 100%\"\r\n                />\r\n              </el-form-item>\r\n            </el-col>\r\n            <el-col :span=\"8\">\r\n              <el-form-item label=\"是否新客户\" prop=\"new_customer\">\r\n                <el-select v-model=\"orderForm.new_customer\" placeholder=\"请选择\" style=\"width: 100%\">\r\n                  <el-option :value=\"0\" label=\"否\">\r\n                    <div class=\"option-with-icon\">\r\n                      <el-icon><Close /></el-icon>\r\n                      <span>否</span>\r\n                    </div>\r\n                  </el-option>\r\n                  <el-option :value=\"1\" label=\"是\">\r\n                    <div class=\"option-with-icon\">\r\n                      <el-icon><Check /></el-icon>\r\n                      <span>是</span>\r\n                    </div>\r\n                  </el-option>\r\n                </el-select>\r\n              </el-form-item>\r\n            </el-col>\r\n          </el-row>\r\n          \r\n          <el-row :gutter=\"24\">\r\n            <el-col :span=\"8\">\r\n              <el-form-item label=\"付款渠道\" prop=\"payment_channel\">\r\n                <el-input \r\n                  v-model=\"orderForm.payment_channel\" \r\n                  placeholder=\"请输入付款渠道\"\r\n                  prefix-icon=\"Money\"\r\n                />\r\n              </el-form-item>\r\n            </el-col>\r\n            <el-col :span=\"8\">\r\n              <el-form-item label=\"店铺/客户\" prop=\"store_name\">\r\n                <el-input \r\n                  v-model=\"orderForm.store_name\" \r\n                  placeholder=\"请输入店铺名或客户线下\"\r\n                  prefix-icon=\"Shop\" \r\n                />\r\n              </el-form-item>\r\n            </el-col>\r\n            <el-col :span=\"8\">\r\n              <el-form-item label=\"客户名称\" prop=\"customer_name\">\r\n                <el-input \r\n                  v-model=\"orderForm.customer_name\" \r\n                  placeholder=\"请输入客户名称\"\r\n                  prefix-icon=\"Avatar\" \r\n                />\r\n              </el-form-item>\r\n            </el-col>\r\n          </el-row>\r\n        </div>\r\n\r\n        <!-- 稿件信息 -->\r\n        <div class=\"form-section\">\r\n          <div class=\"section-header\">\r\n            <el-icon class=\"section-icon\"><Document /></el-icon>\r\n            <div class=\"section-title\">稿件信息</div>\r\n          </div>\r\n          <el-row :gutter=\"24\">\r\n            <el-col :span=\"8\">\r\n              <el-form-item label=\"稿件字数\" prop=\"word_count\">\r\n                <el-input-number\r\n                  v-model=\"orderForm.word_count\"\r\n                  :min=\"0\"\r\n                  controls-position=\"right\"\r\n                  style=\"width: 100%\"\r\n                  placeholder=\"请输入稿件字数\"\r\n                >\r\n                  <template #prefix>\r\n                    <el-icon><Reading /></el-icon>\r\n                  </template>\r\n                </el-input-number>\r\n              </el-form-item>\r\n            </el-col>\r\n            <el-col :span=\"8\">\r\n              <el-form-item label=\"稿费\" prop=\"fee\">\r\n                <el-input-number\r\n                  v-model=\"orderForm.fee\"\r\n                  :min=\"0\"\r\n                  :precision=\"2\"\r\n                  :step=\"0.01\"\r\n                  controls-position=\"right\"\r\n                  style=\"width: 100%\"\r\n                  placeholder=\"请输入稿费\"\r\n                >\r\n                  <template #prefix>\r\n                    <el-icon><Money /></el-icon>\r\n                  </template>\r\n                </el-input-number>\r\n              </el-form-item>\r\n            </el-col>\r\n            <el-col :span=\"8\">\r\n              <el-form-item label=\"稿件内容\" prop=\"order_content\">\r\n                <el-input\r\n                  v-model=\"orderForm.order_content\"\r\n                  type=\"textarea\"\r\n                  :rows=\"2\"\r\n                  placeholder=\"请输入稿件内容信息\"\r\n                />\r\n              </el-form-item>\r\n            </el-col>\r\n          </el-row>\r\n        </div>\r\n\r\n        <!-- 支付信息 -->\r\n        <div class=\"form-section\">\r\n          <div class=\"section-header\">\r\n            <el-icon class=\"section-icon\"><Wallet /></el-icon>\r\n            <div class=\"section-title\">支付信息</div>\r\n          </div>\r\n          <el-row :gutter=\"24\">\r\n            <el-col :span=\"8\">\r\n              <el-form-item label=\"订单金额\" prop=\"order_amount\">\r\n                <el-input-number\r\n                  v-model=\"orderForm.order_amount\"\r\n                  :min=\"0\"\r\n                  :precision=\"2\"\r\n                  :step=\"0.01\"\r\n                  controls-position=\"right\"\r\n                  style=\"width: 100%\"\r\n                  placeholder=\"请输入订单金额\"\r\n                >\r\n                  <template #prefix>\r\n                    <el-icon><Money /></el-icon>\r\n                  </template>\r\n                </el-input-number>\r\n              </el-form-item>\r\n            </el-col>\r\n            <el-col :span=\"8\">\r\n              <el-form-item label=\"退款金额\" prop=\"refund_amount\">\r\n                <el-input-number\r\n                  v-model=\"orderForm.refund_amount\"\r\n                  :min=\"0\"\r\n                  :precision=\"2\"\r\n                  :step=\"0.01\"\r\n                  controls-position=\"right\"\r\n                  style=\"width: 100%\"\r\n                  placeholder=\"请输入退款金额\"\r\n                >\r\n                  <template #prefix>\r\n                    <el-icon><TurnOff /></el-icon>\r\n                  </template>\r\n                </el-input-number>\r\n              </el-form-item>\r\n            </el-col>\r\n            <el-col :span=\"8\">\r\n              <el-form-item label=\"特殊情况\" prop=\"special_situation\">\r\n                <el-input\r\n                  v-model=\"orderForm.special_situation\"\r\n                  placeholder=\"请输入特殊情况(不结算)\"\r\n                  prefix-icon=\"Warning\"\r\n                />\r\n              </el-form-item>\r\n            </el-col>\r\n          </el-row>\r\n        </div>\r\n      </el-form>\r\n      \r\n      <template #footer>\r\n        <div class=\"dialog-footer\">\r\n          <el-button @click=\"dialogVisible = false\">\r\n            <el-icon><Close /></el-icon>\r\n            <span>取消</span>\r\n          </el-button>\r\n          <el-button type=\"primary\" @click=\"submitForm\" :loading=\"submitting\">\r\n            <el-icon><Check /></el-icon>\r\n            <span>确认</span>\r\n          </el-button>\r\n        </div>\r\n      </template>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, reactive, onMounted, watch, computed } from 'vue'\r\nimport { ElMessage, ElMessageBox } from 'element-plus'\r\nimport type { FormInstance, FormRules } from 'element-plus'\r\nimport { useUserStore } from '@/stores/user'\r\nimport { getWriterList } from '@/api/writer'\r\nimport { createCustomerOrder, getCustomerOrders, mergeCustomerOrders } from '@/api/customerOrder'\r\nimport type { CustomerOrderItem, CustomerOrderQuery } from '@/types/customerOrder'\r\nimport { Refresh, Document, User, Money, Shop, Avatar, Reading, Wallet, TurnOff, Warning, MoreFilled, Select, Close, Check } from '@element-plus/icons-vue'\r\n\r\nconst userStore = useUserStore()\r\n\r\n// 表单引用\r\nconst formRef = ref<FormInstance>()\r\n\r\n// 状态变量\r\nconst loading = ref(false)\r\nconst submitting = ref(false)\r\nconst syncing = ref(false)\r\nconst loadingWriters = ref(false)\r\nconst dialogVisible = ref(false)\r\nconst dialogTitle = ref('新增订单')\r\nconst dateRange = ref<[string, string] | null>(null)\r\n\r\n// 查询参数\r\nconst queryParams = reactive<CustomerOrderQuery>({\r\n  page: 1,\r\n  pageSize: 10\r\n})\r\n\r\n// 订单列表数据\r\nconst orderList = ref<CustomerOrderItem[]>([])\r\nconst total = ref(0)\r\nconst writerList = ref([])\r\n\r\n// 扩展CustomerOrder接口，添加customer_name字段\r\ninterface CustomerOrder {\r\n  id?: number\r\n  order_id: string\r\n  date: string\r\n  is_fixed: number\r\n  order_content?: string\r\n  word_count?: number\r\n  fee?: number\r\n  customer_id?: number\r\n  writer_id?: number\r\n  exchange_time?: string\r\n  payment_channel?: string\r\n  store_name?: string\r\n  customer_name?: string\r\n  order_amount?: number\r\n  refund_amount?: number\r\n  new_customer?: number\r\n  special_situation?: string\r\n}\r\n\r\n// 订单表单\r\nconst orderForm = ref<CustomerOrder>({\r\n  order_id: '',\r\n  date: new Date().toISOString().split('T')[0],\r\n  is_fixed: 0,\r\n  new_customer: 0,\r\n  customer_id: userStore.userInfo?.id\r\n})\r\n\r\n// 表单验证规则\r\nconst rules = reactive<FormRules>({\r\n  order_id: [\r\n    { required: true, message: '请输入订单编号', trigger: 'blur' }\r\n  ],\r\n  date: [\r\n    { required: true, message: '请选择日期', trigger: 'change' }\r\n  ],\r\n  is_fixed: [\r\n    { required: true, message: '请选择是否定稿', trigger: 'change' }\r\n  ],\r\n  writer_id: [\r\n    { required: true, message: '请选择写手', trigger: 'change' }\r\n  ]\r\n})\r\n\r\n// 监听日期范围变化\r\nwatch(dateRange, (newVal) => {\r\n  if (newVal) {\r\n    queryParams.date_start = newVal[0]\r\n    queryParams.date_end = newVal[1]\r\n  } else {\r\n    queryParams.date_start = undefined\r\n    queryParams.date_end = undefined\r\n  }\r\n})\r\n\r\n// 格式化日期\r\nconst formatDate = (dateStr: string) => {\r\n  if (!dateStr) return '-'\r\n  const date = new Date(dateStr)\r\n  return date.toLocaleString('zh-CN', {\r\n    year: 'numeric',\r\n    month: '2-digit',\r\n    day: '2-digit',\r\n    hour: '2-digit',\r\n    minute: '2-digit',\r\n    second: '2-digit'\r\n  })\r\n}\r\n\r\n// 获取订单列表\r\nconst getOrderList = async () => {\r\n  try {\r\n    loading.value = true\r\n    const { data } = await getCustomerOrders(queryParams)\r\n    if (data.data) {\r\n      orderList.value = data.data.list || []\r\n      total.value = data.data.total || 0\r\n    }\r\n  } catch (error) {\r\n    console.error('获取订单列表失败:', error)\r\n    ElMessage.error('获取订单列表失败')\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\n// 获取写手列表\r\nconst fetchWriterList = async () => {\r\n  try {\r\n    loadingWriters.value = true\r\n    const { data } = await getWriterList()\r\n    writerList.value = data.data || []\r\n  } catch (error) {\r\n    console.error('获取写手列表失败:', error)\r\n    ElMessage.error('获取写手列表失败')\r\n  } finally {\r\n    loadingWriters.value = false\r\n  }\r\n}\r\n\r\n// 搜索\r\nconst handleSearch = () => {\r\n  queryParams.page = 1\r\n  getOrderList()\r\n}\r\n\r\n// 重置查询\r\nconst resetQuery = () => {\r\n  queryParams.order_id = undefined\r\n  queryParams.is_fixed = undefined\r\n  dateRange.value = null\r\n  queryParams.date_start = undefined\r\n  queryParams.date_end = undefined\r\n  queryParams.page = 1\r\n  getOrderList()\r\n}\r\n\r\n// 处理页码变化\r\nconst handleCurrentChange = (page: number) => {\r\n  queryParams.page = page\r\n  getOrderList()\r\n}\r\n\r\n// 处理每页条数变化\r\nconst handleSizeChange = (size: number) => {\r\n  queryParams.pageSize = size\r\n  queryParams.page = 1\r\n  getOrderList()\r\n}\r\n\r\n// 新增订单\r\nconst handleAdd = () => {\r\n  dialogTitle.value = '新增订单'\r\n  resetForm()\r\n  dialogVisible.value = true\r\n}\r\n\r\n// 编辑订单\r\nconst handleEdit = (row: CustomerOrderItem) => {\r\n  dialogTitle.value = '编辑订单'\r\n  // 确保数值类型正确\r\n  orderForm.value = {\r\n    ...row,\r\n    is_fixed: Number(row.is_fixed),\r\n    new_customer: Number(row.new_customer || 0),\r\n    writer_id: row.writer_id || undefined\r\n  }\r\n  dialogVisible.value = true\r\n}\r\n\r\n// 查看订单\r\nconst handleView = (row: CustomerOrderItem) => {\r\n  dialogTitle.value = '查看订单'\r\n  // 确保数值类型正确\r\n  orderForm.value = {\r\n    ...row,\r\n    is_fixed: Number(row.is_fixed),\r\n    new_customer: Number(row.new_customer || 0),\r\n    writer_id: row.writer_id || undefined\r\n  }\r\n  dialogVisible.value = true\r\n}\r\n\r\n// 提交表单\r\nconst submitForm = async () => {\r\n  if (!formRef.value) return\r\n  \r\n  try {\r\n    await formRef.value.validate()\r\n    \r\n    submitting.value = true\r\n    await createCustomerOrder(orderForm.value)\r\n    \r\n    ElMessage.success('订单提交成功')\r\n    dialogVisible.value = false\r\n    getOrderList()\r\n    \r\n    // 提交成功后调用合并API，将客服订单同步到总表\r\n    try {\r\n      const mergeRes = await mergeCustomerOrders()\r\n      if (mergeRes.data.code === 0) {\r\n        ElMessage.success('订单已同步到总表')\r\n      } else {\r\n        console.warn('订单同步返回信息:', mergeRes.data.message)\r\n      }\r\n    } catch (mergeError) {\r\n      console.error('同步订单到总表失败:', mergeError)\r\n      ElMessage.warning('订单已创建，但同步到总表失败，请稍后手动同步')\r\n    }\r\n  } catch (error: any) {\r\n    console.error('提交订单失败:', error)\r\n    ElMessage.error(error.response?.data?.message || '提交订单失败')\r\n  } finally {\r\n    submitting.value = false\r\n  }\r\n}\r\n\r\n// 手动同步订单到总表\r\nconst handleSyncOrders = async () => {\r\n  try {\r\n    syncing.value = true\r\n    const res = await mergeCustomerOrders()\r\n    \r\n    if (res.data.code === 0) {\r\n      ElMessage.success(`同步成功，共处理 ${res.data.data.total} 条订单`)\r\n      getOrderList() // 刷新订单列表\r\n    } else {\r\n      ElMessage.info(res.data.message || '没有需要同步的订单')\r\n    }\r\n  } catch (error: any) {\r\n    console.error('同步订单失败:', error)\r\n    ElMessage.error(error.response?.data?.message || '同步订单失败')\r\n  } finally {\r\n    syncing.value = false\r\n  }\r\n}\r\n\r\n// 重置表单\r\nconst resetForm = () => {\r\n  if (formRef.value) {\r\n    formRef.value.resetFields()\r\n  }\r\n  \r\n  // 重置为默认值\r\n  orderForm.value = {\r\n    order_id: '',\r\n    date: new Date().toISOString().split('T')[0],\r\n    is_fixed: 0,\r\n    new_customer: 0,\r\n    customer_id: userStore.userInfo?.id,\r\n    writer_id: undefined // 确保写手ID被重置\r\n  }\r\n}\r\n\r\nonMounted(() => {\r\n  getOrderList()\r\n  fetchWriterList()\r\n})\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.app-container {\r\n  padding: 20px;\r\n}\r\n\r\n.toolbar {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: flex-start;\r\n  margin-bottom: 20px;\r\n  \r\n  .search-form {\r\n    flex: 1;\r\n  }\r\n  \r\n  .action-buttons {\r\n    margin-left: 16px;\r\n    display: flex;\r\n    align-items: center;\r\n    height: 32px; /* 与表单项高度一致 */\r\n  }\r\n}\r\n\r\n.pagination-container {\r\n  margin-top: 20px;\r\n  display: flex;\r\n  justify-content: flex-end;\r\n}\r\n\r\n.order-form {\r\n  .form-section {\r\n    margin-bottom: 24px;\r\n    padding: 16px;\r\n    background: #f8f9fa;\r\n    border-radius: 4px;\r\n\r\n    .section-title {\r\n      font-size: 16px;\r\n      font-weight: 500;\r\n      color: #1f2f3d;\r\n      margin-bottom: 16px;\r\n      padding-left: 8px;\r\n      border-left: 3px solid #409eff;\r\n    }\r\n  }\r\n}\r\n\r\n:deep(.el-form-item__label) {\r\n  font-weight: 500;\r\n}\r\n\r\n:deep(.el-input-number) {\r\n  width: 100%;\r\n}\r\n\r\n/* 只对下拉框应用固定宽度 */\r\n:deep(.el-select) {\r\n  width: 100px !important;\r\n}\r\n\r\n/* 确保表单项标签对齐 */\r\n:deep(.el-form--inline) {\r\n  .el-form-item {\r\n    margin-right: 16px;\r\n    margin-bottom: 16px;\r\n    \r\n    .el-form-item__label {\r\n      width: auto;\r\n      padding-right: 8px;\r\n    }\r\n  }\r\n}\r\n\r\n/* 确保按钮不重叠 */\r\n:deep(.el-form-item:last-child) {\r\n  .el-form-item__content {\r\n    display: flex;\r\n    gap: 8px;\r\n    \r\n    .el-button {\r\n      margin-left: 0;\r\n    }\r\n  }\r\n}\r\n\r\n.order-dialog {\r\n  :deep(.el-dialog__header) {\r\n    border-bottom: 1px solid #e9e9e9;\r\n    background-color: #f8f9fa;\r\n    padding: 16px 24px;\r\n    margin-right: 0;\r\n    \r\n    .el-dialog__title {\r\n      font-size: 18px;\r\n      font-weight: 600;\r\n      color: #1f2f3d;\r\n    }\r\n  }\r\n  \r\n  :deep(.el-dialog__body) {\r\n    padding: 24px;\r\n  }\r\n\r\n  .form-section {\r\n    margin-bottom: 24px;\r\n    padding: 16px;\r\n    background: #f8f9fa;\r\n    border-radius: 4px;\r\n    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);\r\n\r\n    .section-header {\r\n      display: flex;\r\n      align-items: center;\r\n      margin-bottom: 16px;\r\n      border-bottom: 1px solid #e9e9e9;\r\n      padding-bottom: 12px;\r\n\r\n      .section-icon {\r\n        font-size: 18px;\r\n        margin-right: 8px;\r\n        color: #409eff;\r\n      }\r\n\r\n      .section-title {\r\n        font-size: 16px;\r\n        font-weight: 500;\r\n        color: #1f2f3d;\r\n      }\r\n    }\r\n  }\r\n  \r\n  .writer-option {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: space-between;\r\n    \r\n    .writer-id {\r\n      color: #999; \r\n      font-size: 13px;\r\n      margin-left: 8px;\r\n    }\r\n  }\r\n  \r\n  .option-with-icon {\r\n    display: flex;\r\n    align-items: center;\r\n    \r\n    .el-icon {\r\n      margin-right: 8px;\r\n      font-size: 16px;\r\n    }\r\n  }\r\n}\r\n\r\n.dialog-footer {\r\n  display: flex;\r\n  justify-content: flex-end;\r\n  padding: 16px;\r\n  background: #f8f9fa;\r\n  border-top: 1px solid #e9e9e9;\r\n\r\n  .el-button {\r\n    margin-left: 12px;\r\n    padding: 8px 20px;\r\n    \r\n    .el-icon {\r\n      margin-right: 4px;\r\n    }\r\n  }\r\n}\r\n\r\n/* 输入框样式 */\r\n:deep(.el-input__wrapper) {\r\n  box-shadow: 0 0 0 1px #dcdfe6 inset;\r\n  \r\n  &:hover {\r\n    box-shadow: 0 0 0 1px #c0c4cc inset;\r\n  }\r\n  \r\n  &.is-focus {\r\n    box-shadow: 0 0 0 1px #409eff inset;\r\n  }\r\n}\r\n\r\n/* 数字输入框样式 */\r\n:deep(.el-input-number) {\r\n  .el-input__wrapper {\r\n    padding-right: 0;\r\n  }\r\n  \r\n  .el-input-number__decrease, \r\n  .el-input-number__increase {\r\n    border-left: 1px solid #dcdfe6;\r\n    background-color: #f5f7fa;\r\n    \r\n    &:hover {\r\n      color: #409eff;\r\n    }\r\n  }\r\n}\r\n</style> "],"names":["createCustomerOrder","data","request","getCustomerOrders","params","mergeCustomerOrders","userStore","useUserStore","formRef","ref","loading","submitting","syncing","loadingWriters","dialogVisible","dialogTitle","dateRange","queryParams","reactive","orderList","total","writerList","orderForm","_a","rules","watch","newVal","formatDate","dateStr","getOrderList","error","ElMessage","fetchWriterList","getWriterList","handleSearch","resetQuery","handleCurrentChange","page","handleSizeChange","size","handleAdd","resetForm","handleEdit","row","handleView","submitForm","mergeRes","mergeError","_b","handleSyncOrders","res","onMounted"],"mappings":"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"}