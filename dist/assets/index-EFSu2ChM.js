import{x as e,r as a,f as l,c as t,k as u,ag as r,aq as o,y as n,z as d,A as i,P as s,H as p,a5 as c,O as v,a4 as m,L as f,I as _,G as g,M as h,u as y,K as b,C as w}from"./vendor-BVd4RN3d.js";import{s as k}from"./index-CFSbY6bd.js";import{f as x}from"./user-CLx_oSFQ.js";import{h as V}from"./writer-BxWoWcMI.js";import{f as z}from"./format-B5gz6Uyj.js";import{E as C}from"./element-plus-CCDyQ1z5.js";import{_ as S}from"./_plugin-vue_export-helper-BCo6x5W8.js";const j={class:"app-container"},F={class:"toolbar"},T={class:"form-item-group"},U={class:"form-item-group"},E={class:"pagination-container"},M={class:"update-dialog-content"},Y={class:"channel-select"},D={class:"channel-buttons"},K=["onClick"],q={class:"channel-icon"},A={class:"channel-name"},I={class:"file-upload"},P={key:1,class:"multi-upload"},R=S(e({__name:"index",setup(e){const S=a(!1),R=a([]),G=a(0),H=a({page:1,pageSize:10,order_id:"",payment_id:"",channel:"",startTime:"",endTime:""}),L=a(),O=a([]),B=a(!1),J=a([]),N=a(!1),Q=async()=>{try{S.value=!0;const{data:a}=await(e=H.value,k({url:"/api/orders",method:"get",params:e})),{list:l,total:t}=a.data;R.value=l,G.value=t}catch(a){}finally{S.value=!1}var e};l(L,(e=>{e&&e[0]&&e[1]?(H.value.startTime=String(e[0]),H.value.endTime=String(e[1])):(H.value.startTime="",H.value.endTime="")}));const W=[{value:"",label:"全部"},{value:"支付宝",label:"支付宝"},{value:"企业微信",label:"企业微信"},{value:"匠易艺",label:"匠易艺"},{value:"慧辞",label:"慧辞"}],X=e=>({pending:"待支付",paid:"已支付",completed:"已完成",refunded:"已退款",cancelled:"已取消"}[e]||e),Z=()=>{H.value.page=1,Q()},$=()=>{H.value={page:1,pageSize:10,order_id:"",payment_id:"",channel:"",startTime:"",endTime:""},L.value=void 0,Q()},ee=e=>{H.value.pageSize=e,Q()},ae=e=>{H.value.page=e,Q()},le=a(!1),te=a(""),ue=a(null),re=a(null),oe=a(!1),ne=()=>{le.value=!0,te.value="",ue.value=null,re.value=null},de=(e,a)=>{ue.value=e.raw},ie=(e,a)=>{re.value=e.raw},se=t((()=>!!te.value&&(["支付宝","企业微信"].includes(te.value)?!!ue.value:!!["慧辞","匠易艺"].includes(te.value)&&(!!ue.value&&!!re.value))));l(te,(()=>{ue.value=null,re.value=null;document.querySelectorAll(".el-upload__input").forEach((e=>{e.value=""}))}));const pe=async()=>{var e,a;if(se.value)try{if(oe.value=!0,!ue.value)return void C.error("请选择订单文件");if(["慧辞","匠易艺"].includes(te.value)&&!re.value)return void C.error("请选择退款文件");const e=new FormData;e.append("channel",te.value),e.append("order_file",ue.value),re.value&&e.append("refund_file",re.value);const{data:a}=await function(e){return k({url:"/api/orders/process",method:"post",headers:{"Content-Type":"multipart/form-data"},data:e})}(e);C.success("处理成功"),le.value=!1,Q()}catch(l){const t=(null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.message)||"处理失败，请稍后重试";C.error(t)}finally{oe.value=!1}},ce=["支付宝","企业微信","慧辞","匠易艺"];return u((()=>{Q(),(async()=>{try{B.value=!0;const{data:e}=await x();O.value=e.data||[]}catch(e){C.error("获取客服列表失败")}finally{B.value=!1}})(),(async()=>{try{N.value=!0;const{data:e}=await V();J.value=e.data||[]}catch(e){C.error("获取写手列表失败")}finally{N.value=!1}})()})),(e,a)=>{const l=r("el-input"),t=r("el-form-item"),u=r("el-option"),k=r("el-select"),x=r("el-date-picker"),V=r("el-button"),C=r("el-form"),B=r("el-table-column"),N=r("el-tag"),Q=r("el-table"),ue=r("el-pagination"),re=r("Money"),ve=r("el-icon"),me=r("el-upload"),fe=r("el-dialog"),_e=o("loading");return n(),d("div",j,[i("div",F,[s(C,{inline:!0,model:H.value,class:"search-form"},{default:p((()=>[i("div",T,[s(t,{label:"订单编号"},{default:p((()=>[s(l,{modelValue:H.value.order_id,"onUpdate:modelValue":a[0]||(a[0]=e=>H.value.order_id=e),placeholder:"请输入",clearable:"",onKeyup:c(Z,["enter"])},null,8,["modelValue"])])),_:1}),s(t,{label:"支付单号"},{default:p((()=>[s(l,{modelValue:H.value.payment_id,"onUpdate:modelValue":a[1]||(a[1]=e=>H.value.payment_id=e),placeholder:"请输入",clearable:"",onKeyup:c(Z,["enter"])},null,8,["modelValue"])])),_:1}),s(t,{label:"订单渠道"},{default:p((()=>[s(k,{modelValue:H.value.channel,"onUpdate:modelValue":a[2]||(a[2]=e=>H.value.channel=e),placeholder:"请选择",clearable:"",filterable:""},{default:p((()=>[(n(),d(v,null,m(W,(e=>s(u,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])])),_:1})]),i("div",U,[s(t,{label:"创建时间"},{default:p((()=>[s(x,{modelValue:L.value,"onUpdate:modelValue":a[3]||(a[3]=e=>L.value=e),type:"daterange","value-format":"YYYY-MM-DD","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])])),_:1}),s(t,null,{default:p((()=>[s(V,{type:"primary",onClick:Z},{default:p((()=>a[8]||(a[8]=[f("搜索")]))),_:1}),s(V,{onClick:$},{default:p((()=>a[9]||(a[9]=[f("重置")]))),_:1}),s(V,{type:"success",onClick:ne},{default:p((()=>a[10]||(a[10]=[f("更新订单")]))),_:1})])),_:1})])])),_:1},8,["model"])]),_((n(),g(Q,{data:R.value,style:{width:"100%","margin-top":"20px"}},{default:p((()=>[s(B,{prop:"order_id",label:"订单编号",width:"180"}),s(B,{prop:"payment_id",label:"支付单号",width:"180"}),s(B,{prop:"customer",label:"客服",width:"120"},{default:p((({row:e})=>{var a;return[i("span",null,h((null==(a=O.value.find((a=>a.id===e.customer_id)))?void 0:a.username)||"暂无"),1)]})),_:1}),s(B,{prop:"writer",label:"写手",width:"120"},{default:p((({row:e})=>{var a;return[i("span",null,h((null==(a=J.value.find((a=>a.id===e.writer_id)))?void 0:a.name)||"暂无"),1)]})),_:1}),s(B,{prop:"amount",label:"买家实付金额",width:"120"},{default:p((({row:e})=>[f(" ¥"+h(parseFloat(e.amount).toFixed(2)),1)])),_:1}),s(B,{prop:"status",label:"订单状态",width:"100"},{default:p((({row:e})=>{return[s(N,{type:(a=e.status,{paid:"success",pending:"warning",cancelled:"danger",refunded:"info",completed:"success"}[a]||"info")},{default:p((()=>[f(h(X(e.status)),1)])),_:2},1032,["type"])];var a})),_:1}),s(B,{prop:"channel",label:"订单渠道",width:"100"},{default:p((({row:e})=>{return[f(h((a=e.channel,{"":"全部","支付宝":"支付宝","企业微信":"企业微信","匠易艺":"匠易艺","慧辞":"慧辞"}[a]||a)),1)];var a})),_:1}),s(B,{prop:"refund_amount",label:"退款金额",width:"120"},{default:p((({row:e})=>[f(" ¥"+h(parseFloat(e.refund_amount).toFixed(2)),1)])),_:1}),s(B,{prop:"fee",label:"手续费",width:"120"},{default:p((({row:e})=>[f(" ¥"+h(parseFloat(e.fee).toFixed(2)),1)])),_:1}),s(B,{prop:"merchant_payment",label:"打款商家金额",width:"120"},{default:p((({row:e})=>[f(" ¥"+h(parseFloat(e.merchant_payment).toFixed(2)),1)])),_:1}),s(B,{prop:"create_time",label:"创建时间",width:"180"},{default:p((({row:e})=>[f(h(y(z)(e.create_time)),1)])),_:1}),s(B,{prop:"confirm_time",label:"确认收货时间",width:"180"},{default:p((({row:e})=>[f(h(y(z)(e.confirm_time)),1)])),_:1}),s(B,{prop:"merchant_remark",label:"商家备注","min-width":"200"})])),_:1},8,["data"])),[[_e,S.value]]),i("div",E,[s(ue,{"current-page":H.value.page,"onUpdate:currentPage":a[4]||(a[4]=e=>H.value.page=e),"page-size":H.value.pageSize,"onUpdate:pageSize":a[5]||(a[5]=e=>H.value.pageSize=e),"page-sizes":[10,20,50,100],total:G.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ee,onCurrentChange:ae},null,8,["current-page","page-size","total"])]),s(fe,{title:"更新订单",modelValue:le.value,"onUpdate:modelValue":a[7]||(a[7]=e=>le.value=e),width:"800px","close-on-click-modal":!1,class:"update-dialog"},{footer:p((()=>[s(V,{onClick:a[6]||(a[6]=e=>le.value=!1)},{default:p((()=>a[19]||(a[19]=[f("取消")]))),_:1}),s(V,{type:"primary",onClick:pe,loading:oe.value,disabled:!se.value},{default:p((()=>a[20]||(a[20]=[f(" 确定更新 ")]))),_:1},8,["loading","disabled"])])),default:p((()=>[i("div",M,[i("div",Y,[a[11]||(a[11]=i("h3",null,"选择渠道",-1)),i("div",D,[(n(),d(v,null,m(ce,(e=>i("div",{key:e,class:w(["channel-button",{active:te.value===e}]),onClick:a=>te.value=e},[i("span",q,[s(ve,null,{default:p((()=>[s(re)])),_:1})]),i("span",A,h(e),1)],10,K))),64))])]),i("div",I,[a[18]||(a[18]=i("h3",null,"上传文件",-1)),["支付宝","企业微信"].includes(te.value)?(n(),g(me,{key:0,ref:"uploadRef",class:"upload-area",action:"#","auto-upload":!1,limit:1,"on-change":de},{trigger:p((()=>[s(V,{type:"primary"},{default:p((()=>a[12]||(a[12]=[f("选择订单文件")]))),_:1})])),tip:p((()=>a[13]||(a[13]=[i("div",{class:"el-upload__tip"}," 请选择 Excel 格式的订单文件 ",-1)]))),_:1},512)):["慧辞","匠易艺"].includes(te.value)?(n(),d("div",P,[s(me,{ref:"uploadRef",class:"upload-area",action:"#","auto-upload":!1,limit:1,"on-change":de},{trigger:p((()=>[s(V,{type:"primary"},{default:p((()=>a[14]||(a[14]=[f("选择订单文件")]))),_:1})])),tip:p((()=>a[15]||(a[15]=[i("div",{class:"el-upload__tip"}," 请选择 Excel 格式的订单文件 ",-1)]))),_:1},512),s(me,{class:"upload-area",action:"#","auto-upload":!1,limit:1,"on-change":ie},{trigger:p((()=>[s(V,{type:"primary"},{default:p((()=>a[16]||(a[16]=[f("选择退款文件")]))),_:1})])),tip:p((()=>a[17]||(a[17]=[i("div",{class:"el-upload__tip"}," 请选择 Excel 格式的退款文件 ",-1)]))),_:1})])):b("",!0)])])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-bca7c8cf"]]);export{R as default};
