import{D as w,d as Z,r,n as ee,m as le,b as n,G as ae,o as _,c as U,f as te,e as a,w as t,p as oe,x as L,K as se,F as R,q as T,i as m,t as q,g as ue,C as re,E as C}from"./index-D2BneEQd.js";import{g as ne}from"./role-BGF-bRbP.js";import{f as de}from"./format-DZvyx3OM.js";import{a as ie}from"./date-CLpD1YEj.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";function pe(d){return w({url:"/api/users",method:"get",params:d})}function ve(d){return w({url:"/api/users",method:"post",data:d})}function fe(d,f){return w({url:`/api/users/${d}`,method:"put",data:f})}function ce(d){return w({url:`/api/users/${d}`,method:"delete"})}function _e(d,f){return w({url:`/api/users/${d}/status`,method:"put",data:f})}const ge={class:"app-container"},be={class:"toolbar"},Ve=Z({__name:"index",setup(d){const f=r(!1),B=r([]),b=r([]),g=r(!1),x=r(""),h=r(!1),V=r(),s=r({username:"",password:"",role_id:0,real_name:"",email:"",status:1}),u=r({page:1,pageSize:10,username:"",role_id:void 0,status:void 0}),Y={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],role_id:[{required:!0,message:"请选择角色",trigger:"change"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]},K=[{label:"启用",value:1},{label:"禁用",value:0}],N=r(0);r({username:"",role_id:"",status:""});const D=r(),y=async()=>{try{f.value=!0;const{data:o}=await pe(u.value),{list:e,total:p}=o.data;B.value=e,N.value=p}catch(o){console.error("获取用户列表失败:",o)}finally{f.value=!1}},z=async()=>{try{const o=await ne();b.value=o.data,console.log("res",b.value)}catch(o){console.error("Get roles error:",o)}},E=()=>{console.log("点击搜索按钮，查询条件:",u.value),y()},G=()=>{u.value={page:1,pageSize:10,username:"",role_id:void 0,status:void 0},y()},I=()=>{x.value="新增用户",g.value=!0},A=o=>{x.value="编辑用户",s.value={...o,password:""},g.value=!0},O=async o=>{try{await re.confirm("确认删除该用户吗？","提示",{type:"warning"}),await ce(o.id),C.success("删除成功"),y()}catch(e){console.error("Delete user error:",e)}},P=async o=>{try{await _e(o.id,{status:o.status}),C.success("状态更新成功")}catch(e){console.error("更新状态失败:",e),o.status=o.status===1?0:1}},Q=async()=>{if(V.value){await V.value.validate();try{h.value=!0;const o={...s.value};o.password||delete o.password,s.value.id?(await fe(s.value.id,o),C.success("更新成功")):(await ve(o),C.success("创建成功")),g.value=!1,y()}catch(o){console.error("Submit user error:",o)}finally{h.value=!1}}},j=()=>{V.value&&V.value.resetFields(),s.value={username:"",password:"",role_id:0,real_name:"",email:"",status:1}};return ee(D,o=>{const{startTime:e,endTime:p}=ie(o);u.value.startTime=e,u.value.endTime=p}),le(async()=>{await y(),await z(),console.log("roleList:",b.value)}),(o,e)=>{const p=n("el-input"),i=n("el-form-item"),S=n("el-option"),$=n("el-select"),c=n("el-button"),F=n("el-form"),v=n("el-table-column"),M=n("el-switch"),H=n("el-table"),J=n("el-dialog"),W=n("el-date-picker"),X=ae("loading");return _(),U("div",ge,[te("div",be,[a(F,{inline:!0,model:u.value,class:"search-form"},{default:t(()=>[a(i,null,{default:t(()=>[a(p,{modelValue:u.value.username,"onUpdate:modelValue":e[0]||(e[0]=l=>u.value.username=l),placeholder:"用户名",clearable:"",onKeyup:se(E,["enter"])},null,8,["modelValue"])]),_:1}),a(i,null,{default:t(()=>[a($,{modelValue:u.value.role_id,"onUpdate:modelValue":e[1]||(e[1]=l=>u.value.role_id=l),placeholder:"角色",clearable:"",filterable:""},{default:t(()=>[(_(!0),U(R,null,T(b.value,l=>(_(),L(S,{key:l.id,label:l.role_name,value:l.id},{default:t(()=>[m(q(l.role_name),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(i,null,{default:t(()=>[a($,{modelValue:u.value.status,"onUpdate:modelValue":e[2]||(e[2]=l=>u.value.status=l),placeholder:"状态",clearable:"",filterable:""},{default:t(()=>[(_(),U(R,null,T(K,l=>a(S,{key:l.value,label:l.label,value:l.value},{default:t(()=>[m(q(l.label),1)]),_:2},1032,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(i,null,{default:t(()=>[a(c,{type:"primary",onClick:E},{default:t(()=>e[12]||(e[12]=[m("搜索")])),_:1}),a(c,{onClick:G},{default:t(()=>e[13]||(e[13]=[m("重置")])),_:1})]),_:1})]),_:1},8,["model"]),a(c,{type:"primary",onClick:I},{default:t(()=>e[14]||(e[14]=[m("新增用户")])),_:1})]),oe((_(),L(H,{data:B.value,style:{width:"100%","margin-top":"20px"}},{default:t(()=>[a(v,{prop:"id",label:"ID",width:"80"}),a(v,{prop:"username",label:"用户名"}),a(v,{prop:"real_name",label:"姓名"}),a(v,{prop:"email",label:"邮箱"}),a(v,{prop:"role.role_name",label:"角色"}),a(v,{label:"状态",width:"100"},{default:t(({row:l})=>[a(M,{modelValue:l.status,"onUpdate:modelValue":k=>l.status=k,"active-value":1,"inactive-value":0,onChange:k=>P(l)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),a(v,{prop:"created_at",label:"创建时间",width:"180"},{default:t(({row:l})=>[m(q(ue(de)(l.created_at)),1)]),_:1}),a(v,{label:"操作",width:"200",fixed:"right"},{default:t(({row:l})=>[a(c,{type:"primary",link:"",onClick:k=>A(l)},{default:t(()=>e[15]||(e[15]=[m("编辑")])),_:2},1032,["onClick"]),a(c,{type:"danger",link:"",onClick:k=>O(l)},{default:t(()=>e[16]||(e[16]=[m("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[X,f.value]]),a(J,{title:x.value,modelValue:g.value,"onUpdate:modelValue":e[10]||(e[10]=l=>g.value=l),width:"500px",onClose:j},{footer:t(()=>[a(c,{onClick:e[9]||(e[9]=l=>g.value=!1)},{default:t(()=>e[17]||(e[17]=[m("取消")])),_:1}),a(c,{type:"primary",onClick:Q,loading:h.value},{default:t(()=>e[18]||(e[18]=[m(" 确定 ")])),_:1},8,["loading"])]),default:t(()=>[a(F,{ref_key:"formRef",ref:V,model:s.value,rules:Y,"label-width":"80px"},{default:t(()=>[a(i,{label:"用户名",prop:"username"},{default:t(()=>[a(p,{modelValue:s.value.username,"onUpdate:modelValue":e[3]||(e[3]=l=>s.value.username=l),placeholder:"请输入用户名",disabled:!!s.value.id},null,8,["modelValue","disabled"])]),_:1}),a(i,{label:"密码",prop:"password",rules:[{required:!s.value.id,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能小于6位",trigger:"blur"}]},{default:t(()=>[a(p,{modelValue:s.value.password,"onUpdate:modelValue":e[4]||(e[4]=l=>s.value.password=l),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1},8,["rules"]),a(i,{label:"姓名",prop:"real_name"},{default:t(()=>[a(p,{modelValue:s.value.real_name,"onUpdate:modelValue":e[5]||(e[5]=l=>s.value.real_name=l),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),a(i,{label:"邮箱",prop:"email"},{default:t(()=>[a(p,{modelValue:s.value.email,"onUpdate:modelValue":e[6]||(e[6]=l=>s.value.email=l),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),a(i,{label:"角色",prop:"role_id"},{default:t(()=>[a($,{modelValue:s.value.role_id,"onUpdate:modelValue":e[7]||(e[7]=l=>s.value.role_id=l),placeholder:"请选择角色"},{default:t(()=>[(_(!0),U(R,null,T(b.value,l=>(_(),L(S,{key:l.id,label:l.role_name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(i,{label:"状态",prop:"status"},{default:t(()=>[a(M,{modelValue:s.value.status,"onUpdate:modelValue":e[8]||(e[8]=l=>s.value.status=l),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),a(W,{modelValue:D.value,"onUpdate:modelValue":e[11]||(e[11]=l=>D.value=l),type:"daterange","value-format":"YYYY-MM-DD","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])])}}}),xe=me(Ve,[["__scopeId","data-v-90ea8534"]]);export{xe as default};
//# sourceMappingURL=index-BAcU-mu4.js.map
