import{g as j,d as H,u as T,c as J,a as O}from"./role-BGF-bRbP.js";import{f as Q}from"./format-DZvyx3OM.js";import{g as W}from"./menu-YiF2EqA-.js";import{a as X}from"./date-CLpD1YEj.js";import{d as Z,r,n as ee,m as le,b as i,G as ae,o as h,c as te,f as oe,e as a,w as t,p as re,x as ne,i as u,t as se,g as ie,C as ue,E as v}from"./index-D2BneEQd.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";const me={class:"app-container"},ce={class:"toolbar"},pe=Z({__name:"index",setup(fe){const _=r(!1),C=r([]),d=r(!1),g=r(""),c=r(!1),m=r(!1),p=r(),n=r({role_name:"",description:"",menu_ids:[]}),B={role_name:[{required:!0,message:"请输入角色名称",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}]},V=r({page:1,pageSize:10,role_name:"",startTime:"",endTime:""}),y=async()=>{try{_.value=!0;const l=await j();C.value=l.data}catch(l){console.error("Get roles error:",l)}finally{_.value=!1}},E=()=>{g.value="新增角色",d.value=!0},S=l=>{g.value="编辑角色",n.value={...l},d.value=!0},U=async l=>{try{await ue.confirm("确认删除该角色吗？","提示",{type:"warning"}),await H(l.id),v.success("删除成功"),y()}catch(e){console.error("Delete role error:",e)}},$=async()=>{if(p.value){await p.value.validate();try{m.value=!0,n.value.id?(await T(n.value.id,{role_name:n.value.role_name,description:n.value.description,menu_ids:n.value.menu_ids}),v.success("更新成功")):(await J({role_name:n.value.role_name,description:n.value.description,menu_ids:n.value.menu_ids}),v.success("创建成功")),d.value=!1,y()}catch(l){console.error("Submit role error:",l)}finally{m.value=!1}}},G=()=>{p.value&&p.value.resetFields(),n.value={role_name:"",description:"",menu_ids:[]}},k=r(),x=r([]),R=r([]),b=r(),Y=async()=>{try{const l=await W();x.value=l.data}catch(l){console.error("Get menus error:",l)}},F=async l=>{try{b.value=l.id,await Y();const e=await O(l.id);R.value=e.data.map(s=>s.id),c.value=!0}catch(e){console.error("Get role menus error:",e)}},I=async()=>{if(!(!b.value||!k.value))try{m.value=!0;const l=k.value.getCheckedKeys();await T(b.value,{menu_ids:l}),v.success("权限设置成功"),c.value=!1}catch(l){console.error("Update role permissions error:",l)}finally{m.value=!1}},w=r();return ee(w,l=>{const{startTime:e,endTime:s}=X(l);V.value.startTime=e,V.value.endTime=s}),le(()=>{y()}),(l,e)=>{const s=i("el-button"),f=i("el-table-column"),L=i("el-table"),N=i("el-input"),P=i("el-form-item"),q=i("el-form"),D=i("el-dialog"),K=i("el-tree"),z=i("el-date-picker"),A=ae("loading");return h(),te("div",me,[oe("div",ce,[a(s,{type:"primary",onClick:E},{default:t(()=>e[6]||(e[6]=[u("新增角色")])),_:1})]),re((h(),ne(L,{data:C.value,style:{width:"100%","margin-top":"20px"}},{default:t(()=>[a(f,{prop:"id",label:"ID",width:"80"}),a(f,{prop:"role_name",label:"角色名称"}),a(f,{prop:"description",label:"描述"}),a(f,{prop:"created_at",label:"创建时间",width:"180"},{default:t(({row:o})=>[u(se(ie(Q)(o.created_at)),1)]),_:1}),a(f,{label:"操作",width:"250",fixed:"right"},{default:t(({row:o})=>[a(s,{type:"primary",link:"",onClick:M=>S(o)},{default:t(()=>e[7]||(e[7]=[u("编辑")])),_:2},1032,["onClick"]),a(s,{type:"primary",link:"",onClick:M=>F(o)},{default:t(()=>e[8]||(e[8]=[u("权限设置")])),_:2},1032,["onClick"]),a(s,{type:"danger",link:"",onClick:M=>U(o)},{default:t(()=>e[9]||(e[9]=[u("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[A,_.value]]),a(D,{title:g.value,modelValue:d.value,"onUpdate:modelValue":e[2]||(e[2]=o=>d.value=o),width:"500px",onClose:G},{footer:t(()=>[a(s,{onClick:e[1]||(e[1]=o=>d.value=!1)},{default:t(()=>e[10]||(e[10]=[u("取消")])),_:1}),a(s,{type:"primary",onClick:$,loading:m.value},{default:t(()=>e[11]||(e[11]=[u(" 确定 ")])),_:1},8,["loading"])]),default:t(()=>[a(q,{ref_key:"formRef",ref:p,model:n.value,rules:B,"label-width":"80px"},{default:t(()=>[a(P,{label:"角色名称",prop:"role_name"},{default:t(()=>[a(N,{modelValue:n.value.role_name,"onUpdate:modelValue":e[0]||(e[0]=o=>n.value.role_name=o),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),a(D,{title:"权限设置",modelValue:c.value,"onUpdate:modelValue":e[4]||(e[4]=o=>c.value=o),width:"600px"},{footer:t(()=>[a(s,{onClick:e[3]||(e[3]=o=>c.value=!1)},{default:t(()=>e[12]||(e[12]=[u("取消")])),_:1}),a(s,{type:"primary",onClick:I,loading:m.value},{default:t(()=>e[13]||(e[13]=[u(" 确定 ")])),_:1},8,["loading"])]),default:t(()=>[a(K,{ref_key:"treeRef",ref:k,data:x.value,"show-checkbox":"","node-key":"id",props:{label:"name"},"default-checked-keys":R.value},null,8,["data","default-checked-keys"])]),_:1},8,["modelValue"]),a(z,{modelValue:w.value,"onUpdate:modelValue":e[5]||(e[5]=o=>w.value=o),type:"daterange","value-format":"YYYY-MM-DD","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])])}}}),we=de(pe,[["__scopeId","data-v-d916211e"]]);export{we as default};
//# sourceMappingURL=index-D5IZ_qn1.js.map
