{"version":3,"file":"index-a5VC-OjY.js","sources":["../../src/views/writer-application/index.vue"],"sourcesContent":["<template>\n  <div class=\"application-container\">\n    <div class=\"form-card\" v-show=\"formVisible\">\n      <h2>写手申请</h2>\n      <el-form\n        ref=\"formRef\"\n        :model=\"applicationForm\"\n        :rules=\"rules\"\n        label-position=\"top\"\n        class=\"application-form\"\n      >\n        <el-form-item label=\"姓名\" prop=\"name\">\n          <el-input v-model=\"applicationForm.name\" placeholder=\"请输入姓名\" />\n        </el-form-item>\n        \n        <el-form-item label=\"学历\" prop=\"education\">\n          <el-select v-model=\"applicationForm.education\" placeholder=\"请选择学历\" style=\"width: 100%\">\n            <el-option\n              v-for=\"item in educationOptions\"\n              :key=\"item.value\"\n              :label=\"item.label\"\n              :value=\"item.value\"\n            />\n          </el-select>\n        </el-form-item>\n\n        <el-form-item label=\"专业\" prop=\"major\">\n          <el-input v-model=\"applicationForm.major\" placeholder=\"请输入专业\" />\n        </el-form-item>\n\n        <el-form-item label=\"写作水平\" prop=\"writing_experience\">\n          <el-select v-model=\"applicationForm.writing_experience\" placeholder=\"请选择写作水平\" style=\"width: 100%\">\n            <el-option\n              v-for=\"item in experienceOptions\"\n              :key=\"item.value\"\n              :label=\"item.label\"\n              :value=\"item.value\"\n            />\n          </el-select>\n        </el-form-item>\n\n        <el-form-item label=\"身份证号\" prop=\"id_number\">\n          <el-input \n            v-model=\"applicationForm.id_number\" \n            placeholder=\"请输入身份证号\"\n            maxlength=\"18\"\n            show-word-limit\n          />\n        </el-form-item>\n\n        <el-form-item label=\"手机号码1\" prop=\"phone_1\">\n          <el-input v-model=\"applicationForm.phone_1\" placeholder=\"请输入手机号码\" />\n        </el-form-item>\n\n        <el-form-item label=\"手机号码2\" prop=\"phone_2\">\n          <el-input v-model=\"applicationForm.phone_2\" placeholder=\"请输入备用手机号码\" />\n        </el-form-item>\n\n        <el-form-item label=\"支付宝姓名\" prop=\"alipay_name\" required>\n          <el-input v-model=\"applicationForm.alipay_name\" placeholder=\"请输入支付宝姓名\" />\n        </el-form-item>\n\n        <el-form-item label=\"支付宝账号\" prop=\"alipay_account\" required>\n          <el-input v-model=\"applicationForm.alipay_account\" placeholder=\"请输入支付宝账号\" />\n        </el-form-item>\n\n        <el-form-item label=\"擅长内容\" prop=\"specialized_content\">\n          <div class=\"tag-container\">\n            <el-tag\n              v-for=\"item in specializedOptions\"\n              :key=\"item.value\"\n              :type=\"selectedSpecialized.includes(item.value) ? 'primary' : 'info'\"\n              class=\"specialized-tag\"\n              @click=\"toggleSpecialized(item.value)\"\n            >\n              {{ item.label }}\n            </el-tag>\n          </div>\n        </el-form-item>\n\n        <el-form-item label=\"申请日期\" prop=\"apply_date\" v-if=\"!isPublicAccess\">\n          <el-date-picker\n            v-model=\"applyDate\"\n            type=\"date\"\n            value-format=\"YYYY-MM-DD\"\n            placeholder=\"选择日期\"\n          />\n        </el-form-item>\n\n        <el-form-item>\n          <el-button type=\"primary\" class=\"submit-btn\" @click=\"handleSubmit\" :loading=\"submitting\">\n            提交申请\n          </el-button>\n        </el-form-item>\n      </el-form>\n    </div>\n\n    <!-- 提交成功弹窗 -->\n    <el-dialog\n      title=\"申请提交成功\"\n      v-model=\"successDialogVisible\"\n      width=\"400px\"\n      :close-on-click-modal=\"false\"\n      :show-close=\"false\"\n    >\n      <div class=\"success-info\">\n        <el-icon class=\"success-icon\"><CircleCheckFilled /></el-icon>\n        <h3>您的写手ID：{{ submittedWriterId }}</h3>\n        <p>请截图保存此信息</p>\n      </div>\n      <template #footer>\n        <el-button type=\"primary\" @click=\"handleClose\">我已保存</el-button>\n      </template>\n    </el-dialog>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, onMounted, watch } from 'vue'\nimport { useRoute, useRouter } from 'vue-router'\nimport { ElMessage } from 'element-plus'\nimport { CircleCheckFilled } from '@element-plus/icons-vue'\nimport { createWriter } from '@/api/writer'\nimport type { FormInstance, FormRules } from 'element-plus'\nimport type { WriterForm } from '@/types/writer'\nimport { getClientIp } from '@/utils/ip'\nimport type { DateModelType } from 'element-plus'\nimport { formatDate } from '@/utils/date'\n\nconst route = useRoute()\nconst router = useRouter()\nconst formRef = ref<FormInstance>()\nconst submitting = ref(false)\nconst successDialogVisible = ref(false)\nconst submittedWriterId = ref('')\nconst formVisible = ref(false)\nconst selectedSpecialized = ref<string[]>([])\nconst applyDate = ref<DateModelType | undefined>()\nconst isPublicAccess = route.name === 'WriterApplication' // 判断是否是公开访问\n\n// 表单数据\nconst applicationForm = ref<WriterForm>({\n  name: '',\n  education: '',\n  major: '',\n  writing_experience: '',\n  specialized_content: '',\n  phone_1: '',\n  phone_2: '',\n  alipay_name: '',\n  alipay_account: '',\n  id_number: '',\n  ip_address: '',\n  apply_date: ''\n})\n\n// 表单校验规则\nconst rules: FormRules = {\n  name: [\n    { required: true, message: '请输入姓名', trigger: 'blur' }\n  ],\n  education: [\n    { required: true, message: '请选择学历', trigger: 'change' }\n  ],\n  major: [\n    { required: true, message: '请输入专业', trigger: 'blur' }\n  ],\n  writing_experience: [\n    { required: true, message: '请选择写作水平', trigger: 'change' }\n  ],\n  id_number: [\n    { required: true, message: '请输入身份证号', trigger: 'blur' },\n    { pattern: /(^\\d{15}$)|(^\\d{18}$)|(^\\d{17}(\\d|X|x)$)/, message: '请输入正确的身份证号', trigger: 'blur' }\n  ],\n  phone_1: [\n    { required: true, message: '请输入手机号码', trigger: 'blur' },\n    { pattern: /^1[3-9]\\d{9}$/, message: '请输入正确的手机号码', trigger: 'blur' }\n  ],\n  specialized_content: [\n    { required: true, message: '请选择擅长内容', trigger: 'change' }\n  ],\n  alipay_name: [\n    { required: true, message: '请输入支付宝姓名', trigger: 'blur' }\n  ],\n  alipay_account: [\n    { required: true, message: '请输入支付宝账号', trigger: 'blur' }\n  ]\n}\n\n// 选项数据\nconst educationOptions = [\n  { value: '专科', label: '专科' },\n  { value: '本科', label: '本科' },\n  { value: '硕士', label: '硕士' },\n  { value: '博士', label: '博士' }\n]\n\nconst experienceOptions = [\n  { value: '大学水平', label: '大学水平' },\n  { value: '在职水平', label: '在职水平' },\n  { value: '事业单位水平', label: '事业单位水平' },\n  { value: '淘宝老手', label: '淘宝老手' },\n  { value: '在职老师', label: '在职老师' },\n  { value: '期刊报告科研', label: '期刊报告科研' }\n]\n\nconst specializedOptions = [\n  { value: 'ppt制作', label: 'PPT制作' },\n  { value: '演讲稿、征文、读后感', label: '演讲稿/征文/读后感' },\n  { value: '公文类、对照材料、生活会、讲话稿，公文材料、研讨材料、领导讲话', label: '公文材料/讲话稿' },\n  { value: '调查报告、学术报告、期刊、研究性文章', label: '报告/期刊/论文' },\n  { value: '广告词、广告语、推文、商业文案', label: '广告/文案' },\n  { value: '商业计划书、策划方案、项目可行性研究报告', label: '计划书/方案' },\n  { value: '保洁、物业、工程、绿化、采购标书', label: '标书类' },\n  { value: '抄写', label: '抄写' }\n]\n\n// 切换擅长内容选择\nconst toggleSpecialized = (value: string) => {\n  const index = selectedSpecialized.value.indexOf(value)\n  if (index === -1) {\n    selectedSpecialized.value.push(value)\n  } else {\n    selectedSpecialized.value.splice(index, 1)\n  }\n  // 更新表单的 specialized_content 字段\n  applicationForm.value.specialized_content = selectedSpecialized.value.join(';')\n}\n\n// 监听日期变化\nwatch(applyDate, (val) => {\n  applicationForm.value.apply_date = formatDate(val)\n})\n\n// 提交表单\nconst handleSubmit = async () => {\n  if (!formRef.value) return\n  \n  try {\n    await formRef.value.validate()\n    submitting.value = true\n    \n    const ip = await getClientIp()\n    applicationForm.value.ip_address = ip\n    \n    if (isPublicAccess) {\n      // 公开申请逻辑\n      await submitApplication(applicationForm.value)\n    } else {\n      // 后台新增写手逻辑\n      await createWriter(applicationForm.value)\n    }\n    \n    ElMessage.success(isPublicAccess ? '申请提交成功' : '写手添加成功')\n    successDialogVisible.value = true\n  } catch (error) {\n    console.error('操作失败:', error)\n    ElMessage.error('操作失败')\n  } finally {\n    submitting.value = false\n  }\n}\n\n// 关闭成功弹窗\nconst handleClose = () => {\n  successDialogVisible.value = false\n  // 可以跳转到一个静态页面或关闭窗口\n  window.close()\n}\n\nonMounted(() => {\n  // 直接显示表单\n  formVisible.value = true\n  \n  // 设置申请日期为当前日期\n  const currentDate = formatDate(new Date())\n  applicationForm.value.apply_date = currentDate\n  \n  if (!isPublicAccess) {\n    // 只有在后台新增时才需要设置日期选择器的值\n    applyDate.value = new Date()\n  }\n})\n</script>\n\n<style lang=\"scss\" scoped>\n.application-container {\n  min-height: 100vh;\n  background: #f0f2f5;\n  padding: 16px;\n  \n  .form-card {\n    max-width: 100%;\n    margin: 0 auto;\n    background: #fff;\n    padding: 20px;\n    border-radius: 8px;\n    box-shadow: 0 2px 12px 0 rgba(0,0,0,0.1);\n\n    @media screen and (min-width: 768px) {\n      max-width: 600px;\n      padding: 30px;\n    }\n\n    h2 {\n      text-align: center;\n      margin-bottom: 24px;\n      color: #303133;\n      font-size: 20px;\n    }\n  }\n}\n\n.application-form {\n  :deep(.el-form-item) {\n    margin-bottom: 20px;\n    \n    .el-form-item__label {\n      padding-bottom: 8px;\n      font-size: 15px;\n    }\n    \n    .el-input, .el-select {\n      width: 100%;\n    }\n  }\n}\n\n.tag-container {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n  \n  .specialized-tag {\n    margin: 0;\n    padding: 6px 12px;\n    font-size: 14px;\n    cursor: pointer;\n    user-select: none;\n    \n    &:active {\n      opacity: 0.8;\n    }\n  }\n}\n\n.submit-btn {\n  width: 100%;\n  margin-top: 16px;\n  padding: 12px 0;\n  font-size: 16px;\n}\n\n// 优化成功弹窗在移动端的显示\n:deep(.el-dialog) {\n  width: 90% !important;\n  max-width: 400px;\n  \n  .success-info {\n    padding: 16px 0;\n    \n    .success-icon {\n      font-size: 40px;\n    }\n    \n    h3 {\n      font-size: 16px;\n      margin: 12px 0;\n    }\n    \n    p {\n      font-size: 14px;\n    }\n  }\n}\n</style> "],"names":["route","useRoute","useRouter","formRef","ref","submitting","successDialogVisible","submittedWriterId","formVisible","selectedSpecialized","applyDate","isPublicAccess","applicationForm","rules","educationOptions","experienceOptions","specializedOptions","toggleSpecialized","value","index","watch","val","formatDate","handleSubmit","ip","getClientIp","createWriter","ElMessage","error","handleClose","onMounted","currentDate"],"mappings":"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"}