import{d as J,r as u,m as W,n as X,b as d,I as Y,o as f,c as w,f as Z,e as a,w as o,M as ee,F as h,q as S,h as i,p as le,s as L,x as R,g as ae,E as b,A as te}from"./index-4kIbEQav.js";import{g as oe,d as se,u as ue,a as re,c as ne}from"./user-D0IfgbUA.js";import{g as de}from"./role-8XEJkv6K.js";import{f as ie}from"./format-DZvyx3OM.js";import{a as me}from"./date-CLpD1YEj.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ve={class:"app-container"},fe={class:"toolbar"},ce=J({__name:"index",setup(_e){const k=u(!1),T=u([]),V=u([]),c=u(!1),U=u(""),C=u(!1),_=u(),s=u({username:"",password:"",role_id:void 0,real_name:"",email:"",status:1}),r=u({page:1,pageSize:10,username:"",role_id:void 0,status:void 0}),F={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],role_id:[{required:!0,message:"请选择角色",trigger:"change"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]},M=[{label:"启用",value:1},{label:"禁用",value:0}];u(0),u({username:"",role_id:"",status:""});const $=u(),g=async()=>{try{k.value=!0;const t=await oe();t.data&&t.data.data&&(T.value=t.data.data)}catch(t){console.error("获取用户列表失败:",t),b.error("获取用户列表失败")}finally{k.value=!1}},I=async()=>{try{const t=await de();t.data&&t.data.data&&(V.value=t.data.data)}catch(t){console.error("获取角色列表失败:",t)}},q=()=>{console.log("点击搜索按钮，查询条件:",r.value),g()},N=()=>{r.value={page:1,pageSize:10,username:"",role_id:void 0,status:void 0},g()},z=()=>{U.value="新增用户",c.value=!0},A=t=>{U.value="编辑用户",s.value={...t,password:""},c.value=!0},K=async t=>{try{await te.confirm("确认删除该用户吗？","提示",{type:"warning"}),await se(t.id),b.success("删除成功"),g()}catch(l){console.error("Delete user error:",l)}},O=async t=>{try{await ue(t.id,{status:t.status}),b.success("状态更新成功")}catch(l){console.error("更新状态失败:",l),t.status=t.status===1?0:1}},P=async()=>{if(_.value){await _.value.validate();try{C.value=!0;const t={...s.value};t.password||delete t.password,s.value.id?(await re(s.value.id,t),b.success("更新成功")):(await ne(t),b.success("创建成功")),c.value=!1,g()}catch(t){console.error("Submit user error:",t)}finally{C.value=!1}}},Q=()=>{_.value&&_.value.resetFields(),s.value={username:"",password:"",role_id:void 0,real_name:"",email:"",status:1}};return W($,t=>{const{startTime:l,endTime:p}=me(t);r.value.startTime=l,r.value.endTime=p}),X(async()=>{await g(),await I(),console.log("roleList:",V.value)}),(t,l)=>{const p=d("el-input"),n=d("el-form-item"),x=d("el-option"),D=d("el-select"),v=d("el-button"),B=d("el-form"),m=d("el-table-column"),E=d("el-switch"),j=d("el-table"),G=d("el-dialog"),H=Y("loading");return f(),w("div",ve,[Z("div",fe,[a(B,{inline:!0,model:r.value,class:"search-form"},{default:o(()=>[a(n,null,{default:o(()=>[a(p,{modelValue:r.value.username,"onUpdate:modelValue":l[0]||(l[0]=e=>r.value.username=e),placeholder:"用户名",clearable:"",onKeyup:ee(q,["enter"])},null,8,["modelValue"])]),_:1}),a(n,null,{default:o(()=>[a(D,{modelValue:r.value.role_id,"onUpdate:modelValue":l[1]||(l[1]=e=>r.value.role_id=e),placeholder:"角色",clearable:"",filterable:""},{default:o(()=>[(f(!0),w(h,null,S(V.value,e=>(f(),L(x,{key:e.id,label:e.role_name,value:e.id},{default:o(()=>[i(R(e.role_name),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(n,null,{default:o(()=>[a(D,{modelValue:r.value.status,"onUpdate:modelValue":l[2]||(l[2]=e=>r.value.status=e),placeholder:"状态",clearable:"",filterable:""},{default:o(()=>[(f(),w(h,null,S(M,e=>a(x,{key:e.value,label:e.label,value:e.value},{default:o(()=>[i(R(e.label),1)]),_:2},1032,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(n,null,{default:o(()=>[a(v,{type:"primary",onClick:q},{default:o(()=>l[11]||(l[11]=[i("搜索")])),_:1}),a(v,{onClick:N},{default:o(()=>l[12]||(l[12]=[i("重置")])),_:1})]),_:1})]),_:1},8,["model"]),a(v,{type:"primary",onClick:z},{default:o(()=>l[13]||(l[13]=[i("新增用户")])),_:1})]),le((f(),L(j,{data:T.value,style:{width:"100%","margin-top":"20px"}},{default:o(()=>[a(m,{prop:"id",label:"ID",width:"80"}),a(m,{prop:"username",label:"用户名"}),a(m,{prop:"real_name",label:"姓名"}),a(m,{prop:"email",label:"邮箱"}),a(m,{prop:"role_name",label:"角色"}),a(m,{label:"状态",width:"100"},{default:o(({row:e})=>[a(E,{modelValue:e.status,"onUpdate:modelValue":y=>e.status=y,"active-value":1,"inactive-value":0,onChange:y=>O(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),a(m,{prop:"created_at",label:"创建时间",width:"180"},{default:o(({row:e})=>[i(R(ae(ie)(e.created_at)),1)]),_:1}),a(m,{label:"操作",width:"200",fixed:"right"},{default:o(({row:e})=>[a(v,{type:"primary",link:"",onClick:y=>A(e)},{default:o(()=>l[14]||(l[14]=[i("编辑")])),_:2},1032,["onClick"]),a(v,{type:"danger",link:"",onClick:y=>K(e)},{default:o(()=>l[15]||(l[15]=[i("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[H,k.value]]),a(G,{title:U.value,modelValue:c.value,"onUpdate:modelValue":l[10]||(l[10]=e=>c.value=e),width:"500px",onClose:Q},{footer:o(()=>[a(v,{onClick:l[9]||(l[9]=e=>c.value=!1)},{default:o(()=>l[16]||(l[16]=[i("取消")])),_:1}),a(v,{type:"primary",onClick:P,loading:C.value},{default:o(()=>l[17]||(l[17]=[i(" 确定 ")])),_:1},8,["loading"])]),default:o(()=>[a(B,{ref_key:"formRef",ref:_,model:s.value,rules:F,"label-width":"80px"},{default:o(()=>[a(n,{label:"用户名",prop:"username"},{default:o(()=>[a(p,{modelValue:s.value.username,"onUpdate:modelValue":l[3]||(l[3]=e=>s.value.username=e),placeholder:"请输入用户名",disabled:!!s.value.id},null,8,["modelValue","disabled"])]),_:1}),a(n,{label:"密码",prop:"password",rules:[{required:!s.value.id,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能小于6位",trigger:"blur"}]},{default:o(()=>[a(p,{modelValue:s.value.password,"onUpdate:modelValue":l[4]||(l[4]=e=>s.value.password=e),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1},8,["rules"]),a(n,{label:"姓名",prop:"real_name"},{default:o(()=>[a(p,{modelValue:s.value.real_name,"onUpdate:modelValue":l[5]||(l[5]=e=>s.value.real_name=e),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),a(n,{label:"邮箱",prop:"email"},{default:o(()=>[a(p,{modelValue:s.value.email,"onUpdate:modelValue":l[6]||(l[6]=e=>s.value.email=e),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),a(n,{label:"角色",prop:"role_id"},{default:o(()=>[a(D,{modelValue:s.value.role_id,"onUpdate:modelValue":l[7]||(l[7]=e=>s.value.role_id=e),placeholder:"请选择角色"},{default:o(()=>[(f(!0),w(h,null,S(V.value,e=>(f(),L(x,{key:e.id,label:e.role_name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(n,{label:"状态",prop:"status"},{default:o(()=>[a(E,{modelValue:s.value.status,"onUpdate:modelValue":l[8]||(l[8]=e=>s.value.status=e),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}}),Ue=pe(ce,[["__scopeId","data-v-3edc2436"]]);export{Ue as default};
//# sourceMappingURL=index-B4lddxkP.js.map
