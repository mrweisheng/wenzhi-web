import{D as Y,d as de,r as c,n as E,R as ie,m as pe,b as u,G as ce,o as b,c as V,f as s,e as a,w as t,p as me,x as R,K as O,F as L,q as B,i as r,t as m,g as K,O as _e,E as k,S as fe}from"./index-D2BneEQd.js";import{f as N}from"./format-DZvyx3OM.js";import{_ as ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";function ge(C){return Y({url:"/api/orders",method:"get",params:C})}function ye(C){return Y({url:"/api/orders/process",method:"post",headers:{"Content-Type":"multipart/form-data"},data:C})}const be={class:"app-container"},he={class:"toolbar"},Ce={class:"form-item-group"},we={class:"form-item-group"},Ve={class:"pagination-container"},ke={class:"update-dialog-content"},xe={class:"channel-select"},Se={class:"channel-buttons"},Fe=["onClick"],ze={class:"channel-icon"},Te={class:"channel-name"},De={class:"file-upload"},Me={key:1,class:"multi-upload"},Ue=de({__name:"index",setup(C){const x=c(!1),T=c([]),D=c(0),o=c({page:1,pageSize:10,order_id:"",payment_id:"",channel:"",startTime:"",endTime:""}),w=c(),y=async()=>{try{x.value=!0;const{data:n}=await ge(o.value),{list:e,total:d}=n.data;T.value=e,D.value=d}catch(n){console.error("获取订单列表失败:",n)}finally{x.value=!1}};E(w,n=>{n&&n[0]&&n[1]?(o.value.startTime=String(n[0]),o.value.endTime=String(n[1])):(o.value.startTime="",o.value.endTime="")});const q=[{value:"",label:"全部"},{value:"支付宝",label:"支付宝"},{value:"企业微信",label:"企业微信"},{value:"匠易艺",label:"匠易艺"},{value:"慧辞",label:"慧辞"}],P=n=>({paid:"success",pending:"warning",cancelled:"danger",refunded:"info",completed:"success"})[n]||"info",$=n=>({pending:"待支付",paid:"已支付",completed:"已完成",refunded:"已退款",cancelled:"已取消"})[n]||n,j=n=>({"":"全部",支付宝:"支付宝",企业微信:"企业微信",匠易艺:"匠易艺",慧辞:"慧辞"})[n]||n,S=()=>{o.value.page=1,y()},A=()=>{o.value={page:1,pageSize:10,order_id:"",payment_id:"",channel:"",startTime:"",endTime:""},w.value=void 0,y()},G=n=>{o.value.pageSize=n,y()},I=n=>{o.value.page=n,y()},h=c(!1),i=c(""),v=c(null),g=c(null),F=c(!1),Q=()=>{h.value=!0,i.value="",v.value=null,g.value=null},M=(n,e)=>{v.value=n.raw},H=(n,e)=>{g.value=n.raw},U=ie(()=>i.value?["支付宝","企业微信"].includes(i.value)?!!v.value:["慧辞","匠易艺"].includes(i.value)?!!v.value&&!!g.value:!1:!1);E(i,()=>{v.value=null,g.value=null,document.querySelectorAll(".el-upload__input").forEach(e=>{e.value=""})});const J=async()=>{var n,e;if(U.value)try{if(F.value=!0,!v.value){k.error("请选择订单文件");return}if(["慧辞","匠易艺"].includes(i.value)&&!g.value){k.error("请选择退款文件");return}const d=new FormData;d.append("channel",i.value),d.append("order_file",v.value),g.value&&d.append("refund_file",g.value);const{data:_}=await ye(d);k.success("处理成功"),h.value=!1,y()}catch(d){console.error("处理订单失败:",d);const _=((e=(n=d.response)==null?void 0:n.data)==null?void 0:e.message)||"处理失败，请稍后重试";k.error(_)}finally{F.value=!1}},W=["支付宝","企业微信","慧辞","匠易艺"];return pe(()=>{y()}),(n,e)=>{const d=u("el-input"),_=u("el-form-item"),X=u("el-option"),Z=u("el-select"),ee=u("el-date-picker"),f=u("el-button"),le=u("el-form"),p=u("el-table-column"),ae=u("el-tag"),te=u("el-table"),ne=u("el-pagination"),oe=u("Money"),se=u("el-icon"),z=u("el-upload"),re=u("el-dialog"),ue=ce("loading");return b(),V("div",be,[s("div",he,[a(le,{inline:!0,model:o.value,class:"search-form"},{default:t(()=>[s("div",Ce,[a(_,{label:"订单编号"},{default:t(()=>[a(d,{modelValue:o.value.order_id,"onUpdate:modelValue":e[0]||(e[0]=l=>o.value.order_id=l),placeholder:"请输入",clearable:"",onKeyup:O(S,["enter"])},null,8,["modelValue"])]),_:1}),a(_,{label:"支付单号"},{default:t(()=>[a(d,{modelValue:o.value.payment_id,"onUpdate:modelValue":e[1]||(e[1]=l=>o.value.payment_id=l),placeholder:"请输入",clearable:"",onKeyup:O(S,["enter"])},null,8,["modelValue"])]),_:1}),a(_,{label:"订单渠道"},{default:t(()=>[a(Z,{modelValue:o.value.channel,"onUpdate:modelValue":e[2]||(e[2]=l=>o.value.channel=l),placeholder:"请选择",clearable:"",filterable:""},{default:t(()=>[(b(),V(L,null,B(q,l=>a(X,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),s("div",we,[a(_,{label:"创建时间"},{default:t(()=>[a(ee,{modelValue:w.value,"onUpdate:modelValue":e[3]||(e[3]=l=>w.value=l),type:"daterange","value-format":"YYYY-MM-DD","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])]),_:1}),a(_,null,{default:t(()=>[a(f,{type:"primary",onClick:S},{default:t(()=>e[8]||(e[8]=[r("搜索")])),_:1}),a(f,{onClick:A},{default:t(()=>e[9]||(e[9]=[r("重置")])),_:1}),a(f,{type:"success",onClick:Q},{default:t(()=>e[10]||(e[10]=[r("更新订单")])),_:1})]),_:1})])]),_:1},8,["model"])]),me((b(),R(te,{data:T.value,style:{width:"100%","margin-top":"20px"}},{default:t(()=>[a(p,{prop:"order_id",label:"订单编号",width:"180"}),a(p,{prop:"payment_id",label:"支付单号",width:"180"}),a(p,{prop:"amount",label:"买家实付金额",width:"120"},{default:t(({row:l})=>[r(" ¥"+m(parseFloat(l.amount).toFixed(2)),1)]),_:1}),a(p,{prop:"status",label:"订单状态",width:"100"},{default:t(({row:l})=>[a(ae,{type:P(l.status)},{default:t(()=>[r(m($(l.status)),1)]),_:2},1032,["type"])]),_:1}),a(p,{prop:"channel",label:"订单渠道",width:"100"},{default:t(({row:l})=>[r(m(j(l.channel)),1)]),_:1}),a(p,{prop:"refund_amount",label:"退款金额",width:"120"},{default:t(({row:l})=>[r(" ¥"+m(parseFloat(l.refund_amount).toFixed(2)),1)]),_:1}),a(p,{prop:"fee",label:"手续费",width:"120"},{default:t(({row:l})=>[r(" ¥"+m(parseFloat(l.fee).toFixed(2)),1)]),_:1}),a(p,{prop:"merchant_payment",label:"打款商家金额",width:"120"},{default:t(({row:l})=>[r(" ¥"+m(parseFloat(l.merchant_payment).toFixed(2)),1)]),_:1}),a(p,{prop:"create_time",label:"创建时间",width:"180"},{default:t(({row:l})=>[r(m(K(N)(l.create_time)),1)]),_:1}),a(p,{prop:"confirm_time",label:"确认收货时间",width:"180"},{default:t(({row:l})=>[r(m(K(N)(l.confirm_time)),1)]),_:1}),a(p,{prop:"merchant_remark",label:"商家备注","min-width":"200"})]),_:1},8,["data"])),[[ue,x.value]]),s("div",Ve,[a(ne,{"current-page":o.value.page,"onUpdate:currentPage":e[4]||(e[4]=l=>o.value.page=l),"page-size":o.value.pageSize,"onUpdate:pageSize":e[5]||(e[5]=l=>o.value.pageSize=l),"page-sizes":[10,20,50,100],total:D.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:G,onCurrentChange:I},null,8,["current-page","page-size","total"])]),a(re,{title:"更新订单",modelValue:h.value,"onUpdate:modelValue":e[7]||(e[7]=l=>h.value=l),width:"800px","close-on-click-modal":!1,class:"update-dialog"},{footer:t(()=>[a(f,{onClick:e[6]||(e[6]=l=>h.value=!1)},{default:t(()=>e[19]||(e[19]=[r("取消")])),_:1}),a(f,{type:"primary",onClick:J,loading:F.value,disabled:!U.value},{default:t(()=>e[20]||(e[20]=[r(" 确定更新 ")])),_:1},8,["loading","disabled"])]),default:t(()=>[s("div",ke,[s("div",xe,[e[11]||(e[11]=s("h3",null,"选择渠道",-1)),s("div",Se,[(b(),V(L,null,B(W,l=>s("div",{key:l,class:fe(["channel-button",{active:i.value===l}]),onClick:Ee=>i.value=l},[s("span",ze,[a(se,null,{default:t(()=>[a(oe)]),_:1})]),s("span",Te,m(l),1)],10,Fe)),64))])]),s("div",De,[e[18]||(e[18]=s("h3",null,"上传文件",-1)),["支付宝","企业微信"].includes(i.value)?(b(),R(z,{key:0,ref:"uploadRef",class:"upload-area",action:"#","auto-upload":!1,limit:1,"on-change":M},{trigger:t(()=>[a(f,{type:"primary"},{default:t(()=>e[12]||(e[12]=[r("选择订单文件")])),_:1})]),tip:t(()=>e[13]||(e[13]=[s("div",{class:"el-upload__tip"}," 请选择 Excel 格式的订单文件 ",-1)])),_:1},512)):["慧辞","匠易艺"].includes(i.value)?(b(),V("div",Me,[a(z,{ref:"uploadRef",class:"upload-area",action:"#","auto-upload":!1,limit:1,"on-change":M},{trigger:t(()=>[a(f,{type:"primary"},{default:t(()=>e[14]||(e[14]=[r("选择订单文件")])),_:1})]),tip:t(()=>e[15]||(e[15]=[s("div",{class:"el-upload__tip"}," 请选择 Excel 格式的订单文件 ",-1)])),_:1},512),a(z,{class:"upload-area",action:"#","auto-upload":!1,limit:1,"on-change":H},{trigger:t(()=>[a(f,{type:"primary"},{default:t(()=>e[16]||(e[16]=[r("选择退款文件")])),_:1})]),tip:t(()=>e[17]||(e[17]=[s("div",{class:"el-upload__tip"}," 请选择 Excel 格式的退款文件 ",-1)])),_:1})])):_e("",!0)])])]),_:1},8,["modelValue"])])}}}),Be=ve(Ue,[["__scopeId","data-v-841002bd"]]);export{Be as default};
//# sourceMappingURL=index-D_UVDEf3.js.map
