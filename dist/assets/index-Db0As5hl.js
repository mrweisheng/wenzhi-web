import{x as e,r as a,X as l,f as t,k as d,ag as o,aq as u,y as r,z as i,A as n,P as s,H as p,a5 as c,L as _,u as m,I as f,G as v,M as g,O as h,a4 as w,K as V}from"./vendor-BVd4RN3d.js";import{s as b,u as y}from"./index-CFSbY6bd.js";import{h as x}from"./writer-BxWoWcMI.js";import{E as U,F as Y,G as k,H as C,J as D,K as M,L as z,u as S,r as j,M as H,y as I,N}from"./element-plus-CCDyQ1z5.js";import{_ as q}from"./_plugin-vue_export-helper-BCo6x5W8.js";function K(){return b({url:"/api/customer-orders/merge",method:"post"})}const L={class:"app-container"},O={class:"toolbar"},T={class:"action-buttons"},A={class:"pagination-container"},F={class:"form-section"},G={class:"section-header"},P={class:"option-with-icon"},E={class:"option-with-icon"},J={class:"writer-option"},R={key:0,class:"writer-id"},W={class:"option-with-icon"},X={class:"option-with-icon"},$={class:"form-section"},B={class:"section-header"},Q={class:"form-section"},Z={class:"section-header"},ee={class:"dialog-footer"},ae=q(e({__name:"index",setup(e){var q;const ae=y(),le=a(),te=a(!1),de=a(!1),oe=a(!1),ue=a(!1),re=a(!1),ie=a("新增订单"),ne=a(null),se=l({page:1,pageSize:10}),pe=a([]),ce=a(0),_e=a([]),me=a({order_id:"",date:(new Date).toISOString().split("T")[0],is_fixed:0,new_customer:0,customer_id:null==(q=ae.userInfo)?void 0:q.id}),fe=l({order_id:[{required:!0,message:"请输入订单编号",trigger:"blur"}],date:[{required:!0,message:"请选择日期",trigger:"change"}],is_fixed:[{required:!0,message:"请选择是否定稿",trigger:"change"}],writer_id:[{required:!0,message:"请选择写手",trigger:"change"}]});t(ne,(e=>{e?(se.date_start=e[0],se.date_end=e[1]):(se.date_start=void 0,se.date_end=void 0)}));const ve=e=>{if(!e)return"-";return new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})},ge=async()=>{try{te.value=!0;const{data:a}=await(e=se,b({url:"/api/customer-orders",method:"get",params:e}));a.data&&(pe.value=a.data.list||[],ce.value=a.data.total||0)}catch(a){U.error("获取订单列表失败")}finally{te.value=!1}var e},he=()=>{se.page=1,ge()},we=()=>{se.order_id=void 0,se.is_fixed=void 0,ne.value=null,se.date_start=void 0,se.date_end=void 0,se.page=1,ge()},Ve=e=>{se.page=e,ge()},be=e=>{se.pageSize=e,se.page=1,ge()},ye=()=>{ie.value="新增订单",Ye(),re.value=!0},xe=async()=>{var e,a,l;if(le.value)try{await le.value.validate(),de.value=!0,await(l=me.value,b({url:"/api/customer-orders",method:"post",data:l})),U.success("订单提交成功"),re.value=!1,ge();try{0===(await K()).data.code&&U.success("订单已同步到总表")}catch(t){U.warning("订单已创建，但同步到总表失败，请稍后手动同步")}}catch(d){U.error((null==(a=null==(e=d.response)?void 0:e.data)?void 0:a.message)||"提交订单失败")}finally{de.value=!1}},Ue=async()=>{var e,a;try{oe.value=!0;const e=await K();0===e.data.code?(U.success(`同步成功，共处理 ${e.data.data.total} 条订单`),ge()):U.info(e.data.message||"没有需要同步的订单")}catch(l){U.error((null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.message)||"同步订单失败")}finally{oe.value=!1}},Ye=()=>{var e;le.value&&le.value.resetFields(),me.value={order_id:"",date:(new Date).toISOString().split("T")[0],is_fixed:0,new_customer:0,customer_id:null==(e=ae.userInfo)?void 0:e.id,writer_id:void 0}};return d((()=>{ge(),(async()=>{try{ue.value=!0;const{data:e}=await x();_e.value=e.data||[]}catch(e){U.error("获取写手列表失败")}finally{ue.value=!1}})()})),(e,a)=>{const l=o("el-input"),t=o("el-form-item"),d=o("el-date-picker"),b=o("el-option"),y=o("el-select"),x=o("el-button"),U=o("el-form"),q=o("el-icon"),K=o("el-table-column"),ae=o("el-tag"),ge=o("el-table"),Ye=o("el-pagination"),ke=o("el-col"),Ce=o("el-row"),De=o("el-input-number"),Me=o("el-dialog"),ze=u("loading");return r(),i("div",L,[n("div",O,[s(U,{inline:!0,model:se,class:"search-form"},{default:p((()=>[s(t,{label:"订单编号"},{default:p((()=>[s(l,{modelValue:se.order_id,"onUpdate:modelValue":a[0]||(a[0]=e=>se.order_id=e),placeholder:"请输入订单编号",clearable:"",onKeyup:c(he,["enter"])},null,8,["modelValue"])])),_:1}),s(t,{label:"日期范围"},{default:p((()=>[s(d,{modelValue:ne.value,"onUpdate:modelValue":a[1]||(a[1]=e=>ne.value=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])])),_:1}),s(t,{label:"是否定稿"},{default:p((()=>[s(y,{modelValue:se.is_fixed,"onUpdate:modelValue":a[2]||(a[2]=e=>se.is_fixed=e),placeholder:"请选择",clearable:""},{default:p((()=>[s(b,{value:0,label:"未定稿"}),s(b,{value:1,label:"已定稿"})])),_:1},8,["modelValue"])])),_:1}),s(t,null,{default:p((()=>[s(x,{type:"primary",onClick:he},{default:p((()=>a[22]||(a[22]=[_("搜索")]))),_:1}),s(x,{onClick:we},{default:p((()=>a[23]||(a[23]=[_("重置")]))),_:1})])),_:1})])),_:1},8,["model"]),n("div",T,[s(x,{type:"primary",onClick:ye},{default:p((()=>a[24]||(a[24]=[_("新增订单")]))),_:1}),s(x,{type:"success",onClick:Ue,loading:oe.value},{default:p((()=>[s(q,{class:"mr-1"},{default:p((()=>[s(m(Y))])),_:1}),a[25]||(a[25]=_("同步订单 "))])),_:1},8,["loading"])])]),f((r(),v(ge,{data:pe.value,style:{width:"100%","margin-top":"20px"}},{default:p((()=>[s(K,{prop:"order_id",label:"订单编号",width:"150"}),s(K,{prop:"date",label:"日期",width:"120"}),s(K,{label:"是否定稿",width:"100"},{default:p((({row:e})=>[s(ae,{type:1===e.is_fixed?"success":"warning"},{default:p((()=>[_(g(1===e.is_fixed?"已定稿":"未定稿"),1)])),_:2},1032,["type"])])),_:1}),s(K,{prop:"customer_service_name",label:"客服",width:"120"}),s(K,{prop:"writer_name",label:"写手",width:"120"}),s(K,{prop:"word_count",label:"字数",width:"100"}),s(K,{label:"稿费",width:"100"},{default:p((({row:e})=>[_(" ¥"+g(e.fee),1)])),_:1}),s(K,{label:"订单金额",width:"120"},{default:p((({row:e})=>[_(" ¥"+g(e.order_amount),1)])),_:1}),s(K,{prop:"payment_channel",label:"付款渠道",width:"120"}),s(K,{prop:"store_name",label:"店铺/客户",width:"150"}),s(K,{prop:"customer_name",label:"客户名称",width:"150"}),s(K,{label:"创建时间",width:"180"},{default:p((({row:e})=>[_(g(ve(e.created_at)),1)])),_:1}),s(K,{label:"操作",width:"150",fixed:"right"},{default:p((({row:e})=>[s(x,{type:"primary",link:"",onClick:a=>(e=>{ie.value="编辑订单",me.value={...e,is_fixed:Number(e.is_fixed),new_customer:Number(e.new_customer||0),writer_id:e.writer_id||void 0},re.value=!0})(e)},{default:p((()=>a[26]||(a[26]=[_("编辑")]))),_:2},1032,["onClick"]),s(x,{type:"primary",link:"",onClick:a=>(e=>{ie.value="查看订单",me.value={...e,is_fixed:Number(e.is_fixed),new_customer:Number(e.new_customer||0),writer_id:e.writer_id||void 0},re.value=!0})(e)},{default:p((()=>a[27]||(a[27]=[_("查看")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[ze,te.value]]),n("div",A,[s(Ye,{"current-page":se.page,"onUpdate:currentPage":a[3]||(a[3]=e=>se.page=e),"page-size":se.pageSize,"onUpdate:pageSize":a[4]||(a[4]=e=>se.pageSize=e),"page-sizes":[10,20,50,100],total:ce.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:be,onCurrentChange:Ve},null,8,["current-page","page-size","total"])]),s(Me,{title:ie.value,modelValue:re.value,"onUpdate:modelValue":a[21]||(a[21]=e=>re.value=e),width:"80%","close-on-click-modal":!1,"destroy-on-close":!0,class:"order-dialog"},{footer:p((()=>[n("div",ee,[s(x,{onClick:a[20]||(a[20]=e=>re.value=!1)},{default:p((()=>[s(q,null,{default:p((()=>[s(m(k))])),_:1}),a[35]||(a[35]=n("span",null,"取消",-1))])),_:1}),s(x,{type:"primary",onClick:xe,loading:de.value},{default:p((()=>[s(q,null,{default:p((()=>[s(m(C))])),_:1}),a[36]||(a[36]=n("span",null,"确认",-1))])),_:1},8,["loading"])])])),default:p((()=>[s(U,{ref_key:"formRef",ref:le,model:me.value,rules:fe,"label-width":"120px",class:"order-form"},{default:p((()=>[n("div",F,[n("div",G,[s(q,{class:"section-icon"},{default:p((()=>[s(m(D))])),_:1}),a[28]||(a[28]=n("div",{class:"section-title"},"基本信息",-1))]),s(Ce,{gutter:24},{default:p((()=>[s(ke,{span:8},{default:p((()=>[s(t,{label:"订单编号",prop:"order_id"},{default:p((()=>[s(l,{modelValue:me.value.order_id,"onUpdate:modelValue":a[5]||(a[5]=e=>me.value.order_id=e),placeholder:"请输入订单编号","prefix-icon":"Ticket"},null,8,["modelValue"])])),_:1})])),_:1}),s(ke,{span:8},{default:p((()=>[s(t,{label:"日期",prop:"date"},{default:p((()=>[s(d,{modelValue:me.value.date,"onUpdate:modelValue":a[6]||(a[6]=e=>me.value.date=e),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1}),s(ke,{span:8},{default:p((()=>[s(t,{label:"是否定稿",prop:"is_fixed"},{default:p((()=>[s(y,{modelValue:me.value.is_fixed,"onUpdate:modelValue":a[7]||(a[7]=e=>me.value.is_fixed=e),placeholder:"请选择",style:{width:"100%"}},{default:p((()=>[s(b,{value:0,label:"未定稿"},{default:p((()=>[n("div",P,[s(q,null,{default:p((()=>[s(m(M))])),_:1}),a[29]||(a[29]=n("span",null,"未定稿",-1))])])),_:1}),s(b,{value:1,label:"已定稿"},{default:p((()=>[n("div",E,[s(q,null,{default:p((()=>[s(m(z))])),_:1}),a[30]||(a[30]=n("span",null,"已定稿",-1))])])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}),s(Ce,{gutter:24},{default:p((()=>[s(ke,{span:8},{default:p((()=>[s(t,{label:"写手",prop:"writer_id"},{default:p((()=>[s(y,{modelValue:me.value.writer_id,"onUpdate:modelValue":a[8]||(a[8]=e=>me.value.writer_id=e),placeholder:"请选择写手",filterable:"",clearable:"",style:{width:"100%"},loading:ue.value},{prefix:p((()=>[s(q,null,{default:p((()=>[s(m(S))])),_:1})])),default:p((()=>[(r(!0),i(h,null,w(_e.value,(e=>(r(),v(b,{key:e.id,label:e.name,value:e.id},{default:p((()=>[n("div",J,[n("span",null,g(e.name),1),e.writer_id?(r(),i("span",R,"("+g(e.writer_id)+")",1)):V("",!0)])])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue","loading"])])),_:1})])),_:1}),s(ke,{span:8},{default:p((()=>[s(t,{label:"交稿时间",prop:"exchange_time"},{default:p((()=>[s(d,{modelValue:me.value.exchange_time,"onUpdate:modelValue":a[9]||(a[9]=e=>me.value.exchange_time=e),type:"datetime",placeholder:"选择交稿时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1}),s(ke,{span:8},{default:p((()=>[s(t,{label:"是否新客户",prop:"new_customer"},{default:p((()=>[s(y,{modelValue:me.value.new_customer,"onUpdate:modelValue":a[10]||(a[10]=e=>me.value.new_customer=e),placeholder:"请选择",style:{width:"100%"}},{default:p((()=>[s(b,{value:0,label:"否"},{default:p((()=>[n("div",W,[s(q,null,{default:p((()=>[s(m(k))])),_:1}),a[31]||(a[31]=n("span",null,"否",-1))])])),_:1}),s(b,{value:1,label:"是"},{default:p((()=>[n("div",X,[s(q,null,{default:p((()=>[s(m(C))])),_:1}),a[32]||(a[32]=n("span",null,"是",-1))])])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}),s(Ce,{gutter:24},{default:p((()=>[s(ke,{span:8},{default:p((()=>[s(t,{label:"付款渠道",prop:"payment_channel"},{default:p((()=>[s(l,{modelValue:me.value.payment_channel,"onUpdate:modelValue":a[11]||(a[11]=e=>me.value.payment_channel=e),placeholder:"请输入付款渠道","prefix-icon":"Money"},null,8,["modelValue"])])),_:1})])),_:1}),s(ke,{span:8},{default:p((()=>[s(t,{label:"店铺/客户",prop:"store_name"},{default:p((()=>[s(l,{modelValue:me.value.store_name,"onUpdate:modelValue":a[12]||(a[12]=e=>me.value.store_name=e),placeholder:"请输入店铺名或客户线下","prefix-icon":"Shop"},null,8,["modelValue"])])),_:1})])),_:1}),s(ke,{span:8},{default:p((()=>[s(t,{label:"客户名称",prop:"customer_name"},{default:p((()=>[s(l,{modelValue:me.value.customer_name,"onUpdate:modelValue":a[13]||(a[13]=e=>me.value.customer_name=e),placeholder:"请输入客户名称","prefix-icon":"Avatar"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})]),n("div",$,[n("div",B,[s(q,{class:"section-icon"},{default:p((()=>[s(m(D))])),_:1}),a[33]||(a[33]=n("div",{class:"section-title"},"稿件信息",-1))]),s(Ce,{gutter:24},{default:p((()=>[s(ke,{span:8},{default:p((()=>[s(t,{label:"稿件字数",prop:"word_count"},{default:p((()=>[s(De,{modelValue:me.value.word_count,"onUpdate:modelValue":a[14]||(a[14]=e=>me.value.word_count=e),min:0,"controls-position":"right",style:{width:"100%"},placeholder:"请输入稿件字数"},{prefix:p((()=>[s(q,null,{default:p((()=>[s(m(j))])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1}),s(ke,{span:8},{default:p((()=>[s(t,{label:"稿费",prop:"fee"},{default:p((()=>[s(De,{modelValue:me.value.fee,"onUpdate:modelValue":a[15]||(a[15]=e=>me.value.fee=e),min:0,precision:2,step:.01,"controls-position":"right",style:{width:"100%"},placeholder:"请输入稿费"},{prefix:p((()=>[s(q,null,{default:p((()=>[s(m(H))])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1}),s(ke,{span:8},{default:p((()=>[s(t,{label:"稿件内容",prop:"order_content"},{default:p((()=>[s(l,{modelValue:me.value.order_content,"onUpdate:modelValue":a[16]||(a[16]=e=>me.value.order_content=e),type:"textarea",rows:2,placeholder:"请输入稿件内容信息"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})]),n("div",Q,[n("div",Z,[s(q,{class:"section-icon"},{default:p((()=>[s(m(I))])),_:1}),a[34]||(a[34]=n("div",{class:"section-title"},"支付信息",-1))]),s(Ce,{gutter:24},{default:p((()=>[s(ke,{span:8},{default:p((()=>[s(t,{label:"订单金额",prop:"order_amount"},{default:p((()=>[s(De,{modelValue:me.value.order_amount,"onUpdate:modelValue":a[17]||(a[17]=e=>me.value.order_amount=e),min:0,precision:2,step:.01,"controls-position":"right",style:{width:"100%"},placeholder:"请输入订单金额"},{prefix:p((()=>[s(q,null,{default:p((()=>[s(m(H))])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1}),s(ke,{span:8},{default:p((()=>[s(t,{label:"退款金额",prop:"refund_amount"},{default:p((()=>[s(De,{modelValue:me.value.refund_amount,"onUpdate:modelValue":a[18]||(a[18]=e=>me.value.refund_amount=e),min:0,precision:2,step:.01,"controls-position":"right",style:{width:"100%"},placeholder:"请输入退款金额"},{prefix:p((()=>[s(q,null,{default:p((()=>[s(m(N))])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1}),s(ke,{span:8},{default:p((()=>[s(t,{label:"特殊情况",prop:"special_situation"},{default:p((()=>[s(l,{modelValue:me.value.special_situation,"onUpdate:modelValue":a[19]||(a[19]=e=>me.value.special_situation=e),placeholder:"请输入特殊情况(不结算)","prefix-icon":"Warning"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])])),_:1},8,["model","rules"])])),_:1},8,["title","modelValue"])])}}}),[["__scopeId","data-v-0c3bf169"]]);export{ae as default};
