import{g as e,d as a,u as l,c as t,a as i}from"./role-DY0C-Yg7.js";import{f as o}from"./format-B5gz6Uyj.js";import{g as r}from"./menu-CzKWJdH9.js";import{a as s}from"./date-BKFy7LxP.js";import{_ as u}from"./_plugin-vue_export-helper-BCo6x5W8.js";import{a as d,E as n}from"./element-plus-CCDyQ1z5.js";import{r as c,f as m,k as v,z as p,P as f,K as y,A as _,H as g,I as k,G as h,ag as w,aq as b,y as x,L as C,M as V,u as j}from"./vendor-BVd4RN3d.js";import"./index-CFSbY6bd.js";const T={class:"app-container"},A={key:0,class:"fullscreen-loading"},I={class:"toolbar"},U={class:"permission-content"},q={class:"permission-header"},z={class:"dialog-footer"},K=u({__name:"index",setup(u){const K=c(!1),P=c([]),R=c(!1),D=c(""),E=c(!1),F=c(!1),G=c(),H=c({role_name:"",description:"",menu_ids:[]}),L={role_name:[{required:!0,message:"请输入角色名称",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}]},M=c({page:1,pageSize:10,role_name:"",startTime:"",endTime:""}),S=async()=>{try{K.value=!0;const a=await e();P.value=Array.isArray(a.data.data)?a.data.data:[]}catch(a){P.value=[]}finally{K.value=!1}},B=()=>{D.value="新增角色",R.value=!0},J=async()=>{if(G.value){await G.value.validate();try{F.value=!0,H.value.id?(await l(H.value.id,H.value),n.success("更新成功")):(await t(H.value),n.success("创建成功")),R.value=!1,S()}catch(e){}finally{F.value=!1}}},N=()=>{G.value&&G.value.resetFields(),H.value={role_name:"",description:"",menu_ids:[]}},O=c(),Q=c([]),W=c([]),X=c(),Y=c(""),Z=c(!1),$=c(!1),ee=async()=>{if(X.value&&O.value)try{F.value=!0;const e=O.value.getCheckedKeys();await l(X.value,{menu_ids:e}),n.success("权限设置成功"),E.value=!1}catch(e){}finally{F.value=!1}},ae=c();return m(ae,(e=>{const{startTime:a,endTime:l}=s(e);M.value.startTime=a,M.value.endTime=l})),v((()=>{S()})),(e,l)=>{const t=w("el-loading"),s=w("el-button"),u=w("el-table-column"),c=w("el-table"),m=w("el-input"),v=w("el-form-item"),M=w("el-form"),ae=w("el-dialog"),le=w("el-tree"),te=b("loading");return x(),p("div",T,[$.value?(x(),p("div",A,[f(t,{visible:!0,fullscreen:"",text:"正在加载权限数据...",background:"rgba(0, 0, 0, 0.7)"})])):y("",!0),_("div",I,[f(s,{type:"primary",onClick:B},{default:g((()=>l[5]||(l[5]=[C("新增角色")]))),_:1})]),k((x(),h(c,{data:P.value,style:{width:"100%","margin-top":"20px"},"row-key":e=>e.id,"tree-props":{children:"children"}},{default:g((()=>[f(u,{prop:"id",label:"ID",width:"80"}),f(u,{prop:"role_name",label:"角色名称"}),f(u,{prop:"description",label:"描述"}),f(u,{prop:"created_at",label:"创建时间",width:"180"},{default:g((({row:e})=>[C(V(j(o)(e.created_at)),1)])),_:1}),f(u,{label:"操作",width:"250",fixed:"right"},{default:g((({row:e})=>[f(s,{type:"primary",link:"",onClick:a=>(e=>{D.value="编辑角色",H.value={...e},R.value=!0})(e)},{default:g((()=>l[6]||(l[6]=[C("编辑")]))),_:2},1032,["onClick"]),f(s,{type:"primary",link:"",onClick:a=>(async e=>{try{$.value=!0,X.value=e.id,Y.value=e.role_name;const[a,l]=await Promise.all([r(),i(e.id)]);Array.isArray(a.data.data)?Q.value=a.data.data:Q.value=[],W.value=l.data.data.map((e=>e.id)),E.value=!0}catch(a){n.error("获取权限数据失败")}finally{$.value=!1}})(e),loading:Z.value&&X.value===e.id},{default:g((()=>l[7]||(l[7]=[C(" 权限设置 ")]))),_:2},1032,["onClick","loading"]),f(s,{type:"danger",link:"",onClick:l=>(async e=>{try{await d.confirm("确认删除该角色吗？","提示",{type:"warning"}),await a(e.id),n.success("删除成功"),S()}catch(l){}})(e)},{default:g((()=>l[8]||(l[8]=[C("删除")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","row-key"])),[[te,K.value]]),f(ae,{title:D.value,modelValue:R.value,"onUpdate:modelValue":l[2]||(l[2]=e=>R.value=e),width:"500px",onClose:N},{footer:g((()=>[f(s,{onClick:l[1]||(l[1]=e=>R.value=!1)},{default:g((()=>l[9]||(l[9]=[C("取消")]))),_:1}),f(s,{type:"primary",onClick:J,loading:F.value},{default:g((()=>l[10]||(l[10]=[C(" 确定 ")]))),_:1},8,["loading"])])),default:g((()=>[f(M,{ref_key:"formRef",ref:G,model:H.value,rules:L,"label-width":"80px"},{default:g((()=>[f(v,{label:"角色名称",prop:"role_name"},{default:g((()=>[f(m,{modelValue:H.value.role_name,"onUpdate:modelValue":l[0]||(l[0]=e=>H.value.role_name=e),placeholder:"请输入角色名称"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["title","modelValue"]),f(ae,{title:"权限设置",modelValue:E.value,"onUpdate:modelValue":l[4]||(l[4]=e=>E.value=e),width:"500px","close-on-click-modal":!1,"destroy-on-close":!0,class:"permission-dialog"},{footer:g((()=>[_("div",z,[f(s,{onClick:l[3]||(l[3]=e=>E.value=!1)},{default:g((()=>l[12]||(l[12]=[C("取消")]))),_:1}),f(s,{type:"primary",onClick:ee,loading:F.value},{default:g((()=>l[13]||(l[13]=[C(" 保存权限设置 ")]))),_:1},8,["loading"])])])),default:g((()=>[k((x(),p("div",U,[_("div",q,[_("h3",null,'为角色 "'+V(Y.value)+'" 分配权限',1),l[11]||(l[11]=_("p",{class:"permission-tip"},"请选择该角色可访问的菜单和功能",-1))]),f(le,{ref_key:"treeRef",ref:O,data:Q.value,"show-checkbox":"","node-key":"id",props:{label:"name"},"default-checked-keys":W.value,class:"permission-tree",style:{"max-height":"400px","overflow-y":"auto"}},null,8,["data","default-checked-keys"])])),[[te,Z.value]])])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-34ef454e"]]);export{K as default};
