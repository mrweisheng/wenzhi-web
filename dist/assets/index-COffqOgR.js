import{d as oe,a as le,r as f,af as A,n as ie,b as u,o as x,c as P,f as s,e as t,x as r,P as ne,w as a,g as l,h as _,F as de,q as re,E as g,j as L,ag as F,J as ue,i as ce,a3 as _e,ah as fe,aa as me,a9 as ve,ai as pe,aj as we,ak as B,al as R,am as ge,an as he,ao as ye,ap as be,U as N}from"./index-4kIbEQav.js";import{f as D}from"./format-DZvyx3OM.js";import{g as xe}from"./issues-CK2GnHxB.js";import{b as Pe,e as ke}from"./user-D0IfgbUA.js";import{_ as Ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ce={class:"app-container"},Ue={class:"profile-container"},qe={class:"user-summary"},Ie={class:"user-info-section"},Me={class:"user-meta"},Fe={class:"user-name"},Re={class:"user-role"},De={class:"user-status"},Ee={class:"user-actions"},$e={class:"main-content"},Se={class:"info-sidebar"},ze={class:"info-card"},Ae={class:"info-group"},Le={class:"info-item"},Be={class:"info-icon"},Ne={class:"info-content"},Te={class:"info-value"},je={class:"info-item"},Qe={class:"info-icon"},Je={class:"info-content"},Ke={class:"info-value"},Ge={class:"info-item"},He={class:"info-icon"},Oe={class:"info-content"},We={class:"info-value"},Xe={class:"info-item"},Ye={class:"info-icon"},Ze={class:"info-content"},es={class:"info-value"},ss={class:"decoration-icons"},ts={class:"icon-wrapper"},as={class:"icon-item primary"},os={class:"icon-item success"},ls={class:"icon-item warning"},is={class:"icon-item danger"},ns={class:"content-main"},ds={class:"content-card recent-issues-card"},rs={class:"card-header"},us={class:"card-actions"},cs={key:0,class:"empty-issues"},_s={class:"empty-icon-wrapper"},fs={key:1,class:"issues-list"},ms=["onClick"],vs={class:"issue-content"},ps={class:"issue-header"},ws={class:"issue-id"},gs={class:"issue-title"},hs={class:"issue-meta"},ys={class:"issue-time"},bs={class:"issue-action"},xs={class:"content-card quote-card"},Ps={class:"card-header"},ks={class:"card-actions"},Vs={class:"quote-content"},Cs={class:"quote-icon"},Us={class:"quote-text"},qs={class:"quote-author"},Is={class:"dialog-header-icon"},Ms={class:"icon-wrapper"},Fs={class:"password-tips"},Rs={class:"dialog-footer"},Ds={class:"dialog-header-icon"},Es={class:"icon-wrapper email-icon"},$s={class:"dialog-description"},Ss={class:"email-tips"},zs={class:"dialog-footer"},As=oe({__name:"index",setup(Ls){const k=le(),V=f([]),p=[{text:"勿忘初心，方得始终。",author:"《华严经》"},{text:"千里之行，始于足下。",author:"老子"},{text:"工欲善其事，必先利其器。",author:"孔子"},{text:"知之为知之，不知为不知，是知也。",author:"孔子"},{text:"学而不思则罔，思而不学则殆。",author:"孔子"},{text:"不积跬步，无以至千里；不积小流，无以成江海。",author:"荀子"},{text:"纸上得来终觉浅，绝知此事要躬行。",author:"陆游"},{text:"路漫漫其修远兮，吾将上下而求索。",author:"屈原"},{text:"业精于勤，荒于嬉；行成于思，毁于随。",author:"韩愈"},{text:"天行健，君子以自强不息。",author:"《周易》"}],C=f(p[Math.floor(Math.random()*p.length)]),T=()=>{let n;do n=Math.floor(Math.random()*p.length);while(p[n].text===C.value.text&&p.length>1);C.value=p[n]},h=f(!1),I=f(),c=f({oldPassword:"",newPassword:"",confirmPassword:""}),j={oldPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:(n,e,m)=>{e!==c.value.newPassword?m(new Error("两次输入的密码不一致")):m()},trigger:"blur"}]},y=f(!1),M=f(),b=f({email:""}),Q={email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}]},w=f(!1),d=A(()=>k.userInfo||{id:0,username:"",role_id:0,status:0,created_at:"",updated_at:"",role:{id:0,role_name:""},email:""}),J=A(()=>{const n=d.value.username||"default";return`https://api.dicebear.com/7.x/avataaars/svg?seed=${encodeURIComponent(n)}`}),K=async()=>{var n;if(d.value.id)try{const e=await xe({pageSize:5,page:1});(n=e.data)!=null&&n.data&&(e.data.data.items?V.value=e.data.data.items.filter(m=>{var o;return((o=m.assignee)==null?void 0:o.id)===d.value.id}).slice(0,3):Array.isArray(e.data.data)&&(V.value=e.data.data.filter(m=>{var o;return((o=m.assignee)==null?void 0:o.id)===d.value.id}).slice(0,3)))}catch(e){console.error("获取最近问题失败:",e)}},G=n=>({pending:"info",processing:"warning",completed:"success"})[n]||"info",H=n=>({pending:"待处理",processing:"处理中",completed:"已完成"})[n]||n,O=n=>{R.push(`/issues?view=${n}`)},W=()=>{c.value={oldPassword:"",newPassword:"",confirmPassword:""},h.value=!0},X=()=>{b.value={email:d.value.email||""},y.value=!0},Y=async()=>{I.value&&await I.value.validate(async n=>{if(n){w.value=!0;try{await Pe({oldPassword:c.value.oldPassword,newPassword:c.value.newPassword}),g.success("密码修改成功"),h.value=!1}catch(e){console.error("修改密码失败:",e),e.response&&e.response.data?g.error(e.response.data.message||"修改密码失败，请重试"):g.error("修改密码失败，请重试")}finally{w.value=!1}}})},Z=async()=>{M.value&&await M.value.validate(async n=>{if(n){w.value=!0;try{await ke(b.value.email),g.success("邮箱更新成功"),y.value=!1,await k.getUserInfoAction()}catch(e){console.error("更新邮箱失败:",e),e.response&&e.response.data?g.error(e.response.data.message||"更新邮箱失败，请重试"):g.error("更新邮箱失败，请重试")}finally{w.value=!1}}})};return ie(()=>{k.userInfo||k.getUserInfoAction(),K()}),(n,e)=>{var z;const m=u("el-avatar"),o=u("el-icon"),v=u("el-button"),E=u("el-dropdown-item"),ee=u("el-dropdown-menu"),se=u("el-dropdown"),te=u("el-empty"),ae=u("el-tag"),U=u("el-input"),q=u("el-form-item"),$=u("el-form"),S=u("el-dialog");return x(),P("div",Ce,[s("div",Ue,[s("div",qe,[s("div",Ie,[t(m,{size:86,src:J.value,class:"user-avatar"},null,8,["src"]),s("div",Me,[s("h2",Fe,r(d.value.username),1),s("div",Re,r(((z=d.value.role)==null?void 0:z.role_name)||"暂无角色"),1),s("div",De,[s("div",{class:ne(["status-indicator",d.value.status===1?"active":"inactive"])},null,2),s("span",null,r(d.value.status===1?"在线":"离线"),1)])])]),s("div",Ee,[t(se,{trigger:"click"},{dropdown:a(()=>[t(ee,null,{default:a(()=>[t(E,{onClick:W},{default:a(()=>[t(o,{class:"action-icon"},{default:a(()=>[t(l(L))]),_:1}),e[11]||(e[11]=_(" 修改密码 "))]),_:1}),t(E,{onClick:X},{default:a(()=>[t(o,{class:"action-icon"},{default:a(()=>[t(l(F))]),_:1}),_(" "+r(d.value.email?"修改邮箱":"绑定邮箱"),1)]),_:1})]),_:1})]),default:a(()=>[t(v,{type:"primary",class:"action-button"},{icon:a(()=>[t(o,null,{default:a(()=>[t(l(ue))]),_:1})]),default:a(()=>[e[10]||(e[10]=_(" 编辑资料 "))]),_:1})]),_:1})])]),s("div",$e,[s("div",Se,[s("div",ze,[e[16]||(e[16]=s("h3",{class:"card-title"},"基本信息",-1)),s("div",Ae,[s("div",Le,[s("div",Be,[t(o,null,{default:a(()=>[t(l(ce))]),_:1})]),s("div",Ne,[e[12]||(e[12]=s("div",{class:"info-label"},"账号",-1)),s("div",Te,r(d.value.username),1)])]),s("div",je,[s("div",Qe,[t(o,null,{default:a(()=>[t(l(F))]),_:1})]),s("div",Je,[e[13]||(e[13]=s("div",{class:"info-label"},"邮箱",-1)),s("div",Ke,r(d.value.email||"暂无邮箱"),1)])]),s("div",Ge,[s("div",He,[t(o,null,{default:a(()=>[t(l(_e))]),_:1})]),s("div",Oe,[e[14]||(e[14]=s("div",{class:"info-label"},"创建时间",-1)),s("div",We,r(l(D)(d.value.created_at)),1)])]),s("div",Xe,[s("div",Ye,[t(o,null,{default:a(()=>[t(l(fe))]),_:1})]),s("div",Ze,[e[15]||(e[15]=s("div",{class:"info-label"},"最后更新",-1)),s("div",es,r(l(D)(d.value.updated_at)),1)])])]),s("div",ss,[s("div",ts,[s("div",as,[t(o,null,{default:a(()=>[t(l(me))]),_:1})]),s("div",os,[t(o,null,{default:a(()=>[t(l(ve))]),_:1})]),s("div",ls,[t(o,null,{default:a(()=>[t(l(pe))]),_:1})]),s("div",is,[t(o,null,{default:a(()=>[t(l(we))]),_:1})])])])])]),s("div",ns,[s("div",ds,[s("div",rs,[e[18]||(e[18]=s("h3",{class:"card-title"},"最近负责的问题",-1)),s("div",us,[t(v,{type:"primary",text:"",class:"view-all-button",onClick:e[0]||(e[0]=i=>l(R).push("/issues"))},{default:a(()=>[e[17]||(e[17]=_(" 查看全部 ")),t(o,{class:"ml-1"},{default:a(()=>[t(l(B))]),_:1})]),_:1})])]),V.value.length?(x(),P("div",fs,[(x(!0),P(de,null,re(V.value,i=>(x(),P("div",{key:i.id,class:"issue-item",onClick:Bs=>O(i.id)},[s("div",vs,[s("div",ps,[s("div",ws,"#"+r(i.id),1),t(ae,{type:G(i.status),effect:"light",class:"issue-status"},{default:a(()=>[_(r(H(i.status)),1)]),_:2},1032,["type"])]),s("h4",gs,r(i.title),1),s("div",hs,[s("div",ys,[t(o,null,{default:a(()=>[t(l(he))]),_:1}),s("span",null,r(l(D)(i.createTime)),1)])])]),s("div",bs,[t(o,null,{default:a(()=>[t(l(B))]),_:1})])],8,ms))),128))])):(x(),P("div",cs,[t(te,{description:"暂无负责的问题","image-size":120},{image:a(()=>[s("div",_s,[t(o,null,{default:a(()=>[t(l(ge))]),_:1})])]),default:a(()=>[t(v,{type:"primary",onClick:e[1]||(e[1]=i=>l(R).push("/issues"))},{default:a(()=>e[19]||(e[19]=[_("去浏览问题")])),_:1})]),_:1})]))]),s("div",xs,[s("div",Ps,[e[21]||(e[21]=s("h3",{class:"card-title"},"今日金句",-1)),s("div",ks,[t(v,{type:"primary",text:"",class:"refresh-quote-button",onClick:T},{default:a(()=>[e[20]||(e[20]=_(" 换一句 ")),t(o,{class:"ml-1"},{default:a(()=>[t(l(ye))]),_:1})]),_:1})])]),s("div",Vs,[s("div",Cs,[t(o,null,{default:a(()=>[t(l(be))]),_:1})]),s("blockquote",Us,r(C.value.text),1),s("div",qs,"— "+r(C.value.author),1)])])])])]),t(S,{modelValue:h.value,"onUpdate:modelValue":e[6]||(e[6]=i=>h.value=i),title:"修改密码",width:"460px",center:"","destroy-on-close":""},{footer:a(()=>[s("div",Rs,[t(v,{onClick:e[5]||(e[5]=i=>h.value=!1),class:"cancel-btn"},{default:a(()=>e[23]||(e[23]=[_("取消")])),_:1}),t(v,{type:"primary",onClick:Y,loading:w.value,class:"confirm-btn"},{default:a(()=>e[24]||(e[24]=[_(" 确认修改 ")])),_:1},8,["loading"])])]),default:a(()=>[s("div",Is,[s("div",Ms,[t(o,null,{default:a(()=>[t(l(L))]),_:1})])]),e[25]||(e[25]=s("div",{class:"dialog-description"}," 设置一个安全的新密码，建议使用字母、数字和特殊符号的组合 ",-1)),t($,{model:c.value,rules:j,ref_key:"passwordFormRef",ref:I,"label-position":"top",class:"custom-form"},{default:a(()=>[t(q,{label:"当前密码",prop:"oldPassword"},{default:a(()=>[t(U,{modelValue:c.value.oldPassword,"onUpdate:modelValue":e[2]||(e[2]=i=>c.value.oldPassword=i),type:"password",placeholder:"请输入当前密码","show-password":"","prefix-icon":"Key"},null,8,["modelValue"])]),_:1}),t(q,{label:"新密码",prop:"newPassword"},{default:a(()=>[t(U,{modelValue:c.value.newPassword,"onUpdate:modelValue":e[3]||(e[3]=i=>c.value.newPassword=i),type:"password",placeholder:"请输入新密码","show-password":"","prefix-icon":"Lock"},null,8,["modelValue"])]),_:1}),t(q,{label:"确认新密码",prop:"confirmPassword"},{default:a(()=>[t(U,{modelValue:c.value.confirmPassword,"onUpdate:modelValue":e[4]||(e[4]=i=>c.value.confirmPassword=i),type:"password",placeholder:"请再次输入新密码","show-password":"","prefix-icon":"Check"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),s("div",Fs,[t(o,null,{default:a(()=>[t(l(N))]),_:1}),e[22]||(e[22]=s("span",null,"密码长度至少6位，建议包含大小写字母、数字和特殊字符",-1))])]),_:1},8,["modelValue"]),t(S,{modelValue:y.value,"onUpdate:modelValue":e[9]||(e[9]=i=>y.value=i),title:d.value.email?"修改邮箱":"绑定邮箱",width:"460px",center:"","destroy-on-close":""},{footer:a(()=>[s("div",zs,[t(v,{onClick:e[8]||(e[8]=i=>y.value=!1),class:"cancel-btn"},{default:a(()=>e[27]||(e[27]=[_("取消")])),_:1}),t(v,{type:"primary",onClick:Z,loading:w.value,class:"confirm-btn"},{default:a(()=>[_(r(d.value.email?"更新邮箱":"绑定邮箱"),1)]),_:1},8,["loading"])])]),default:a(()=>[s("div",Ds,[s("div",Es,[t(o,null,{default:a(()=>[t(l(F))]),_:1})])]),s("div",$s,r(d.value.email?"修改您的邮箱地址，新邮箱将用于接收系统通知和找回密码":"绑定邮箱地址，便于接收系统通知和找回密码"),1),t($,{model:b.value,rules:Q,ref_key:"emailFormRef",ref:M,"label-position":"top",class:"custom-form"},{default:a(()=>[t(q,{label:"邮箱地址",prop:"email"},{default:a(()=>[t(U,{modelValue:b.value.email,"onUpdate:modelValue":e[7]||(e[7]=i=>b.value.email=i),placeholder:"请输入邮箱地址","prefix-icon":"Message"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),s("div",Ss,[t(o,null,{default:a(()=>[t(l(N))]),_:1}),e[26]||(e[26]=s("span",null,"绑定邮箱后，您可以通过邮箱接收系统通知和重要提醒",-1))])]),_:1},8,["modelValue","title"])])}}}),Ks=Ve(As,[["__scopeId","data-v-19e6e899"]]);export{Ks as default};
//# sourceMappingURL=index-COffqOgR.js.map
